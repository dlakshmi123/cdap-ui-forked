<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="robots" content="noindex, nofollow">

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Cask Data, Inc." name="author" />
<meta content="Cask Data Application Platform WordCount Application" name="description" />
<meta content="Copyright © 2014-2015 Cask Data, Inc." name="copyright" />

    
    
    <meta name="git_release" content="3.3.7">
    <meta name="git_hash" content="d5ecf211dda1dc11a0accdecf4b6a308ef54b128">
    <meta name="git_timestamp" content="2016-08-20 17:11:44 -0700">
    <title>FileSet Example &mdash; Cask Data Application Platform 3.3.7 Documentation</title>
    
    <link rel="stylesheet" href="../_static/cdap.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />



    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.3.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <!-- Google Tag Manager start -->
    <script>dataLayer = [];</script>
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBZ3JL"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PBZ3JL');</script>
    <!-- Google Tag Manager end -->
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Cask Data Application Platform 3.3.7 Documentation" href="../index.html" />
    <link rel="up" title="Examples" href="index.html" />
    <link rel="next" title="Log Analysis Example" href="log-analysis.html" />
    <link rel="prev" title="Data Cleansing" href="data-cleansing.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="log-analysis.html" title="Log Analysis Example"
             accesskey="N">Next</a> |</li>
        <li class="right" >
          <a href="data-cleansing.html" title="Data Cleansing"
             accesskey="P">Previous</a> |</li>
        
        <script type="text/javascript" src="../_static/version-menu.js"></script>
        <script src="http://docs.cask.co/cdap/json-versions.js"/></script>
        <script>window.setVersion('3.3.7');</script>
       
        <li><a href="../table-of-contents.html">CDAP Examples, Guides, and Tutorials</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Examples</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="fileset-example">
<span id="examples-fileset"></span><h1>FileSet Example<a class="headerlink" href="#fileset-example" title="Permalink to this headline">¶</a></h1>
<p>A Cask Data Application Platform (CDAP) example demonstrating the FileSet dataset and its
use in services and MapReduce.</p>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This application demonstrates the use of the FileSet dataset:</p>
<ul class="simple">
<li>The <em>lines</em> FileSet is used as input for the <em>WordCount</em> MapReduce program.</li>
<li>The <em>counts</em> FileSet is used as output for the <em>WordCount</em> MapReduce program.</li>
<li>The <em>FileSetService</em> allows uploading and downloading files within these two file sets.</li>
</ul>
<p>Let&#8217;s look at some of these components, and then run the application and see the results.</p>
<div class="section" id="the-filesetexample-application">
<h3>The FileSetExample Application<a class="headerlink" href="#the-filesetexample-application" title="Permalink to this headline">¶</a></h3>
<p>As in the other <a class="reference internal" href="index.html#examples-index"><span>examples</span></a>, the components
of the application are tied together by the class <code class="docutils literal"><span class="pre">FileSetExample</span></code>:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileSetExample</span> <span class="kd">extends</span> <span class="n">AbstractApplication</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">setName</span><span class="o">(</span><span class="s">&quot;FileSetExample&quot;</span><span class="o">);</span>
    <span class="n">setDescription</span><span class="o">(</span><span class="s">&quot;Application with a MapReduce that uses a FileSet dataset&quot;</span><span class="o">);</span>
    <span class="n">createDataset</span><span class="o">(</span><span class="s">&quot;lines&quot;</span><span class="o">,</span> <span class="n">FileSet</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">FileSetProperties</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
      <span class="o">.</span><span class="na">setBasePath</span><span class="o">(</span><span class="s">&quot;example/data/lines&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">setInputFormat</span><span class="o">(</span><span class="n">TextInputFormat</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
      <span class="o">.</span><span class="na">setOutputFormat</span><span class="o">(</span><span class="n">TextOutputFormat</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
      <span class="o">.</span><span class="na">build</span><span class="o">());</span>
    <span class="n">createDataset</span><span class="o">(</span><span class="s">&quot;counts&quot;</span><span class="o">,</span> <span class="n">FileSet</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">FileSetProperties</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
      <span class="o">.</span><span class="na">setInputFormat</span><span class="o">(</span><span class="n">TextInputFormat</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
      <span class="o">.</span><span class="na">setOutputFormat</span><span class="o">(</span><span class="n">TextOutputFormat</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
      <span class="o">.</span><span class="na">setOutputProperty</span><span class="o">(</span><span class="n">TextOutputFormat</span><span class="o">.</span><span class="na">SEPERATOR</span><span class="o">,</span> <span class="s">&quot;:&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">build</span><span class="o">());</span>
    <span class="n">addService</span><span class="o">(</span><span class="k">new</span> <span class="n">FileSetService</span><span class="o">());</span>
    <span class="n">addMapReduce</span><span class="o">(</span><span class="k">new</span> <span class="n">WordCount</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">configure()</span></code> method creates the two FileSet datasets used in this example. For the first
FileSet—<em>lines</em>—we specify an explicit base path; for the second FileSet—<em>counts</em>—we let CDAP generate a path. Also, we configure the output format
to use <code class="docutils literal"><span class="pre">&quot;:&quot;</span></code> as the separator for the <em>counts</em> FileSet.</p>
<p>We will use the <em>FileSetService</em> to upload a file into the <em>lines</em> file set, then count the words in
that file using MapReduce, and finally download the word counts from the <em>counts</em> file set.</p>
</div>
<div class="section" id="filesetservice">
<h3>FileSetService<a class="headerlink" href="#filesetservice" title="Permalink to this headline">¶</a></h3>
<p>This service has two handler methods: one to upload and another to download a file.
Both methods of this service have two arguments: the name of the FileSet and the relative path within that FileSet.
For example, the <code class="docutils literal"><span class="pre">read</span></code> method returns the contents of the requested file for a GET request:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="nd">@GET</span>
<span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;{fileSet}&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">read</span><span class="o">(</span><span class="n">HttpServiceRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServiceResponder</span> <span class="n">responder</span><span class="o">,</span>
                 <span class="nd">@PathParam</span><span class="o">(</span><span class="s">&quot;fileSet&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">set</span><span class="o">,</span> <span class="nd">@QueryParam</span><span class="o">(</span><span class="s">&quot;path&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">filePath</span><span class="o">)</span> <span class="o">{</span>

  <span class="n">FileSet</span> <span class="n">fileSet</span><span class="o">;</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="n">fileSet</span> <span class="o">=</span> <span class="n">getContext</span><span class="o">().</span><span class="na">getDataset</span><span class="o">(</span><span class="n">set</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">DatasetInstantiationException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">LOG</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&quot;Error instantiating file set {}&quot;</span><span class="o">,</span> <span class="n">set</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
    <span class="n">responder</span><span class="o">.</span><span class="na">sendError</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Invalid file set name &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="n">set</span><span class="o">));</span>
    <span class="k">return</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="n">Location</span> <span class="n">location</span> <span class="o">=</span> <span class="n">fileSet</span><span class="o">.</span><span class="na">getLocation</span><span class="o">(</span><span class="n">filePath</span><span class="o">);</span>
  <span class="n">getContext</span><span class="o">().</span><span class="na">discardDataset</span><span class="o">(</span><span class="n">fileSet</span><span class="o">);</span>

  <span class="k">try</span> <span class="o">{</span>
    <span class="n">responder</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span> <span class="n">location</span><span class="o">,</span> <span class="s">&quot;application/octet-stream&quot;</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">responder</span><span class="o">.</span><span class="na">sendError</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Unable to read path &#39;%s&#39; in file set &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="n">filePath</span><span class="o">,</span> <span class="n">set</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>It first instantiates the dataset specified by the first path parameter through its <code class="docutils literal"><span class="pre">HttpServiceContext</span></code>.
Note that, conceptually, this method is not limited to using only the two datasets of this application (<em>lines</em> and
<em>counts</em>)—<code class="docutils literal"><span class="pre">getDataset()</span></code> can dynamically instantiate any existing dataset.</p>
<p>The handler method then uses the <code class="docutils literal"><span class="pre">getLocation()</span></code> of the FileSet to obtain the location representing the requested
file, and it opens an input stream for that location. <code class="docutils literal"><span class="pre">Location</span></code> is a file system abstraction from
<a class="reference external" href="http://twill.incubator.apache.org">Apache™ Twill®</a>; you can read more about its interface in the
<a class="reference external" href="http://twill.incubator.apache.org/apidocs/org/apache/twill/filesystem/Location.html">Apache Twill Javadocs</a>.</p>
<p>Note that after obtaining the location from the FileSet, the handler discards that dataset through its context—it is not needed any more and therefore can be returned to the system. This is not strictly necessary: all datasets
are eventually reclaimed by the system. However, explicitly discarding a dataset allows the system to reclaim it
as soon as the current transaction ends, possibly freeing valuable resources.</p>
<p>The <code class="docutils literal"><span class="pre">write</span></code> method uses an <code class="docutils literal"><span class="pre">HttpContentConsumer</span></code> to stream the body of the request to the location specified
by the <code class="docutils literal"><span class="pre">path</span></code> query parameter. See the section on <a class="reference external" href="../source/../../developers-manual/building-blocks/services.html#services-content-consumer" title="(in Cask Data Application Platform v3.3.7)"><span class="xref std std-ref">Handling Large Requests</span></a>
and the <a class="reference internal" href="sport-results.html#examples-sport-results"><span>Sport Results Example</span></a> for a more detailed explanation:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="nd">@PUT</span>
<span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;{fileSet}&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">HttpContentConsumer</span> <span class="nf">write</span><span class="o">(</span><span class="n">HttpServiceRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServiceResponder</span> <span class="n">responder</span><span class="o">,</span>
                                 <span class="nd">@PathParam</span><span class="o">(</span><span class="s">&quot;fileSet&quot;</span><span class="o">)</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">set</span><span class="o">,</span>
                                 <span class="nd">@QueryParam</span><span class="o">(</span><span class="s">&quot;path&quot;</span><span class="o">)</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">filePath</span><span class="o">)</span> <span class="o">{</span>

  <span class="n">FileSet</span> <span class="n">fileSet</span><span class="o">;</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="n">fileSet</span> <span class="o">=</span> <span class="n">getContext</span><span class="o">().</span><span class="na">getDataset</span><span class="o">(</span><span class="n">set</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">DatasetInstantiationException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">LOG</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&quot;Error instantiating file set {}&quot;</span><span class="o">,</span> <span class="n">set</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
    <span class="n">responder</span><span class="o">.</span><span class="na">sendError</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Invalid file set name &#39;%s&#39;&quot;</span><span class="o">,</span> <span class="n">set</span><span class="o">));</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">final</span> <span class="n">Location</span> <span class="n">location</span> <span class="o">=</span> <span class="n">fileSet</span><span class="o">.</span><span class="na">getLocation</span><span class="o">(</span><span class="n">filePath</span><span class="o">);</span>
  <span class="n">getContext</span><span class="o">().</span><span class="na">discardDataset</span><span class="o">(</span><span class="n">fileSet</span><span class="o">);</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">WritableByteChannel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">Channels</span><span class="o">.</span><span class="na">newChannel</span><span class="o">(</span><span class="n">location</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">HttpContentConsumer</span><span class="o">()</span> <span class="o">{</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceived</span><span class="o">(</span><span class="n">ByteBuffer</span> <span class="n">chunk</span><span class="o">,</span> <span class="n">Transactional</span> <span class="n">transactional</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">channel</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">chunk</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFinish</span><span class="o">(</span><span class="n">HttpServiceResponder</span> <span class="n">responder</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">channel</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">responder</span><span class="o">.</span><span class="na">sendStatus</span><span class="o">(</span><span class="mi">200</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onError</span><span class="o">(</span><span class="n">HttpServiceResponder</span> <span class="n">responder</span><span class="o">,</span> <span class="n">Throwable</span> <span class="n">failureCause</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Closeables</span><span class="o">.</span><span class="na">closeQuietly</span><span class="o">(</span><span class="n">channel</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
          <span class="n">location</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">LOG</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&quot;Failed to delete {}&quot;</span><span class="o">,</span> <span class="n">location</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">LOG</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;Unable to write path &#39;{}&#39; in file set &#39;{}&#39;&quot;</span><span class="o">,</span> <span class="n">filePath</span><span class="o">,</span> <span class="n">set</span><span class="o">,</span> <span class="n">failureCause</span><span class="o">);</span>
        <span class="n">responder</span><span class="o">.</span><span class="na">sendError</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Unable to write path &#39;%s&#39; in file set &#39;%s&#39;. Reason: &#39;%s&#39;&quot;</span><span class="o">,</span>
                                               <span class="n">filePath</span><span class="o">,</span> <span class="n">set</span><span class="o">,</span> <span class="n">failureCause</span><span class="o">.</span><span class="na">getMessage</span><span class="o">()));</span>
      <span class="o">}</span>
    <span class="o">};</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">responder</span><span class="o">.</span><span class="na">sendError</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Unable to write path &#39;%s&#39; in file set &#39;%s&#39;. Reason: &#39;%s&#39;&quot;</span><span class="o">,</span>
                                           <span class="n">filePath</span><span class="o">,</span> <span class="n">set</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">()));</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mapreduce-over-files">
<h2>MapReduce over Files<a class="headerlink" href="#mapreduce-over-files" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">WordCount</span></code> is a simple word counting implementation in MapReduce. It reads its input from the
<em>lines</em> FileSet and writes its output to the <em>counts</em> FileSet:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WordCount</span> <span class="kd">extends</span> <span class="n">AbstractMapReduce</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">setInputDataset</span><span class="o">(</span><span class="s">&quot;lines&quot;</span><span class="o">);</span>
    <span class="n">setMapperResources</span><span class="o">(</span><span class="k">new</span> <span class="n">Resources</span><span class="o">(</span><span class="mi">1024</span><span class="o">));</span>
    <span class="n">setReducerResources</span><span class="o">(</span><span class="k">new</span> <span class="n">Resources</span><span class="o">(</span><span class="mi">1024</span><span class="o">));</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">beforeSubmit</span><span class="o">(</span><span class="n">MapReduceContext</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">Job</span> <span class="n">job</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getHadoopJob</span><span class="o">();</span>
    <span class="n">job</span><span class="o">.</span><span class="na">setMapperClass</span><span class="o">(</span><span class="n">Tokenizer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">job</span><span class="o">.</span><span class="na">setReducerClass</span><span class="o">(</span><span class="n">Counter</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">job</span><span class="o">.</span><span class="na">setNumReduceTasks</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="n">context</span><span class="o">.</span><span class="na">addOutput</span><span class="o">(</span><span class="s">&quot;counts&quot;</span><span class="o">);</span>
  <span class="o">}</span>
</pre></div>
</div>
<p>It is worth mentioning that nothing in <code class="docutils literal"><span class="pre">WordCount</span></code> is specifically programmed to use a FileSet. Instead of
<em>lines</em> and <em>counts</em>, it could use any other dataset as long as the key and value types match.</p>
</div>
<div class="section" id="building-and-starting">
<h2>Building and Starting<a class="headerlink" href="#building-and-starting" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">You can either build the example (as described in <a class="reference external" href="../source/../../developers-manual/getting-started/building-apps.html#cdap-building-running-example" title="(in Cask Data Application Platform v3.3.7)"><span class="xref std std-ref">Building an Example Application</span></a>) or use the pre-built JAR file included in the CDAP SDK
(as described in <a class="reference external" href="../source/../../developers-manual/getting-started/building-apps.html#cdap-building-running-deploying" title="(in Cask Data Application Platform v3.3.7)"><span class="xref std std-ref">Deploying an Application</span></a>):</p>
<pre class="literal-block">
examples/FileSetExample/target/FileSetExample-3.3.7.jar
</pre>
</li>
<li><p class="first">Start CDAP (as described in <a class="reference external" href="../source/../../developers-manual/getting-started/start-stop-cdap.html#start-stop-cdap" title="(in Cask Data Application Platform v3.3.7)"><span class="xref std std-ref">Starting and Stopping CDAP</span></a>).</p>
</li>
<li><p class="first">Deploy the application, as described in <a class="reference external" href="../source/../../developers-manual/getting-started/building-apps.html#cdap-building-running-deploying" title="(in Cask Data Application Platform v3.3.7)"><span class="xref std std-ref">Deploying an Application</span></a>.
For example, from the Standalone CDAP SDK directory, use the <a class="reference external" href="../source/../../reference-manual/cli-api.html#cli" title="(in Cask Data Application Platform v3.3.7)"><span class="xref std std-ref">Command Line Interface (CLI)</span></a>:</p>
<div class="highlight container">
<pre class="literal-block">
<span class="gp">$</span> cdap-cli.sh load artifact examples/FileSetExample/target/FileSetExample-3.3.7.jar
Successfully added artifact with name 'FileSetExample'

<span class="gp">$</span> cdap-cli.sh create app FileSetExample FileSetExample 3.3.7 user
Successfully created application
</pre>
</div>
</li>
<li><p class="first">Once the application has been deployed, you can start its components, as described in
<a class="reference external" href="../source/../../developers-manual/getting-started/building-apps.html#cdap-building-running-starting-application" title="(in Cask Data Application Platform v3.3.7)"><span class="xref std std-ref">Starting an Application</span></a>, and detailed at the
start of <a class="reference external" href="#running-the-example">running the example</a>.</p>
</li>
<li><p class="first">Once all components are started, <a class="reference external" href="#running-the-example">run the example</a>.</p>
</li>
<li><p class="first">When finished, you can <a class="reference external" href="../source/../../developers-manual/getting-started/building-apps.html#cdap-building-running-stopping" title="(in Cask Data Application Platform v3.3.7)"><span class="xref std std-ref">stop</span></a>
and <a class="reference external" href="../source/../../developers-manual/getting-started/building-apps.html#cdap-building-running-removing" title="(in Cask Data Application Platform v3.3.7)"><span class="xref std std-ref">remove the application</span></a>.</p>
</li>
</ul>
</div>
<div class="section" id="running-the-example">
<h2>Running the Example<a class="headerlink" href="#running-the-example" title="Permalink to this headline">¶</a></h2>
<div class="section" id="starting-the-service">
<h3>Starting the Service<a class="headerlink" href="#starting-the-service" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Using the CDAP-UI, go to the <em>FileSetExample</em> <a class="reference external" href="http://localhost:9999/ns/default/apps/FileSetExample/overview/programs">application overview page, programs tab</a>,
click <em>FileSetService</em> to get to the service detail page, then click the <em>Start</em> button; or</p>
</li>
<li><p class="first">From the Standalone CDAP SDK directory, use the Command Line Interface:</p>
<div class="highlight container">
<pre class="literal-block">
<span class="gp">$</span> cdap-cli.sh start service FileSetExample.FileSetService
Successfully started service 'FileSetService' of application 'FileSetExample' with stored runtime arguments '{}'
</pre>
</div>
</li>
</ul>
</div>
<div class="section" id="uploading-and-downloading-files">
<h3>Uploading and Downloading Files<a class="headerlink" href="#uploading-and-downloading-files" title="Permalink to this headline">¶</a></h3>
<p>First, we will upload a text file (<code class="docutils literal"><span class="pre">some.txt</span></code>) that we will use as input for the WordCount.
This is done by making a RESTful call to the <em>FileSetService</em>.
A sample text file (<code class="docutils literal"><span class="pre">lines.txt</span></code>) is included in the <code class="docutils literal"><span class="pre">resources</span></code> directory of the example:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> cdap-cli.sh call service FileSetExample.FileSetService PUT <span class="s2">&quot;lines?path=some.txt&quot;</span> body:file examples/FileSetExample/resources/lines.txt
</pre></div>
</div>
<p>Now, we start the MapReduce program and configure it to use the file <code class="docutils literal"><span class="pre">some.txt</span></code> as its input, and to write its output to
<code class="docutils literal"><span class="pre">counts.out</span></code>:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> cdap-cli.sh start mapreduce FileSetExample.WordCount <span class="se">\&quot;</span>dataset.lines.input.paths<span class="o">=</span>some.txt dataset.counts.output.path<span class="o">=</span>counts.out<span class="se">\&quot;</span>
<span class="go">Successfully started MapReduce program &#39;WordCount&#39; of application &#39;FileSetExample&#39; with provided runtime arguments &#39;dataset.lines.input.paths=some.txt dataset.counts.output.path=counts.out&#39;</span>
</pre></div>
</div>
<p>Check the status of the MapReduce program until it is completed:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> cdap-cli.sh get mapreduce status FileSetExample.WordCount
<span class="go">STOPPED</span>
</pre></div>
</div>
<p>and you can download the results of the computation:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> cdap-cli.sh call service FileSetExample.FileSetService GET <span class="s2">&quot;counts?path=counts.out/part-r-00000&quot;</span>
<span class="go">&lt; 200 OK</span>
<span class="go">&lt; Content-Length: 60</span>
<span class="go">a:1</span>
<span class="go">five:1</span>
<span class="go">hello:4</span>
<span class="go">is:1</span>
<span class="go">letter:1</span>
<span class="go">say:1</span>
<span class="go">the:1</span>
<span class="go">word:2</span>
<span class="go">world:1</span>
</pre></div>
</div>
<p>Note that we have to download a part file that is under the output path that was specified for the MapReduce program.
This is because in MapReduce, every reducer writes a separate part file into the output directory.
In this case, as we have fixed the number of reducers to one, there is only a single part file to download.</p>
</div>
</div>
<div class="section" id="stopping-and-removing-the-application">
<h2>Stopping and Removing the Application<a class="headerlink" href="#stopping-and-removing-the-application" title="Permalink to this headline">¶</a></h2>
<p>Once done, you can stop the application as described in <a class="reference external" href="../source/../../developers-manual/getting-started/building-apps.html#cdap-building-running-stopping" title="(in Cask Data Application Platform v3.3.7)"><span class="xref std std-ref">Stopping an Application</span></a>. Here is an example-specific description of the steps:</p>
<p><strong>Stopping the Service</strong></p>
<ul>
<li><p class="first">Using the CDAP-UI, go to the <em>FileSetExample</em> <a class="reference external" href="http://localhost:9999/ns/default/apps/FileSetExample/overview/programs">application overview page, programs tab</a>,
click <em>FileSetService</em> to get to the service detail page, then click the <em>Stop</em> button; or</p>
</li>
<li><p class="first">From the Standalone CDAP SDK directory, use the Command Line Interface:</p>
<div class="highlight container">
<pre class="literal-block">
<span class="gp">$</span> cdap-cli.sh stop service FileSetExample.FileSetService
Successfully stopped service 'FileSetService' of application 'FileSetExample'
</pre>
</div>
</li>
</ul>
<p><strong>Removing the Application</strong></p>
<p>You can now remove the application as described in <a class="reference external" href="../source/../../developers-manual/getting-started/building-apps.html#cdap-building-running-removing" title="(in Cask Data Application Platform v3.3.7)"><span class="xref std std-ref">Removing an Application</span></a>, or:</p>
<ul>
<li><p class="first">Using the CDAP-UI, go to the <em>FileSetExample</em> <a class="reference external" href="http://localhost:9999/ns/default/apps/FileSetExample/overview/programs">application overview page, programs tab</a>,
click the <em>Actions</em> menu on the right side and select <em>Manage</em> to go to the Management
pane for the application, then click the <em>Actions</em> menu on the right side and select
<em>Delete</em> to delete the application; or</p>
</li>
<li><p class="first">From the Standalone CDAP SDK directory, use the Command Line Interface:</p>
<div class="highlight container">
<pre class="literal-block">
<span class="gp">$</span> cdap-cli.sh delete app FileSetExample
</pre>
</div>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
    
    
    
    
    
    
    
    
    
    
    
    
  <div role="note" aria-label="manuals links">
    <h3><a href="../table-of-contents/../../index.html" rel="nofollow">CDAP Documentation v3.3.7</a></h3>
    <ul class="this-page-menu">
      <li><div class=""></div><a href="../table-of-contents/../../index.html" rel="nofollow">Overview</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../introduction/index.html" rel="nofollow">Introduction to CDAP</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../developers-manual/index.html" rel="nofollow">Developers’ Manual</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../cdap-apps/index.html" rel="nofollow">CDAP Applications</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../admin-manual/index.html" rel="nofollow">Administration Manual</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../integrations/index.html" rel="nofollow">Integrations</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../examples-manual/index.html" rel="nofollow">Examples, Guides, and Tutorials</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../reference-manual/index.html" rel="nofollow">Reference Manual</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../faqs/index.html" rel="nofollow">FAQs</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../reference-manual/release-notes.html" rel="nofollow">Release Notes</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../reference-manual/glossary.html" rel="nofollow">Glossary</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../search.html" rel="nofollow">Search</a></li>
    </ul>
  </div><!--
  Copyright © 2014-2015 Cask Data, Inc.

  Licensed under the Apache License, Version 2.0 (the "License"); you may not
  use this file except in compliance with the License. You may obtain a copy of
  the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
  License for the specific language governing permissions and limitations under
  the License.
-->


    
  <h3 class="pagenavtitle"><a href="../table-of-contents.html">Examples, Guides, and Tutorials:<br> Table&nbsp;of&nbsp;Contents</a></h3>
    <nav class="pagenav">
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="hello-world.html">Hello World</a></li>
<li class="toctree-l2"><a class="reference internal" href="count-random.html">Count Random</a></li>
<li class="toctree-l2"><a class="reference internal" href="data-cleansing.html">Data Cleansing</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">FileSet Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mapreduce-over-files">MapReduce over Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-and-starting">Building and Starting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-example">Running the Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stopping-and-removing-the-application">Stopping and Removing the Application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="log-analysis.html">Log Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="purchase.html">Purchase</a></li>
<li class="toctree-l2"><a class="reference internal" href="spark-k-means.html">Spark K-Means</a></li>
<li class="toctree-l2"><a class="reference internal" href="spark-page-rank.html">Spark Page Rank</a></li>
<li class="toctree-l2"><a class="reference internal" href="sport-results.html">Sport Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="stream-conversion.html">Stream Conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-profiles.html">User Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="web-analytics.html">Web Analytics</a></li>
<li class="toctree-l2"><a class="reference internal" href="wikipedia-data-pipeline.html">Wikipedia Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="word-count.html">Word Count</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../how-to-guides/index.html">How-To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps-packs.html">Apps and Packs</a></li>
</ul>
 
    </nav>
  <h4>Topics</h4>
  <ul>
  <li class="topless"><i>Previous:</i> <a href="data-cleansing.html"
                        title="Previous Topic">Data Cleansing</a></li>
  <li class="topless"><i>Next:</i> <a href="log-analysis.html"
                        title="Next Topic">Log Analysis Example</a></li>
  </ul>
  <div role="note" aria-label="downloads links">
    <h3>Downloads</h3>
    <ul class="this-page-menu">
      <li><a href="http://docs.cask.co/cdap/3.3.7/cdap-docs-3.3.7-web.zip"
            rel="nofollow">Zip Archive of CDAP Documentation</a></li>
    </ul>
   </div>
  
<div id="searchbox" style="display: none" role="search">
  <h3>Quick Search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<div role="note" aria-label="other links">
    <h3><a href="http://docs.cask.co/" target="_blank">Documentation</a></h3>
    <ul class="this-page-menu">
        <li><a href="http://docs.cask.co/cdap/index.html" target="_blank">CDAP</a></li>
        <li><a href="http://docs.cask.co/coopr/index.html" target="_blank">Coopr</a></li>
        <li><a href="http://docs.cask.co/tephra/index.html" target="_blank">Tephra</em></a></li>
        <li><a href="http://docs.cask.co/tigon/index.html" target="_blank">Tigon</a></li>
    </ul>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;margin:0px auto;}
.tg td{padding:0px 20px 0px 20px;border-width:0px;overflow:hidden;word-break:normal;font-weight:normal;}
.tg th{padding:0px 20px 0px 20px;border-width:0px;overflow:hidden;word-break:normal;font-weight:normal;}
.tg .tg-s6z2{text-align:center;}
.tg .tg-0ord{text-align:right;}
.tg a{font-weight:bold;}
</style>
<table class="tg" width= 100%>
  <tr>
    <th class="tg-031e">Previous Topic: 
    <a title="Data Cleansing" href="data-cleansing.html" />Data Cleansing</a>&nbsp;&nbsp;
    
    </th>
    <th class="tg-s6z2">
        Copyright &copy; 2014-2016 Cask Data, Inc.
    
    </th>
    <th class="tg-0ord">&nbsp;&nbsp;Next Topic:
    <a title="Log Analysis Example" href="log-analysis.html" />Log Analysis Example</a>
    
    </th>
  </tr>
</table>

    </div>
  </body>
</html>