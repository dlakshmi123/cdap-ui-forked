<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="robots" content="noindex, nofollow">

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Cask Data, Inc." name="author" />
<meta content="Copyright © 2015 Cask Data, Inc." name="copyright" />
<script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-55081520-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    
    <meta name="git_release" content="3.2.2">
    <meta name="git_hash" content="b267c80c25df10a57efd94370dbfb7a46ca69387">
    <meta name="git_timestamp" content="2015-12-10 18:14:18 -0800">
    <title>Transformations: Validator &mdash; Cask Data Application Platform 3.2.2 Documentation</title>
    
    <link rel="stylesheet" href="../../../_static/cdap.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    



    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '3.2.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    
    <!-- Amazon SQS Page Usage Logging start-->
    <script type="text/javascript" src="https://sdk.amazonaws.com/js/aws-sdk-2.1.35.min.js"></script>
    <script type="text/javascript" src="http://docs.cask.co/resources/scripts/aws-sqs-1.0.0.js"></script>
    <!-- Amazon SQS Page Usage Logging end-->
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="top" title="Cask Data Application Platform 3.2.2 Documentation" href="../../../index.html" />
    <link rel="up" title="Transformations" href="index.html" />
    <link rel="next" title="Batch Sinks" href="../batchsinks/index.html" />
    <link rel="prev" title="Transformations: StructuredRecordToGenericRecord" href="structuredrecordtogenericrecord.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="../batchsinks/index.html" title="Batch Sinks"
             accesskey="N">Next</a> |</li>
        <li class="right" >
          <a href="structuredrecordtogenericrecord.html" title="Transformations: StructuredRecordToGenericRecord"
             accesskey="P">Previous</a> |</li>
        
        <script type="text/javascript" src="../../../_static/version-menu.js"></script>
        <script src="http://docs.cask.co/cdap/json-versions.js"/></script>
        <script>window.setVersion('3.2.2');</script>
       
        <li><a href="../../../table-of-contents.html">CDAP Included Applications</a> &raquo;</li>
          <li><a href="../index.html" >ETL Plugins</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Transformations</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="transformations-validator">
<span id="included-apps-etl-plugins-transformations-validator"></span><h1>Transformations: Validator<a class="headerlink" href="#transformations-validator" title="Permalink to this headline">¶</a></h1>
<p class="rubric">Description</p>
<p>Validates a record, writing to an error dataset if the record is invalid.
Otherwise it passes the record on to the next stage.</p>
<p>The transform validates records using a custom Javascript function based on a set of
<a class="reference internal" href="../shared-plugins/core.html#included-apps-etl-plugins-shared-core-validator"><span>available validator functions</span></a> in the
<a class="reference internal" href="../shared-plugins/core.html#included-apps-etl-plugins-shared-core-validator"><span>CoreValidator</span></a>.</p>
<p class="rubric">Use Case</p>
<p>The transform is used when you need to validate records. For example, you may want to
validate records as being valid IP addresses or valid dates and log errors if they aren&#8217;t
valid.</p>
<p class="rubric">Properties</p>
<p><strong>validators</strong> Comma-separated list of validators that are used by the validationScript.
Example: <code class="docutils literal"><span class="pre">&quot;validators&quot;:</span> <span class="pre">&quot;core&quot;</span></code></p>
<p><strong>validationScript:</strong> Javascript that must implement a function <code class="docutils literal"><span class="pre">isValid</span></code> that takes a JSON object
(representing the input record) and a context object (encapsulating CDAP metrics, logger, and validators)
and returns a result JSON with validity, error code, and error message.
Example response:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="o">{</span>
  <span class="s">&quot;isValid&quot;</span> <span class="o">:</span> <span class="kc">true</span> <span class="o">[</span><span class="n">or</span><span class="o">]</span> <span class="kc">false</span><span class="o">,</span>
  <span class="s">&quot;errorCode&quot;</span> <span class="o">:</span> <span class="n">number</span> <span class="o">[</span><span class="n">should</span> <span class="n">be</span> <span class="n">an</span> <span class="n">valid</span> <span class="n">integer</span><span class="o">],</span>
  <span class="s">&quot;errorMsg&quot;</span> <span class="o">:</span> <span class="s">&quot;Message indicating the error and why the record failed validation&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p class="rubric">Examples</p>
<div class="highlight-java"><div class="highlight"><pre><span class="o">{</span>
  <span class="s">&quot;name&quot;</span><span class="o">:</span> <span class="s">&quot;Validator&quot;</span><span class="o">,</span>
  <span class="s">&quot;properties&quot;</span><span class="o">:</span> <span class="o">{</span>
    <span class="s">&quot;validators&quot;</span><span class="o">:</span> <span class="s">&quot;core&quot;</span><span class="o">,</span>
    <span class="s">&quot;validationScript&quot;</span><span class="o">:</span> <span class="s">&quot;function isValid(input, context) {</span>
<span class="s">                            var coreValidator = context.getValidator(\&quot;coreValidator\&quot;);</span>
<span class="s">                            if (!coreValidator.maxLength(input.body, 10))</span>
<span class="s">                              {</span>
<span class="s">                                return {&#39;isValid&#39;: false, &#39;errorCode&#39;: 10,</span>
<span class="s">                                        &#39;errorMsg&#39;: \&quot;body length greater than 10\&quot;};</span>
<span class="s">                              }</span>
<span class="s">                            return {&#39;isValid&#39; : true};</span>
<span class="s">                          };&quot;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>This example sends an error code <code class="docutils literal"><span class="pre">'10'</span></code> for any records whose <code class="docutils literal"><span class="pre">'body'</span></code> field contains
a value whose length is greater than 10. It has been &#8220;pretty-printed&#8221; for readability. It
uses the <a class="reference internal" href="../shared-plugins/core.html#included-apps-etl-plugins-shared-core-validator"><span>CoreValidator</span></a> (included
using <code class="docutils literal"><span class="pre">&quot;validators&quot;:</span> <span class="pre">&quot;core&quot;</span></code>) and references a function using its Javascript name
(<code class="docutils literal"><span class="pre">coreValidator.maxLength</span></code>).</p>
<div class="highlight-java"><div class="highlight"><pre><span class="o">{</span>
  <span class="s">&quot;name&quot;</span><span class="o">:</span> <span class="s">&quot;Validator&quot;</span><span class="o">,</span>
  <span class="s">&quot;properties&quot;</span><span class="o">:</span> <span class="o">{</span>
    <span class="s">&quot;validators&quot;</span><span class="o">:</span> <span class="s">&quot;core&quot;</span><span class="o">,</span>
    <span class="s">&quot;validationScript&quot;</span><span class="o">:</span> <span class="s">&quot;function isValid(input, context) {</span>
<span class="s">                            var isValid = true;</span>
<span class="s">                            var errMsg = \&quot;\&quot;;</span>
<span class="s">                            var errCode = 0;</span>
<span class="s">                            var coreValidator = context.getValidator(\&quot;coreValidator\&quot;);</span>
<span class="s">                            var metrics = context.getMetrics();</span>
<span class="s">                            var logger = context.getLogger();</span>
<span class="s">                            if (!coreValidator.isDate(input.date)) {</span>
<span class="s">                               isValid = false; errMsg = input.date + \&quot;is invalid date\&quot;; errCode = 5;</span>
<span class="s">                               metrics.count(\&quot;invalid.date\&quot;, 1);</span>
<span class="s">                            } else if (!coreValidator.isUrl(input.url)) {</span>
<span class="s">                               isValid = false; errMsg = \&quot;invalid url\&quot;; errCode = 7;</span>
<span class="s">                               metrics.count(\&quot;invalid.url\&quot;, 1);</span>
<span class="s">                            } else if (!coreValidator.isInRange(input.content_length, 0, 1024 * 1024)) {</span>
<span class="s">                               isValid = false; errMsg = \&quot;content length &gt;1MB\&quot;; errCode = 10;</span>
<span class="s">                               metrics.count(\&quot;invalid.body.size\&quot;, 1);</span>
<span class="s">                            }</span>
<span class="s">                            if (!isValid) {</span>
<span class="s">                              logger.warn(\&quot;Validation failed for record {}\&quot;, input);</span>
<span class="s">                            }</span>
<span class="s">                            return {&#39;isValid&#39;: isValid, &#39;errorCode&#39;: errCode, &#39;errorMsg&#39;: errMsg};</span>
<span class="s">                          };&quot;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>This example sends an error code <code class="docutils literal"><span class="pre">'5'</span></code> for any records whose <code class="docutils literal"><span class="pre">'date'</span></code> field is an
invalid date, sends an error code <code class="docutils literal"><span class="pre">'7'</span></code> for any records whose <code class="docutils literal"><span class="pre">'url'</span></code> field is an
invalid URL, and sends an error code <code class="docutils literal"><span class="pre">'10'</span></code> for any records whose <code class="docutils literal"><span class="pre">'content_length'</span></code>
field is greater than 1MB.</p>
<p>It has been &#8220;pretty-printed&#8221; for readability. It uses the
<a class="reference internal" href="../shared-plugins/core.html#included-apps-etl-plugins-shared-core-validator"><span>CoreValidator</span></a> (included using
<code class="docutils literal"><span class="pre">&quot;validators&quot;:</span> <span class="pre">&quot;core&quot;</span></code>) and references functions using their Javascript names (such as
<code class="docutils literal"><span class="pre">coreValidator.isDate</span></code>).</p>
<p><strong>Note:</strong> These default metrics are emitted by this transform:</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Metric Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">records.in</span></code></td>
<td>Input records processed by this transform stage</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">records.out</span></code></td>
<td>Output records sent to the next stage</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">invalid</span></code></td>
<td>Input records invalidated at this stage</td>
</tr>
</tbody>
</table>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div role="note" aria-label="manuals links">
    <h3><a href="../../../table-of-contents/../../index.html"
        rel="nofollow">CDAP Documentation v3.2.2</a></h3>
    <ul class="this-page-menu">
      <li><div class=""></div><a href="../../../table-of-contents/../../index.html"
            rel="nofollow">Overview</a></li>
            
      <li><div class=""></div><a href="../../../table-of-contents/../../introduction/index.html"
            rel="nofollow">Introduction to CDAP</a></li>
            
      <li><div class=""></div><a href="../../../table-of-contents/../../developers-manual/index.html"
            rel="nofollow">Developers’ Manual</a></li>
            
      <li><div class=""></div><b><a href="../../../table-of-contents/../../included-applications/index.html"
            rel="nofollow">Included Applications</a></b></li>
            
      <li><div class=""></div><a href="../../../table-of-contents/../../admin-manual/index.html"
            rel="nofollow">Administration Manual</a></li>
            
      <li><div class=""></div><a href="../../../table-of-contents/../../integrations/index.html"
            rel="nofollow">Integrations</a></li>
            
      <li><div class=""></div><a href="../../../table-of-contents/../../examples-manual/index.html"
            rel="nofollow">Examples, Guides, and Tutorials</a></li>
            
      <li><div class=""></div><a href="../../../table-of-contents/../../reference-manual/index.html"
            rel="nofollow">Reference Manual</a></li>
            
      <li><div class=""></div><a href="../../../table-of-contents/../../faqs/index.html"
            rel="nofollow">FAQs</a></li>
            
      <li><div class=""></div><a href="../../../table-of-contents/../../reference-manual/release-notes.html"
            rel="nofollow">Release Notes</a></li>
            
      <li><div class=""></div><a href="../../../table-of-contents/../../reference-manual/glossary.html"
            rel="nofollow">Glossary</a></li>
            
      <li><div class=""></div><a href="../../../table-of-contents/../../search.html"
            rel="nofollow">Search</a></li>
    </ul>
   </div><!--
  Copyright © 2014-2015 Cask Data, Inc.

  Licensed under the Apache License, Version 2.0 (the "License"); you may not
  use this file except in compliance with the License. You may obtain a copy of
  the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
  License for the specific language governing permissions and limitations under
  the License.
-->


    
<h3 class="pagenavtitle"><a href="../../../table-of-contents.html">Included Applications:<br> Table&nbsp;of&nbsp;Contents</a></h3>
<nav class="pagenav">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html"> Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index.html"> ETL Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../creating.html"> Creating an ETL Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../custom.html"> Creating Custom ETL Plugins</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html"> ETL Plugins</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../batchsources/index.html"> Batch Sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../realtimesources/index.html"> Real-time Sources</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html"> Transformations</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="logparser.html"> LogParser</a></li>
<li class="toctree-l3"><a class="reference internal" href="projection.html"> Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="script.html"> Script</a></li>
<li class="toctree-l3"><a class="reference internal" href="scriptfilter.html"> ScriptFilter</a></li>
<li class="toctree-l3"><a class="reference internal" href="structuredrecordtogenericrecord.html"> StructuredRecordToGenericRecord</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href=""> Validator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../batchsinks/index.html"> Batch Sinks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../realtimesinks/index.html"> Real-time Sinks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shared-plugins/index.html"> Shared Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../third-party.html"> Third-Party Jars</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../third-party.html"> Using Third-Party JARs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data-quality/index.html"> Data Quality Application</a></li>
</ul>
 
</nav>
  <h4>Previous Topic</h4>
  <p class="topless"><a href="structuredrecordtogenericrecord.html"
                        title="Previous Chapter">Transformations: StructuredRecordToGenericRecord</a></p>
  <h4>Next Topic</h4>
  <p class="topless"><a href="../batchsinks/index.html"
                        title="Next Chapter">Batch Sinks</a></p>
  <div role="note" aria-label="downloads links">
    <h3>Downloads</h3>
    <ul class="this-page-menu">
      <li><a href="http://docs.cask.co/cdap/3.2.2/cdap-docs-3.2.2-web.zip"
            rel="nofollow">Zip Archive of CDAP Documentation</a></li>
    </ul>
   </div>
  
<div id="searchbox" style="display: none" role="search">
  <h3>Quick Search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<div role="note" aria-label="other links">
    <h3><a href="http://docs.cask.co/" target="_blank">Documentation</a></h3>
    <ul class="this-page-menu">
        <li><a href="http://docs.cask.co/cdap/index.html" target="_blank">CDAP</a></li>
        <li><a href="http://docs.cask.co/coopr/index.html" target="_blank">Coopr</a></li>
        <li><a href="http://docs.cask.co/tephra/index.html" target="_blank">Tephra</em></a></li>
        <li><a href="http://docs.cask.co/tigon/index.html" target="_blank">Tigon</a></li>
    </ul>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;margin:0px auto;}
.tg td{padding:0px 20px 0px 20px;border-width:0px;overflow:hidden;word-break:normal;font-weight:normal;}
.tg th{padding:0px 20px 0px 20px;border-width:0px;overflow:hidden;word-break:normal;font-weight:normal;}
.tg .tg-s6z2{text-align:center;}
.tg .tg-0ord{text-align:right;}
.tg a{font-weight:bold;}
</style>
<table class="tg" width= 100%>
  <tr>
    <th class="tg-031e">Previous Topic: 
    <a title="Transformations: StructuredRecordToGenericRecord" href="structuredrecordtogenericrecord.html" />Transformations: StructuredRecordToGenericRecord</a>&nbsp;&nbsp;
    
    </th>
    <th class="tg-s6z2">
        Copyright &copy; 2014-2015 Cask Data, Inc.
    
    </th>
    <th class="tg-0ord">&nbsp;&nbsp;Next Topic:
    <a title="Batch Sinks" href="../batchsinks/index.html" />Batch Sinks</a>
    
    </th>
  </tr>
</table>

    </div>
  </body>
</html>