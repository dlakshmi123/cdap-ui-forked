<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="robots" content="noindex, nofollow">

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Cask Data, Inc." name="author" />
<meta content="Copyright © 2015 Cask Data, Inc." name="copyright" />

    
    
    <meta name="git_release" content="3.3.5">
    <meta name="git_hash" content="2c32227118f9bae6656277ef40b7a50a34e48261">
    <meta name="git_timestamp" content="2016-06-30 19:45:22 -0700">
    <title>Data Quality Application &mdash; Cask Data Application Platform 3.3.5 Documentation</title>
    
    <link rel="stylesheet" href="../_static/cdap.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />



    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.3.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <!-- Google Tag Manager start -->
    <script>dataLayer = [];</script>
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PBZ3JL"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PBZ3JL');</script>
    <!-- Google Tag Manager end -->
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Cask Data Application Platform 3.3.5 Documentation" href="../index.html" />
    <link rel="prev" title="ETL Upgrade Procedure" href="../hydrator/upgrade.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="../hydrator/upgrade.html" title="ETL Upgrade Procedure"
             accesskey="P">Previous</a> |</li>
        
        <script type="text/javascript" src="../_static/version-menu.js"></script>
        <script src="http://docs.cask.co/cdap/json-versions.js"/></script>
        <script>window.setVersion('3.3.5');</script>
       
        <li><a href="../table-of-contents.html">CDAP CDAP Applications</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="data-quality-application">
<span id="cdap-apps-data-quality-index"></span><h1>Data Quality Application<a class="headerlink" href="#data-quality-application" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The goal of the <strong>Data Quality Application</strong> is to provide users with an extensible CDAP application to help them
determine the quality of their data.  Users can assess the quality of their data using its out-of-the-box
functionality and libraries. The application can be extended with custom aggregation functions and queried with a
RESTful API to obtain the results of the quality metric computations.</p>
<p>In this guide, you&#8217;ll learn to use the <em>Data Quality Application</em>, including:</p>
<ul class="simple">
<li>deploying the application with the default functionality;</li>
<li>configuring the application to your specifications;</li>
<li>building custom aggregation functions; and</li>
<li>querying the aggregated data.</li>
</ul>
<div class="section" id="creating-the-application">
<h3>Creating the Application<a class="headerlink" href="#creating-the-application" title="Permalink to this headline">¶</a></h3>
<p>The application can be created from the <code class="docutils literal"><span class="pre">cdap-data-quality</span></code> system artifact by supplying an application configuration:</p>
<div class="highlight container">
<pre class="literal-block">
{
  &quot;artifact&quot;: {
    &quot;name&quot;: &quot;cdap-data-quality&quot;,
    &quot;version&quot;: &quot;3.3.5&quot;,
    &quot;scope&quot;: &quot;system&quot;
  },
  &quot;config&quot;: {
    &quot;source&quot;: {
      &quot;name&quot;: &quot;Stream&quot;,
      &quot;id&quot;: &quot;logStream&quot;,
      &quot;properties&quot;: {
        &quot;duration&quot;: &quot;5m&quot;,
        &quot;format&quot;: &quot;clf&quot;,
        &quot;name&quot;: &quot;logStream&quot;
      }
    },
    &quot;datasetName&quot;: &quot;dataQuality&quot;,
    &quot;workflowScheduleMinutes&quot;: 5,
    &quot;fieldAggregations&quot;: {
      &quot;referrer&quot;: [ &quot;DiscreteValuesHistogram&quot; ],
      &quot;status&quot;: [ &quot;DiscreteValuesHistogram&quot; ],
      &quot;remote_login&quot;: [ &quot;DiscreteValuesHistogram&quot; ],
      &quot;request&quot;: [ &quot;DiscreteValuesHistogram&quot; ],
      &quot;user_agent&quot;: [ &quot;DiscreteValuesHistogram&quot; ],
      &quot;auth_user&quot;: [ &quot;DiscreteValuesHistogram&quot; ],
      &quot;content_length&quot;: [ &quot;DiscreteValuesHistogram&quot; ],
      &quot;date&quot;: [ &quot;DiscreteValuesHistogram&quot; ],
      &quot;remote_host&quot;: [ &quot;DiscreteValuesHistogram&quot; ]
    }
  }
}
</pre>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">source</span></code> : Data Quality Source<ul>
<li><code class="docutils literal"><span class="pre">name</span></code>: Name of the <a class="reference internal" href="../hydrator/hydrator-plugins/batchsources/index.html#cdap-apps-etl-plugins-batchsources"><span>Batch Source Plugin</span></a>.</li>
<li><code class="docutils literal"><span class="pre">id</span></code>: Unique ID that can be used to query for Data Quality metrics using DataQualityService.</li>
<li><code class="docutils literal"><span class="pre">properties</span></code>: Properties required by the <a class="reference internal" href="../hydrator/hydrator-plugins/batchsources/index.html#cdap-apps-etl-plugins-batchsources"><span>Batch Source Plugin</span></a>.</li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">workflowScheduleMinutes</span></code> : Frequency (in minutes) with which the workflow runs the aggregation MapReduce.</li>
<li><code class="docutils literal"><span class="pre">datasetName</span></code> : Name of the destination dataset.</li>
<li><code class="docutils literal"><span class="pre">fieldAggregations</span></code> : Map that relates each field value to a set of aggregation functions.</li>
</ul>
</div>
<div class="section" id="deploying-the-application">
<h3>Deploying the Application<a class="headerlink" href="#deploying-the-application" title="Permalink to this headline">¶</a></h3>
<p>To deploy the application with the application configuration, issue a PUT curl call.
In this example, the <code class="docutils literal"><span class="pre">appconfig.json</span></code> file contains the application configuration:</p>
<div class="highlight-java"><div class="highlight"><pre>$ curl -w&#39;\n&#39; localhost:10000/v3/namespaces/default/apps/StreamDQ -d @appconfig.json -X PUT -H &#39;Content-Type: application/json&#39;
</pre></div>
</div>
<p>Note that the <code class="docutils literal"><span class="pre">cdap-data-quality</span></code> artifact uses the same batch source plugins as the <code class="docutils literal"><span class="pre">cdap-etl-batch</span></code> artifact.
See <a class="reference internal" href="../hydrator/hydrator-plugins/batchsources/index.html#cdap-apps-etl-plugins-batchsources"><span>Batch Sources</span></a> for more information about available plugins.</p>
</div>
</div>
<div class="section" id="end-to-end-example">
<h2>End-to-End Example<a class="headerlink" href="#end-to-end-example" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s take the example of a user who wants wants to use the Data Quality Application to:</p>
<ul class="simple">
<li>Ingest a stream of CLF log data.</li>
<li>Generate several histograms partitioned by the time distribution of status codes.</li>
<li>Generate the aforementioned-aggregations every 10 minutes.</li>
<li>Query ranges of timestamps for aggregated histogram data.</li>
</ul>
<p>We would create a Data Quality Application by creating a JSON file <code class="docutils literal"><span class="pre">appconfig.json</span></code> that contains:</p>
<div class="highlight container">
<pre class="literal-block">
{
  &quot;artifact&quot;: {
    &quot;name&quot;: &quot;cdap-data-quality&quot;,
    &quot;version&quot;: &quot;3.3.5&quot;,
    &quot;scope&quot;: &quot;system&quot;
  },
  &quot;config&quot;: {
    &quot;workflowScheduleMinutes&quot;: 5,
    &quot;source&quot;: {
      &quot;name&quot;: &quot;Stream&quot;,
      &quot;id&quot;: &quot;logStream&quot;,
      &quot;properties&quot;: {
        &quot;duration&quot;: &quot;5m&quot;,
        &quot;format&quot;: &quot;clf&quot;,
        &quot;name&quot;: &quot;logStream&quot;
      }
    },
    &quot;datasetName&quot;: &quot;dataQuality&quot;,
    &quot;inputFormat&quot;: &quot;clf&quot;,
    &quot;fieldAggregations&quot;: {
      &quot;status&quot;: [ &quot;DiscreteValuesHistogram&quot; ]
    }
  }
}
</pre>
</div>
<p>To deploy the application, issue this curl command:</p>
<div class="highlight-java"><div class="highlight"><pre>$ curl -w&#39;\n&#39; localhost:10000/v3/namespaces/default/apps/StreamDQ -d @appconfig.json -X PUT -H &#39;Content-Type: application/json&#39;
</pre></div>
</div>
<p>Next, resume the workflow schedule:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">w</span><span class="sc">&#39;\n&#39;</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="n">localhost</span><span class="o">:</span><span class="mi">10000</span><span class="o">/</span><span class="n">v3</span><span class="o">/</span><span class="n">namespaces</span><span class="o">/</span><span class="k">default</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">StreamDQ</span><span class="o">/</span><span class="n">schedules</span><span class="o">/</span><span class="n">aggregatorSchedule</span><span class="o">/</span><span class="n">resume</span>
</pre></div>
</div>
<p>This will resume the schedule so that it kicks off a workflow run every five minutes.
Now, let&#8217;s send some data to the stream. We can do this by using the RESTful API:</p>
<div class="highlight-java"><div class="highlight"><pre>$ curl -w&#39;\n&#39; localhost:10000/v3/namespaces/default/streams/logStream \
-d &#39;93.184.216.34 - - [08/Feb/2015:04:54:14 +0000] &quot;GET /examples/example1 HTTP/1.0&quot; 200 1343488 &quot;http:/example.com/&quot; &quot;Mozilla/5.0 (Windows NT 6.1; rv:33.0) Gecko/20100101 Firefox/33.0&quot;&#39;

$ curl -w&#39;\n&#39; localhost:10000/v3/namespaces/default/streams/logStream \
-d &#39;93.184.216.34 - - [08/Feb/2015:04:54:14 +0000] &quot;GET /examples/example2 HTTP/1.0&quot; 404 34234 &quot;http:/example.com/&quot; &quot;Mozilla/5.0 (Windows NT 6.1; rv:33.0) Gecko/20100101 Firefox/33.0&quot;&#39;

$ curl -w&#39;\n&#39; localhost:10000/v3/namespaces/default/streams/logStream \
-d &#39;93.184.216.34 - - [08/Feb/2015:04:54:14 +0000] &quot;GET /examples/example3 HTTP/1.0&quot; 400 88234 &quot;http:/example.com/&quot; &quot;Mozilla/5.0 (Windows NT 6.1; rv:33.0) Gecko/20100101 Firefox/33.0&quot;&#39;
</pre></div>
</div>
<p>Once the MapReduce has completed, we can then query the aggregated data.
In order to make queries, we need to start the service in the application:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">w</span><span class="sc">&#39;\n&#39;</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="n">localhost</span><span class="o">:</span><span class="mi">10000</span><span class="o">/</span><span class="n">v3</span><span class="o">/</span><span class="n">namespaces</span><span class="o">/</span><span class="k">default</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">StreamDQ</span><span class="o">/</span><span class="n">services</span><span class="o">/</span><span class="n">DataQualityService</span><span class="o">/</span><span class="n">start</span>
</pre></div>
</div>
<p>There are four RESTful endpoints of the service which we can use:</p>
<ul class="simple">
<li>Retrieve all the fields for a given source and time range: <code class="docutils literal"><span class="pre">/v1/sources/{sourceID}/fields</span></code></li>
<li>Retrieve all the aggregations available for a given source, time range, and field:
<code class="docutils literal"><span class="pre">/v1/sources/{sourceID}/fields/{fieldName}/aggregations</span></code></li>
<li>Retrieve the combined aggregation over a specified time interval for a given source, field, and aggregation type:
<code class="docutils literal"><span class="pre">/v1/sources/{sourceID}/fields/{fieldName}/aggregations/{aggregationType}/totals</span></code></li>
<li>Retrieve the aggregation corresponding to each time stamp in a specified time range for a given source, field, and
aggregation type: <code class="docutils literal"><span class="pre">/v1/sources/{sourceID}/fields/{fieldName}/aggregations/{aggregationType}/timeseries</span></code></li>
</ul>
<p>Suppose we want to query the aggregated data for the source <code class="docutils literal"><span class="pre">logStream</span></code> and the field <code class="docutils literal"><span class="pre">status</span></code>.
We would make this request:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">w</span><span class="sc">&#39;\n&#39;</span> <span class="n">http</span><span class="o">:</span><span class="c1">//localhost:10000/v3/namespaces/default/apps/StreamDQ/services/DataQualityService/methods/v1/sources/logStream/fields/status/aggregations/DiscreteValuesHistogram/totals</span>
</pre></div>
</div>
<p>If you use the aforementioned sample Apache Access logs, your response should look like this:</p>
<div class="code json highlight-java"><div class="highlight"><pre><span class="o">{</span>
   <span class="s">&quot;200&quot;</span><span class="o">:</span><span class="mi">1</span><span class="o">,</span>
   <span class="s">&quot;400&quot;</span><span class="o">:</span><span class="mi">1</span><span class="o">,</span>
   <span class="s">&quot;404&quot;</span><span class="o">:</span><span class="mi">1</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="built-in-library-of-aggregation-functions">
<h2>Built-in Library of Aggregation Functions<a class="headerlink" href="#built-in-library-of-aggregation-functions" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Discrete Values Histogram: Generates a histogram that maps various values of a field to corresponding frequencies.
This is only for discrete data.</li>
<li>Histogram With Bucketing: Generates a histogram that maps various values of a field to corresponding frequencies.
This is only for numerical data.</li>
<li>Unique Values: Generates the number of unique values seen for a given field.</li>
<li>Mean: Generates the mean of all the values seen for a given field. This is only for numerical data.</li>
<li>Standard Deviation: Generates the standard deviation of all the values seen for a given field.
This is only for numerical data.</li>
</ul>
</div>
<div class="section" id="extending-the-application">
<h2>Extending the Application<a class="headerlink" href="#extending-the-application" title="Permalink to this headline">¶</a></h2>
<p>In addition to the built-in aggregation functions with the Data Quality Application, it&#8217;s
possible to write and use custom aggregation functions. Take a look at the
<code class="docutils literal"><span class="pre">BasicAggregationFunction.java</span></code> and <code class="docutils literal"><span class="pre">CombinableAggregationFunction.java</span></code> interfaces
under the <code class="docutils literal"><span class="pre">functions</span></code> directory (<code class="docutils literal"><span class="pre">DQApp/src/main/java/data/quality/app/functions</span></code>).</p>
<p>All aggregation functions need to implement the <code class="docutils literal"><span class="pre">BasicAggregationFunction</span></code> interface. If
a function produces aggregations that can be combined (for example, frequencies can be
combined but standard deviations cannot), it should also implement the
<code class="docutils literal"><span class="pre">CombinableAggregationFunction</span></code> interface. This will let you combine existing
aggregations over custom time ranges at query time.</p>
<p>In addition to the these interfaces, take a look at the aggregation functions that come
with the application for reference.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
    
    
    
    
    
    
    
    
    
    
    
    
  <div role="note" aria-label="manuals links">
    <h3><a href="../table-of-contents/../../index.html" rel="nofollow">CDAP Documentation v3.3.5</a></h3>
    <ul class="this-page-menu">
      <li><div class=""></div><a href="../table-of-contents/../../index.html" rel="nofollow">Overview</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../introduction/index.html" rel="nofollow">Introduction to CDAP</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../developers-manual/index.html" rel="nofollow">Developers’ Manual</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../cdap-apps/index.html" rel="nofollow">CDAP Applications</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../admin-manual/index.html" rel="nofollow">Administration Manual</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../integrations/index.html" rel="nofollow">Integrations</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../examples-manual/index.html" rel="nofollow">Examples, Guides, and Tutorials</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../reference-manual/index.html" rel="nofollow">Reference Manual</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../faqs/index.html" rel="nofollow">FAQs</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../reference-manual/release-notes.html" rel="nofollow">Release Notes</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../reference-manual/glossary.html" rel="nofollow">Glossary</a></li>
      <li><div class=""></div><a href="../table-of-contents/../../search.html" rel="nofollow">Search</a></li>
    </ul>
  </div><!--
  Copyright © 2014-2015 Cask Data, Inc.

  Licensed under the Apache License, Version 2.0 (the "License"); you may not
  use this file except in compliance with the License. You may obtain a copy of
  the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
  License for the specific language governing permissions and limitations under
  the License.
-->


    
  <h3 class="pagenavtitle"><a href="../table-of-contents.html">CDAP Applications: Table&nbsp;of&nbsp;Contents</a></h3>
    <nav class="pagenav">
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html"> Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hydrator/index.html"> Cask Hydrator and ETL</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href=""> Data Quality Application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-application">Creating the Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deploying-the-application">Deploying the Application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#end-to-end-example">End-to-End Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#built-in-library-of-aggregation-functions">Built-in Library of Aggregation Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#extending-the-application">Extending the Application</a></li>
</ul>
</li>
</ul>
 
    </nav>
  <h4>Topics</h4>
  <ul>
  <li class="topless"><i>Previous:</i> <a href="../hydrator/upgrade.html"
                        title="Previous Topic">ETL Upgrade Procedure</a></li>
  </ul>
  <div role="note" aria-label="downloads links">
    <h3>Downloads</h3>
    <ul class="this-page-menu">
      <li><a href="http://docs.cask.co/cdap/3.3.5/cdap-docs-3.3.5-web.zip"
            rel="nofollow">Zip Archive of CDAP Documentation</a></li>
    </ul>
   </div>
  
<div id="searchbox" style="display: none" role="search">
  <h3>Quick Search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<div role="note" aria-label="other links">
    <h3><a href="http://docs.cask.co/" target="_blank">Documentation</a></h3>
    <ul class="this-page-menu">
        <li><a href="http://docs.cask.co/cdap/index.html" target="_blank">CDAP</a></li>
        <li><a href="http://docs.cask.co/coopr/index.html" target="_blank">Coopr</a></li>
        <li><a href="http://docs.cask.co/tephra/index.html" target="_blank">Tephra</em></a></li>
        <li><a href="http://docs.cask.co/tigon/index.html" target="_blank">Tigon</a></li>
    </ul>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;margin:0px auto;}
.tg td{padding:0px 20px 0px 20px;border-width:0px;overflow:hidden;word-break:normal;font-weight:normal;}
.tg th{padding:0px 20px 0px 20px;border-width:0px;overflow:hidden;word-break:normal;font-weight:normal;}
.tg .tg-s6z2{text-align:center;}
.tg .tg-0ord{text-align:right;}
.tg a{font-weight:bold;}
</style>
<table class="tg" width= 100%>
  <tr>
    <th class="tg-031e">Previous Topic: 
    <a title="ETL Upgrade Procedure" href="../hydrator/upgrade.html" />ETL Upgrade Procedure</a>&nbsp;&nbsp;
    
    </th>
    <th class="tg-s6z2">
        Copyright &copy; 2014-2016 Cask Data, Inc.
    
    </th>
    <th class="tg-0ord">
    
    </th>
  </tr>
</table>

    </div>
  </body>
</html>