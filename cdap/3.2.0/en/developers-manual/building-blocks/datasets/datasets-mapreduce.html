<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="robots" content="noindex, nofollow">

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Cask Data, Inc." name="author" />
<meta content="Copyright © 2014-2015 Cask Data, Inc." name="copyright" />
<script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-55081520-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    
    <meta name="git_release" content="3.2.0">
    <meta name="git_hash" content="1107c0b599ab647e741c9b5a3defeca2ae42be83">
    <meta name="git_timestamp" content="2015-10-01 20:54:13 -0700">
    <title>Datasets and MapReduce Programs &mdash; Cask Data Application Platform 3.2.0 Documentation</title>
    
    <link rel="stylesheet" href="../../_static/cdap.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    



    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <!-- Amazon SQS Page Usage Logging start-->
    <script type="text/javascript" src="https://sdk.amazonaws.com/js/aws-sdk-2.1.35.min.js"></script>
    <script type="text/javascript" src="http://docs.cask.co/resources/scripts/aws-sqs-1.0.0.js"></script>
    <!-- Amazon SQS Page Usage Logging end-->
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Cask Data Application Platform 3.2.0 Documentation" href="../../index.html" />
    <link rel="up" title="Datasets" href="index.html" />
    <link rel="next" title="Cube Dataset" href="cube.html" />
    <link rel="prev" title="System and Custom Datasets" href="system-custom.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="cube.html" title="Cube Dataset"
             accesskey="N">Next</a> |</li>
        <li class="right" >
          <a href="system-custom.html" title="System and Custom Datasets"
             accesskey="P">Previous</a> |</li>
        
        <script type="text/javascript" src="../../_static/version-menu.js"></script>
        <script src="http://docs.cask.co/cdap/json-versions.js"/></script>
        <script>window.setVersion('3.2.0');</script>
       
        <li><a href="../../table-of-contents.html">CDAP Developers’ Manual</a> &raquo;</li>
          <li><a href="../index.html" >Building Blocks</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Datasets</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="datasets-and-mapreduce-programs">
<span id="datasets-mapreduce-programs"></span><h1>Datasets and MapReduce Programs<a class="headerlink" href="#datasets-and-mapreduce-programs" title="Permalink to this headline">¶</a></h1>
<p>A MapReduce program can interact with a dataset by using it as an input or an output.
The dataset needs to implement specific interfaces to support this.</p>
<p class="rubric">A Dataset as the Input Source of a MapReduce Program</p>
<p>When you run a MapReduce program, you can configure it to read its input from a dataset. The
source dataset must implement the <code class="docutils literal"><span class="pre">BatchReadable</span></code> interface, which requires two methods:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BatchReadable</span><span class="o">&lt;</span><span class="n">KEY</span><span class="o">,</span> <span class="n">VALUE</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Split</span><span class="o">&gt;</span> <span class="nf">getSplits</span><span class="o">();</span>
  <span class="n">SplitReader</span><span class="o">&lt;</span><span class="n">KEY</span><span class="o">,</span> <span class="n">VALUE</span><span class="o">&gt;</span> <span class="nf">createSplitReader</span><span class="o">(</span><span class="n">Split</span> <span class="n">split</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>These two methods complement each other: <code class="docutils literal"><span class="pre">getSplits()</span></code> must return all splits of the dataset
that the MapReduce program will read; <code class="docutils literal"><span class="pre">createSplitReader()</span></code> is then called in every Mapper to
read one of the splits. Note that the <code class="docutils literal"><span class="pre">KEY</span></code> and <code class="docutils literal"><span class="pre">VALUE</span></code> type parameters of the split reader
must match the input key and value type parameters of the Mapper.</p>
<p>Because <code class="docutils literal"><span class="pre">getSplits()</span></code> has no arguments, it will typically create splits that cover the
entire dataset. If you want to use a custom selection of the input data, define another
method in your dataset with additional parameters and explicitly set the input in the
<code class="docutils literal"><span class="pre">beforeSubmit()</span></code> method.</p>
<p>For example, the system dataset <code class="docutils literal"><span class="pre">KeyValueTable</span></code> implements <code class="docutils literal"><span class="pre">BatchReadable&lt;byte[],</span> <span class="pre">byte[]&gt;</span></code>
with an extra method that allows specification of the number of splits and a range of keys:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">KeyValueTable</span> <span class="kd">extends</span> <span class="n">AbstractDataset</span>
                           <span class="kd">implements</span> <span class="n">BatchReadable</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="kt">byte</span><span class="o">[]&gt;</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Split</span><span class="o">&gt;</span> <span class="nf">getSplits</span><span class="o">(</span><span class="kt">int</span> <span class="n">numSplits</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">start</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">stop</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>To read a range of keys and give a hint that you want 16 splits, write:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="nd">@Override</span>
<span class="nd">@UseDataSet</span><span class="o">(</span><span class="s">&quot;myTable&quot;</span><span class="o">)</span>
<span class="n">KeyValueTable</span> <span class="n">kvTable</span><span class="o">;</span>
<span class="o">...</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">beforeSubmit</span><span class="o">(</span><span class="n">MapReduceContext</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="n">context</span><span class="o">.</span><span class="na">setInput</span><span class="o">(</span><span class="s">&quot;myTable&quot;</span><span class="o">,</span> <span class="n">kvTable</span><span class="o">.</span><span class="na">getSplits</span><span class="o">(</span><span class="mi">16</span><span class="o">,</span> <span class="n">startKey</span><span class="o">,</span> <span class="n">stopKey</span><span class="o">));</span>
<span class="o">}</span>
</pre></div>
</div>
<p class="rubric">A Dataset as the Output Destination of a MapReduce Program</p>
<p>Just as you have the option to read input from a dataset, you have the option to write to a dataset as
the output destination of a MapReduce program if that dataset implements the <code class="docutils literal"><span class="pre">BatchWritable</span></code>
interface:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BatchWritable</span><span class="o">&lt;</span><span class="n">KEY</span><span class="o">,</span> <span class="n">VALUE</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">write</span><span class="o">(</span><span class="n">KEY</span> <span class="n">key</span><span class="o">,</span> <span class="n">VALUE</span> <span class="n">value</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">write()</span></code> method is used to redirect all writes performed by a Reducer to the dataset.
Again, the <code class="docutils literal"><span class="pre">KEY</span></code> and <code class="docutils literal"><span class="pre">VALUE</span></code> type parameters must match the output key and value type
parameters of the Reducer.</p>
<p class="rubric">Multiple Output Destinations of a MapReduce Program</p>
<p>To write to multiple output datasets from a MapReduce program, begin by adding the datasets as outputs:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">beforeSubmit</span><span class="o">(</span><span class="n">MapReduceContext</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="n">context</span><span class="o">.</span><span class="na">addOutput</span><span class="o">(</span><span class="s">&quot;productCounts&quot;</span><span class="o">);</span>
  <span class="n">context</span><span class="o">.</span><span class="na">addOutput</span><span class="o">(</span><span class="s">&quot;catalog&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Then, have the <code class="docutils literal"><span class="pre">mapper</span></code> and/or <code class="docutils literal"><span class="pre">reducer</span></code> implement <code class="docutils literal"><span class="pre">ProgramLifeCycle&lt;MapReduceTaskContext&gt;</span></code>.
This is to obtain access to the <code class="docutils literal"><span class="pre">MapReduceTaskContext</span></code> in their initialization methods and
to be able to write using the write method of the <code class="docutils literal"><span class="pre">MapReduceTaskContext</span></code>:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CustomMapper</span> <span class="kd">extends</span> <span class="n">Mapper</span><span class="o">&lt;</span><span class="n">LongWritable</span><span class="o">,</span> <span class="n">Text</span><span class="o">,</span> <span class="n">NullWritable</span><span class="o">,</span> <span class="n">Text</span><span class="o">&gt;</span>
  <span class="kd">implements</span> <span class="n">ProgramLifecycle</span><span class="o">&lt;</span><span class="n">MapReduceTaskContext</span><span class="o">&lt;</span><span class="n">NullWritable</span><span class="o">,</span> <span class="n">Text</span><span class="o">&gt;&gt;</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="n">MapReduceTaskContext</span><span class="o">&lt;</span><span class="n">NullWritable</span><span class="o">,</span> <span class="n">Text</span><span class="o">&gt;</span> <span class="n">mapReduceTaskContext</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">(</span><span class="n">MapReduceTaskContext</span><span class="o">&lt;</span><span class="n">NullWritable</span><span class="o">,</span> <span class="n">Text</span><span class="o">&gt;</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">mapReduceTaskContext</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">map</span><span class="o">(</span><span class="n">LongWritable</span> <span class="n">key</span><span class="o">,</span> <span class="n">Text</span> <span class="n">value</span><span class="o">,</span> <span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="c1">// compute some condition</span>
    <span class="o">...</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">someCondition</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">mapReduceTaskContext</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">&quot;productCounts&quot;</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">mapReduceTaskContext</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">&quot;catalog&quot;</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<p>Note that the multiple output write method—<code class="docutils literal"><span class="pre">MapReduceTaskContext.write(String,</span> <span class="pre">KEY</span> <span class="pre">key,</span> <span class="pre">VALUE</span> <span class="pre">value)</span></code>—can
only be used if there are multiple outputs. Similarly, the single output write
method—<code class="docutils literal"><span class="pre">MapReduceTaskContext.write(KEY</span> <span class="pre">key,</span> <span class="pre">VALUE</span> <span class="pre">value)</span></code>—can only be used if there
is a single output to the MapReduce program.</p>
<p class="rubric">Directly Reading and Writing Datasets</p>
<p>Both CDAP <code class="docutils literal"><span class="pre">mapper</span></code> and <code class="docutils literal"><span class="pre">reducer</span></code> can <a class="reference internal" href="../mapreduce-programs.html#mapreduce-datasets"><span>directly read or write to a dataset</span></a>, similar to the way a flowlet or service can.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div role="note" aria-label="manuals links">
    <h3><a href="../../table-of-contents/../../index.html"
        rel="nofollow">CDAP Documentation v3.2.0</a></h3>
    <ul class="this-page-menu">
      <li><div class=""></div><a href="../../table-of-contents/../../index.html"
            rel="nofollow">Overview</a></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../introduction/index.html"
            rel="nofollow">Introduction to CDAP</a></li>
            
      <li><div class=""></div><b><a href="../../table-of-contents/../../developers-manual/index.html"
            rel="nofollow">Developers’ Manual</a></b></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../included-applications/index.html"
            rel="nofollow">Included Applications</a></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../admin-manual/index.html"
            rel="nofollow">Administration Manual</a></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../integrations/index.html"
            rel="nofollow">Integrations</a></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../examples-manual/index.html"
            rel="nofollow">Examples, Guides, and Tutorials</a></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../reference-manual/index.html"
            rel="nofollow">Reference Manual</a></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../reference-manual/release-notes.html"
            rel="nofollow">Release Notes</a></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../reference-manual/glossary.html"
            rel="nofollow">Glossary</a></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../reference-manual/faq.html"
            rel="nofollow">FAQ</a></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../search.html"
            rel="nofollow">Search</a></li>
    </ul>
   </div><!--
  Copyright © 2014-2015 Cask Data, Inc.

  Licensed under the Apache License, Version 2.0 (the "License"); you may not
  use this file except in compliance with the License. You may obtain a copy of
  the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
  License for the specific language governing permissions and limitations under
  the License.
-->


    
<h3 class="pagenavtitle"><a href="../../table-of-contents.html">Developers’ Manual: Table&nbsp;of&nbsp;Contents</a></h3>
<nav class="pagenav">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html"> Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.html"> Getting Started Developing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html"> Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html"> Building Blocks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../core.html"> Core Abstractions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../applications.html"> Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../streams.html"> Streams</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html"> Datasets</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="table.html"> Table API</a></li>
<li class="toctree-l3"><a class="reference internal" href="fileset.html">FileSet Dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="fileset.html#partitionedfileset">PartitionedFileSet</a></li>
<li class="toctree-l3"><a class="reference internal" href="fileset.html#timepartitionedfileset">TimePartitionedFileSet</a></li>
<li class="toctree-l3"><a class="reference internal" href="system-custom.html"> System and Custom Datasets</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href=""> Datasets and MapReduce</a></li>
<li class="toctree-l3"><a class="reference internal" href="cube.html"> Cube Dataset</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../flows-flowlets/index.html"> Flows and Flowlets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mapreduce-programs.html"> MapReduce Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../schedules.html"> Schedules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services.html"> Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spark-programs.html"> Spark Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workers.html"> Workers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflows.html"> Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins.html"> Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../artifacts.html"> Artifacts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metadata-lineage.html"> Metadata and Lineage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../namespaces.html"> Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../transaction-system.html"> Transaction System</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html"> Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/index.html"> Testing and Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ingesting-tools/index.html"> Ingesting Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data-exploration/index.html"> Data Exploration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced/index.html"> Advanced Topics</a></li>
</ul>

</nav>
  <h4>Previous Topic</h4>
  <p class="topless"><a href="system-custom.html"
                        title="Previous Chapter">System and Custom Datasets</a></p>
  <h4>Next Topic</h4>
  <p class="topless"><a href="cube.html"
                        title="Next Chapter">Cube Dataset</a></p>
  <div role="note" aria-label="downloads links">
    <h3>Downloads</h3>
    <ul class="this-page-menu">
      <li><a href="http://docs.cask.co/cdap/3.2.0/cdap-docs-3.2.0-web.zip"
            rel="nofollow">Zip Archive of CDAP Documentation</a></li>
    </ul>
   </div>
  
<div id="searchbox" style="display: none" role="search">
  <h3>Quick Search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<div role="note" aria-label="other links">
    <h3><a href="http://docs.cask.co/" target="_blank">Documentation</a></h3>
    <ul class="this-page-menu">
        <li><a href="http://docs.cask.co/cdap/index.html" target="_blank">CDAP</a></li>
        <li><a href="http://docs.cask.co/coopr/index.html" target="_blank">Coopr</a></li>
        <li><a href="http://docs.cask.co/tephra/index.html" target="_blank">Tephra</em></a></li>
        <li><a href="http://docs.cask.co/tigon/index.html" target="_blank">Tigon</a></li>
    </ul>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;margin:0px auto;}
.tg td{padding:0px 20px 0px 20px;border-width:0px;overflow:hidden;word-break:normal;font-weight:normal;}
.tg th{padding:0px 20px 0px 20px;border-width:0px;overflow:hidden;word-break:normal;font-weight:normal;}
.tg .tg-s6z2{text-align:center;}
.tg .tg-0ord{text-align:right;}
.tg a{font-weight:bold;}
</style>
<table class="tg" width= 100%>
  <tr>
    <th class="tg-031e">Previous Topic: 
    <a title="System and Custom Datasets" href="system-custom.html" />System and Custom Datasets</a>&nbsp;&nbsp;
    
    </th>
    <th class="tg-s6z2">
        Copyright &copy; 2014-2015 Cask Data, Inc.
    
    </th>
    <th class="tg-0ord">&nbsp;&nbsp;Next Topic:
    <a title="Cube Dataset" href="cube.html" />Cube Dataset</a>
    
    </th>
  </tr>
</table>

    </div>
  </body>
</html>