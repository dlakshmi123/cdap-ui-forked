<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="robots" content="noindex, nofollow">

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Cask Data, Inc." name="author" />
<meta content="Copyright © 2015 Cask Data, Inc." name="copyright" />
<script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-55081520-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    
    <meta name="git_release" content="3.2.0">
    <meta name="git_hash" content="1107c0b599ab647e741c9b5a3defeca2ae42be83">
    <meta name="git_timestamp" content="2015-10-01 20:54:13 -0700">
    <title>Transaction Service Maintenance &mdash; Cask Data Application Platform 3.2.0 Documentation</title>
    
    <link rel="stylesheet" href="../_static/cdap.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    



    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <!-- Amazon SQS Page Usage Logging start-->
    <script type="text/javascript" src="https://sdk.amazonaws.com/js/aws-sdk-2.1.35.min.js"></script>
    <script type="text/javascript" src="http://docs.cask.co/resources/scripts/aws-sqs-1.0.0.js"></script>
    <!-- Amazon SQS Page Usage Logging end-->
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Cask Data Application Platform 3.2.0 Documentation" href="../index.html" />
    <link rel="up" title="Operations" href="index.html" />
    <link rel="next" title="Troubleshooting CDAP" href="troubleshooting.html" />
    <link rel="prev" title="Master Service Logging Configuration" href="logback.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="troubleshooting.html" title="Troubleshooting CDAP"
             accesskey="N">Next</a> |</li>
        <li class="right" >
          <a href="logback.html" title="Master Service Logging Configuration"
             accesskey="P">Previous</a> |</li>
        
        <script type="text/javascript" src="../_static/version-menu.js"></script>
        <script src="http://docs.cask.co/cdap/json-versions.js"/></script>
        <script>window.setVersion('3.2.0');</script>
       
        <li><a href="../table-of-contents.html">CDAP Administration Manual</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Operations</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="transaction-service-maintenance">
<span id="tx-maintenance"></span><h1>Transaction Service Maintenance<a class="headerlink" href="#transaction-service-maintenance" title="Permalink to this headline">¶</a></h1>
<p>The Transaction Service keeps track of all invalid transactions so as to exclude their writes from all future reads.
Over time, this <em>invalid</em> list can grow and lead to performance degradation. To avoid that, you can prune the <em>invalid</em>
list after the data of invalid transactions has been removed—the removal of which happens during major HBase
compactions of the transactional tables.</p>
<p>To prune the invalid list manually, follow these steps:</p>
<ul>
<li><p class="first">Run a major compaction on all CDAP transactional tables.</p>
</li>
<li><p class="first">Find the minimum transaction state cache reload time across all region servers before the major compaction started.
This can be done by grepping for <code class="docutils literal"><span class="pre">Transaction</span> <span class="pre">state</span> <span class="pre">reloaded</span> <span class="pre">with</span> <span class="pre">snapshot</span></code> in the HBase region server logs.</p>
<p>This should give lines such as:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">15/08/22 00:22:34 INFO coprocessor.TransactionStateCache: Transaction state reloaded with snapshot from 1440202895873</span>
<span class="go">15/08/22 00:22:42 INFO coprocessor.TransactionStateCache: Transaction state reloaded with snapshot from 1440202956306</span>
<span class="go">15/08/22 00:22:44 INFO coprocessor.TransactionStateCache: Transaction state reloaded with snapshot from 1440202956306</span>
<span class="go">15/08/22 00:22:47 INFO coprocessor.TransactionStateCache: Transaction state reloaded with snapshot from 1440202956306</span>
<span class="go">15/08/22 00:23:34 INFO coprocessor.TransactionStateCache: Transaction state reloaded with snapshot from 1440202956306</span>
</pre></div>
</div>
<p>Pick the minimum time across all region servers. In this case, <code class="docutils literal"><span class="pre">1440202895873</span></code>.</p>
</li>
<li><p class="first">Find the minimum prune time across all queues by running the tool <code class="docutils literal"><span class="pre">SimpleHBaseQueueDebugger</span></code>. This should print lines such as:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> /opt/cdap/master/bin/svc-master run co.cask.cdap.data.tools.SimpleHBaseQueueDebugger
<span class="go">Results for queue queue:///ns1/WordCount/WordCounter/counter/queue: min tx timestamp: 1440198510309</span>
<span class="go">Results for queue queue:///ns1/WordCount/WordCounter/splitter/wordArrayOut: min tx timestamp: 1440198510280</span>
<span class="go">Results for queue queue:///ns2/WordCount/WordCounter/counter/queue: min tx timestamp: n/a</span>
<span class="go">Results for queue queue:///ns2/WordCount/WordCounter/splitter/wordArrayOut: min tx timestamp: n/a</span>
<span class="go">Results for queue queue:///default/WordCount/WordCounter/counter/queue: min tx timestamp: 1440194184568</span>
<span class="go">Results for queue queue:///default/WordCount/WordCounter/splitter/wordArrayOut: min tx timestamp: 1440194184476</span>
<span class="go">Results for queue queue:///default/WordCount/WordCounter/splitter/wordOut: min tx timestamp: 1440194184476</span>
<span class="go">Total results for all queues: min tx timestamp: 1440194184476</span>
</pre></div>
</div>
<p>Pick the timestamp from the line <code class="docutils literal"><span class="pre">Total</span> <span class="pre">results</span> <span class="pre">for</span> <span class="pre">all</span> <span class="pre">queues</span></code>. In this case, <code class="docutils literal"><span class="pre">1440194184476</span></code>.</p>
</li>
<li><p class="first">Get the minimum time from the above two steps, let this be time <code class="docutils literal"><span class="pre">t</span></code>. In this case, <code class="docutils literal"><span class="pre">1440194184476</span></code>.</p>
</li>
</ul>
<p>Now, the invalid transaction list can be safely pruned
until <code class="docutils literal"><span class="pre">(t</span> <span class="pre">-</span> <span class="pre">1</span> <span class="pre">day)</span></code> using <a class="reference external" href="../source/../../reference-manual/http-restful-api/transactions.html#http-restful-api-transactions-truncate" title="(in Cask Data Application Platform v3.2.0)"><span class="xref std std-ref">a call</span></a>
with the <a class="reference external" href="../source/../../reference-manual/http-restful-api/transactions.html#http-restful-api-transactions-truncate" title="(in Cask Data Application Platform v3.2.0)"><span class="xref std std-ref">Transaction Service HTTP RESTful API</span></a>.</p>
<p>The current length of the invalid transaction list can be obtained using
<a class="reference external" href="../source/../../reference-manual/http-restful-api/transactions.html#http-restful-api-transactions-number" title="(in Cask Data Application Platform v3.2.0)"><span class="xref std std-ref">a call</span></a>
with the <a class="reference external" href="../source/../../reference-manual/http-restful-api/transactions.html#http-restful-api-transactions-number" title="(in Cask Data Application Platform v3.2.0)"><span class="xref std std-ref">Transaction Service HTTP RESTful API</span></a>.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div role="note" aria-label="manuals links">
    <h3><a href="../table-of-contents/../../index.html"
        rel="nofollow">CDAP Documentation v3.2.0</a></h3>
    <ul class="this-page-menu">
      <li><div class=""></div><a href="../table-of-contents/../../index.html"
            rel="nofollow">Overview</a></li>
            
      <li><div class=""></div><a href="../table-of-contents/../../introduction/index.html"
            rel="nofollow">Introduction to CDAP</a></li>
            
      <li><div class=""></div><a href="../table-of-contents/../../developers-manual/index.html"
            rel="nofollow">Developers’ Manual</a></li>
            
      <li><div class=""></div><a href="../table-of-contents/../../included-applications/index.html"
            rel="nofollow">Included Applications</a></li>
            
      <li><div class=""></div><b><a href="../table-of-contents/../../admin-manual/index.html"
            rel="nofollow">Administration Manual</a></b></li>
            
      <li><div class=""></div><a href="../table-of-contents/../../integrations/index.html"
            rel="nofollow">Integrations</a></li>
            
      <li><div class=""></div><a href="../table-of-contents/../../examples-manual/index.html"
            rel="nofollow">Examples, Guides, and Tutorials</a></li>
            
      <li><div class=""></div><a href="../table-of-contents/../../reference-manual/index.html"
            rel="nofollow">Reference Manual</a></li>
            
      <li><div class=""></div><a href="../table-of-contents/../../reference-manual/release-notes.html"
            rel="nofollow">Release Notes</a></li>
            
      <li><div class=""></div><a href="../table-of-contents/../../reference-manual/glossary.html"
            rel="nofollow">Glossary</a></li>
            
      <li><div class=""></div><a href="../table-of-contents/../../reference-manual/faq.html"
            rel="nofollow">FAQ</a></li>
            
      <li><div class=""></div><a href="../table-of-contents/../../search.html"
            rel="nofollow">Search</a></li>
    </ul>
   </div><!--
  Copyright © 2014-2015 Cask Data, Inc.

  Licensed under the Apache License, Version 2.0 (the "License"); you may not
  use this file except in compliance with the License. You may obtain a copy of
  the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
  License for the specific language governing permissions and limitations under
  the License.
-->


    
<h3 class="pagenavtitle"><a href="../table-of-contents.html">Administration Manual:<br> Table&nbsp;of&nbsp;Contents</a></h3>
<nav class="pagenav">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html"> Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html"> Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html"> Operations</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="logging.html"> Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics.html"> Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="monitoring.html"> Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="preferences.html"> Preferences and Runtime Arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="scaling-instances.html"> Scaling Instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="resource-guarantees.html"> Resource Guarantees in YARN</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdap-ui.html"> CDAP UI</a></li>
<li class="toctree-l2"><a class="reference internal" href="logback.html"> Master Services Logback</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href=""> Transaction Service Maintenance</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html"> Troubleshooting</a></li>
</ul>
</li>
</ul>

</nav>
  <h4>Previous Topic</h4>
  <p class="topless"><a href="logback.html"
                        title="Previous Chapter">Master Service Logging Configuration</a></p>
  <h4>Next Topic</h4>
  <p class="topless"><a href="troubleshooting.html"
                        title="Next Chapter">Troubleshooting CDAP</a></p>
  <div role="note" aria-label="downloads links">
    <h3>Downloads</h3>
    <ul class="this-page-menu">
      <li><a href="http://docs.cask.co/cdap/3.2.0/cdap-docs-3.2.0-web.zip"
            rel="nofollow">Zip Archive of CDAP Documentation</a></li>
    </ul>
   </div>
  
<div id="searchbox" style="display: none" role="search">
  <h3>Quick Search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<div role="note" aria-label="other links">
    <h3><a href="http://docs.cask.co/" target="_blank">Documentation</a></h3>
    <ul class="this-page-menu">
        <li><a href="http://docs.cask.co/cdap/index.html" target="_blank">CDAP</a></li>
        <li><a href="http://docs.cask.co/coopr/index.html" target="_blank">Coopr</a></li>
        <li><a href="http://docs.cask.co/tephra/index.html" target="_blank">Tephra</em></a></li>
        <li><a href="http://docs.cask.co/tigon/index.html" target="_blank">Tigon</a></li>
    </ul>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;margin:0px auto;}
.tg td{padding:0px 20px 0px 20px;border-width:0px;overflow:hidden;word-break:normal;font-weight:normal;}
.tg th{padding:0px 20px 0px 20px;border-width:0px;overflow:hidden;word-break:normal;font-weight:normal;}
.tg .tg-s6z2{text-align:center;}
.tg .tg-0ord{text-align:right;}
.tg a{font-weight:bold;}
</style>
<table class="tg" width= 100%>
  <tr>
    <th class="tg-031e">Previous Topic: 
    <a title="Master Service Logging Configuration" href="logback.html" />Master Service Logging Configuration</a>&nbsp;&nbsp;
    
    </th>
    <th class="tg-s6z2">
        Copyright &copy; 2014-2015 Cask Data, Inc.
    
    </th>
    <th class="tg-0ord">&nbsp;&nbsp;Next Topic:
    <a title="Troubleshooting CDAP" href="troubleshooting.html" />Troubleshooting CDAP</a>
    
    </th>
  </tr>
</table>

    </div>
  </body>
</html>