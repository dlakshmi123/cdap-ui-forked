<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="robots" content="noindex, nofollow">

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-55081520-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <title>Getting Started with the Cask Data Application Platform &mdash; Cask Data Application Platform 2.5.1 Documentation</title>
    
    <link rel="stylesheet" href="_static/cdap.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.5.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Cask Data Application Platform 2.5.1 Documentation" href="index.html" />
    <link rel="next" title="CDAP Application Case Study" href="case_study.html" />
    <link rel="prev" title="Introduction to the Cask Data Application Platform" href="intro.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="case_study.html" title="CDAP Application Case Study"
             accesskey="N">Next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="Introduction to the Cask Data Application Platform"
             accesskey="P">Previous</a> |</li>
        <li><a href="index.html">Cask Data Application Platform 2.5.1 Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="getting-started-with-the-cask-data-application-platform">
<span id="get-started"></span><h1>Getting Started with the Cask Data Application Platform<a class="headerlink" href="#getting-started-with-the-cask-data-application-platform" title="Permalink to this headline">¶</a></h1>
<p>This chapter is a guide to help you get started with CDAP. At the end of this topic, you
will have the CDAP SDK up and running in your development environment, and you will have
built, deployed, and run a sample application.</p>
<div class="section" id="introduction-to-the-cdap-sdk">
<h2>Introduction to the CDAP SDK<a class="headerlink" href="#introduction-to-the-cdap-sdk" title="Permalink to this headline">¶</a></h2>
<p>The CDAP Software Development Kit (SDK) is all that is needed to develop CDAP applications
in your development environment, either your laptop or a work station. It includes:</p>
<ul class="simple">
<li>A Standalone CDAP that can run on a single machine in a single JVM. It provides all of
the CDAP APIs without requiring a Hadoop cluster, using alternative, fully functional
implementations of CDAP features. For example, application containers are implemented as
Java threads instead of YARN containers.</li>
<li>The CDAP Console, a web-based graphical user interface to interact with the Standalone CDAP
and the applications it runs.</li>
<li>The complete CDAP documentation, including this document and the Javadocs for the CDAP APIs.</li>
<li>A set of tools, datasets and example applications that help you get familiar with CDAP, and
can also serve as templates for developing your own applications.</li>
</ul>
<div class="section" id="system-requirements-and-dependencies">
<h3>System Requirements and Dependencies<a class="headerlink" href="#system-requirements-and-dependencies" title="Permalink to this headline">¶</a></h3>
<p>The CDAP SDK runs on Linux, MacOS and Windows, and only has three requirements:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">JDK 6 or JDK 7</a>
(required to run CDAP; note that $JAVA_HOME should be set)</li>
<li><a class="reference external" href="http://nodejs.org">Node.js 0.8.16+</a> (required to run the CDAP Console UI)</li>
<li><a class="reference external" href="http://maven.apache.org">Apache Maven 3.0+</a> (required to build CDAP applications)</li>
</ul>
</div>
</div>
<div class="section" id="download-and-setup">
<h2>Download and Setup<a class="headerlink" href="#download-and-setup" title="Permalink to this headline">¶</a></h2>
<p>There are three ways to download the CDAP SDK:</p>
<ul class="simple">
<li>as a <a class="reference internal" href="#binary-zip-file">binary zip file</a>;</li>
<li>as a <a class="reference external" href="#cdap-standalone-virtual-machine-image">Virtual Machine image</a>; or</li>
<li>as a <a class="reference external" href="#cdap-standalone-docker-image">Docker image</a>.</li>
</ul>
<p>If you already have a development environment setup, the zip file is your easiest solution.</p>
<p>If you don&#8217;t have a development environment, the Virtual Machine offers a pre-configured
environment with CDAP pre-installed and that automatically starts applications so that you
can be productive immediately. You can build your own projects or follow the provided
example applications.</p>
<p>The Docker image is intended for those developing on Linux.</p>
<div class="section" id="binary-zip-file">
<h3>Binary Zip File<a class="headerlink" href="#binary-zip-file" title="Permalink to this headline">¶</a></h3>
<p>The <strong>zip file</strong> is available on the Downloads section of the Cask Website at <a class="reference external" href="http://cask.co/downloads">http://cask.co/downloads</a>.
Click the link marked &#8220;SDK&#8221; of the <em>Software Development Kit (SDK).</em></p>
<p>Once downloaded, unzip it to a directory on your machine:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> unzip cdap-sdk-2.5.1.zip
</pre></div>
</div>
</div>
<div class="section" id="cdap-standalone-virtual-machine-image">
<h3>CDAP Standalone Virtual Machine Image<a class="headerlink" href="#cdap-standalone-virtual-machine-image" title="Permalink to this headline">¶</a></h3>
<p>To use the <strong>Virtual Machine image</strong>:</p>
<ul class="simple">
<li>Download and install either <a class="reference external" href="https://www.virtualbox.org">Oracle VirtualBox</a> or
<a class="reference external" href="http://www.vmware.com/products/player">VMWare</a> player to your environment.</li>
<li>Download the CDAP Standalone Virtual Machine (<em>Standalone VM</em>) at <a class="reference external" href="http://cask.co/downloads">http://cask.co/downloads</a>.</li>
<li>Import the downloaded <tt class="docutils literal"><span class="pre">.ova</span></tt> file into either the VirtualBox or VMWare Player.</li>
</ul>
<p>The CDAP Standalone Virtual Machine is configured with the recommended settings for Standalone CDAP:</p>
<ul class="simple">
<li>4 GB of RAM</li>
<li>Ubuntu Desktop Linux</li>
<li>10 GB of disk space</li>
</ul>
<p>It has pre-installed all the software that you need to run and develop CDAP applications:</p>
<ul class="simple">
<li>Java JDK 7 and Node.js are both installed.</li>
<li>Maven is installed and configured to work for CDAP.</li>
<li>The Standalone CDAP SDK is installed under <tt class="docutils literal"><span class="pre">/Software/cdap-sdk-2.5.1</span></tt>
and will automatically start when the virtual machine starts.</li>
<li>Both IntelliJ and Eclipse IDE are installed and will start when the virtual machine starts.</li>
<li>The Firefox web browser starts when the machine starts. Its default home page is the CDAP Console,
<tt class="docutils literal"><span class="pre">http://localhost:9999</span></tt>.</li>
</ul>
<p>No password is required to enter the virtual machine; however, should you need to install or
remove software, the admin user and password are both <tt class="docutils literal"><span class="pre">cdap</span></tt>.</p>
</div>
<div class="section" id="cdap-standalone-docker-image">
<span id="docker"></span><h3>CDAP Standalone Docker Image<a class="headerlink" href="#cdap-standalone-docker-image" title="Permalink to this headline">¶</a></h3>
<p>A Docker image with CDAP pre-installed is available on the Docker Hub for download.</p>
<p>To use the <strong>Docker image</strong>:</p>
<ul>
<li><p class="first">Docker is available for a variety of platforms. Download and install Docker in your environment by
following the <a class="reference external" href="https://docs.docker.com/installation">platform-specific installation instructions</a>
from <a class="reference external" href="https://docker.com">Docker.com</a> to verify that Docker is working and has
started correctly.</p>
<p>If you are not running on Linux, you need to start the Docker Virtual Machine (VM) before you
can use containers. For example, on MacOS, use:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> boot2docker start
<span class="gp">$</span> boot2docker ip
</pre></div>
</div>
<p>to determine the Docker VM&#8217;s IP address. You will need to use that address as the host
name when either connecting to the Console or making an HTTP request.</p>
<p>When you run boot2docker start, it will print a message on the screen similar to:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">To connect the Docker client to the Docker daemon, please set:</span>
<span class="go">export DOCKER_HOST=tcp://192.168.59.103:2375</span>
</pre></div>
</div>
<p>It is essential to run this export command. Otherwise, subsequent Docker commands will
fail because they can&#8217;t tell how to connect to the Docker VM.</p>
</li>
<li><p class="first">Once Docker has started, pull down the <em>CDAP Docker Image</em> from the Docker hub using:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> docker pull caskdata/cdap-standalone
</pre></div>
</div>
</li>
<li><p class="first">Start the <em>Docker CDAP Virtual Machine</em> with:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> docker run -t -i -p 9999:9999 -p 10000:10000 caskdata/cdap-standalone
</pre></div>
</div>
</li>
<li><p class="first">CDAP will start automatically once the CDAP Virtual Machine starts. CDAP’s Software
Directory is under <tt class="docutils literal"><span class="pre">/Software/cdap-sdk-2.5.1</span></tt>.</p>
</li>
<li><p class="first">Once CDAP starts, it will instruct you to connect to the CDAP Console with a web browser
at <tt class="docutils literal"><span class="pre">http://&lt;virtual-hostname&gt;:9999</span></tt>, such as <tt class="docutils literal"><span class="pre">http://6f0162922c37:9999</span></tt>. Replace
<tt class="docutils literal"><span class="pre">&lt;virtual-hostname&gt;</span></tt> with the Docker VM&#8217;s IP address you obtained earlier. Start a browser
and enter the address to access the CDAP Console.</p>
</li>
<li><p class="first">In order to begin building CDAP applications, have our <a class="reference external" href="#system-requirements-and-dependencies">recommended software and tools</a> installed in your environment.</p>
</li>
<li><p class="first">For a full list of Docker Commands, see the <a class="reference external" href="https://docs.docker.com/reference/commandline/cli/">Docker Command Line Documentation.</a></p>
</li>
</ul>
</div>
<div class="section" id="starting-and-stopping-the-standalone-cdap">
<h3>Starting and Stopping the Standalone CDAP<a class="headerlink" href="#starting-and-stopping-the-standalone-cdap" title="Permalink to this headline">¶</a></h3>
<p>Use the <tt class="docutils literal"><span class="pre">cdap.sh</span></tt> script to start and stop the Standalone CDAP
(the location will vary depending on where the CDAP SDK is installed):</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd </span>cdap-sdk-2.5.1
<span class="gp">$</span> ./bin/cdap.sh start
<span class="go">...</span>
<span class="gp">$</span> ./bin/cdap.sh stop
</pre></div>
</div>
<p>Or, if you are using Windows, use the batch script <tt class="docutils literal"><span class="pre">cdap.bat</span></tt> to start and stop the SDK.</p>
<p>Note that starting CDAP is not necessary if you use either the Virtual Machine or the
Docker image, as they both start the Standalone CDAP automatically on startup.</p>
<p>Once CDAP is started successfully, in a web browser you will be able to see the CDAP
Console running at <tt class="docutils literal"><span class="pre">localhost:9999</span></tt>, where you can deploy example applications and
interact with CDAP. Note that in the case of the Docker image, you will need to substitute
the Docker VM&#8217;s IP address for <tt class="docutils literal"><span class="pre">localhost</span></tt> in the web browser address bar.</p>
</div>
</div>
<div class="section" id="creating-an-application">
<h2>Creating an Application<a class="headerlink" href="#creating-an-application" title="Permalink to this headline">¶</a></h2>
<p>The best way to start developing a CDAP application is by using the Maven archetype:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> mvn archetype:generate <span class="se">\</span>
<span class="go">  -DarchetypeGroupId=co.cask.cdap \</span>
<span class="go">  -DarchetypeArtifactId=cdap-app-archetype \</span>
<span class="go">  -DarchetypeVersion=2.5.1</span>
</pre></div>
</div>
<p>This creates a Maven project with all required dependencies, Maven plugins, and a simple
application template for the development of your application. You can import this Maven project
into your preferred IDE—such as Eclipse or IntelliJ—and start developing your first
CDAP application.</p>
</div>
<div class="section" id="first-steps">
<h2>First Steps<a class="headerlink" href="#first-steps" title="Permalink to this headline">¶</a></h2>
<p>Before you start developing your own applications, it is recommended that you familiarize yourself with the
APIs and concepts of CDAP as well as the CDAP Console using the example applications that are provided
with the SDK. Let&#8217;s take a look at one of these:</p>
<div class="section" id="web-analytics-application">
<span id="web-analytics"></span><h3>Web Analytics Application<a class="headerlink" href="#web-analytics-application" title="Permalink to this headline">¶</a></h3>
<p>This tutorial provides the basic steps for the development of a data application using the
Cask Data Application Platform (CDAP). We will use a Web Analytics Application to
demonstrate how to develop with CDAP and how CDAP helps when building data applications
that run in the Hadoop ecosystem.</p>
<p>Web analytics applications are commonly used to generate statistics and to provide insights
about web usage through the analysis of web traffic. A typical web analytics application
consists of three components:</p>
<ul class="simple">
<li><strong>Data Collection</strong> - Collects and persists web logs for further processing;</li>
<li><strong>Data Analysis</strong> - Analyses the collected data and produces different measurements; and</li>
<li><strong>Insights Discovery</strong> - Extracts insights from the analysis results.</li>
</ul>
<p>Additionally, it&#8217;s important that the application be scalable, fault tolerant, and
easy-to-operate. It needs to support ever-increasing amounts of data as well as be flexible
in its design to accomodate new application requirements.</p>
<p>In this tutorial, we&#8217;ll show how easy it is to build a web analytics application with CDAP.
In particular, we&#8217;ll use these CDAP components:</p>
<ul class="simple">
<li>A <strong>Stream</strong> for web server log collection and persistence to the file system;</li>
<li>A <strong>Flow</strong> for real-time data analysis over collected logs; and</li>
<li><strong>SQL Queries</strong> to explore and develop insights from the data.</li>
</ul>
</div>
<div class="section" id="build-and-run">
<h3>Build and Run<a class="headerlink" href="#build-and-run" title="Permalink to this headline">¶</a></h3>
<p>The source code of the Web Analytics Application for this tutorial is included in the CDAP SDK,
inside the <tt class="docutils literal"><span class="pre">examples/WebAnalytics</span></tt> directory.</p>
<p>When the Standalone CDAP instance is running, you can build and start the Web Analytics Application
with these commands, executed from the <tt class="docutils literal"><span class="pre">examples/WebAnalytics</span></tt> directory of the SDK:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> mvn package
<span class="gp">$</span> bin/app-manager.sh --action deploy
<span class="gp">$</span> bin/app-manager.sh --action start
</pre></div>
</div>
<p>On Windows, run these instead:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">&gt;</span> mvn package
<span class="gp">&gt;</span> bin<span class="se">\a</span>pp-manager.bat deploy
<span class="gp">&gt;</span> bin<span class="se">\a</span>pp-manager.bat start
</pre></div>
</div>
</div>
<div class="section" id="how-it-works">
<h3>How It Works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h3>
<p>In this section, we will go through the details about how to develop the Web Analytics Application using CDAP.</p>
<div class="section" id="data-collection-with-a-stream">
<h4>Data Collection with a Stream<a class="headerlink" href="#data-collection-with-a-stream" title="Permalink to this headline">¶</a></h4>
<p>The sole data source that the Web Analytics Application uses is web server logs. Log events are ingested to
a <strong>Stream</strong> called <tt class="docutils literal"><span class="pre">log</span></tt> using the RESTful API provided by CDAP.</p>
<p>To ingest a log event, you can use the <tt class="docutils literal"><span class="pre">curl</span></tt> command (the example shown has been broken into two lines to fit):</p>
<div class="highlight-console"><div class="highlight"><pre>$ curl -d &#39;192.168.252.135 - - [14/Jan/2014:00:12:51 -0400] &quot;GET /products HTTP/1.1&quot; 500 182
     &quot;http://www.example.org&quot; &quot;Mozilla/5.0&quot;&#39; http://localhost:10000/v2/streams/log
</pre></div>
</div>
<p>This sends the log event (formatted in the Common Log Format or CLF) to the CDAP instance located at
<tt class="docutils literal"><span class="pre">localhost</span></tt> and listening on port <tt class="docutils literal"><span class="pre">10000</span></tt>.</p>
<p>The Application includes sample logs, located in <tt class="docutils literal"><span class="pre">test/resources/access.log</span></tt> that you can inject by running
a provided script:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> bin/inject-data.sh
</pre></div>
</div>
<p>On Windows:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> bin/inject-data.bat
</pre></div>
</div>
<p>Once an event is ingested into a Stream, it is persisted and available for processing.</p>
</div>
<div class="section" id="data-analysis-using-a-flow">
<h4>Data Analysis using a Flow<a class="headerlink" href="#data-analysis-using-a-flow" title="Permalink to this headline">¶</a></h4>
<p>The Web Analytics Application uses a <strong>Flow</strong>, the real-time data processor in CDAP,
to produce real-time analytics from the web server logs. A <strong>Flow</strong> contains one or more
<strong>Flowlets</strong> that are wired together into a directed acyclic graph or DAG.</p>
<p>To keep the example simple, we only compute the total visit count for each IP visiting the site.
We use a Flowlet called <tt class="docutils literal"><span class="pre">UniqueVisitor</span></tt> to keep track of the unique visit counts from each client.
It is done in three steps:</p>
<ol class="arabic simple">
<li>Read a log event from the <tt class="docutils literal"><span class="pre">log</span></tt> Stream;</li>
<li>Parse the client IP from the log event; and</li>
<li>Increment the visit count of that client IP by 1 and persist the change.</li>
</ol>
<p>The result of the increment is persisted to a custom <strong>Dataset</strong> <tt class="docutils literal"><span class="pre">UniqueVisitCount</span></tt>.</p>
<p>Here is what the <tt class="docutils literal"><span class="pre">UniqueVisitor</span></tt> Flowlet looks like:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UniqueVisitor</span> <span class="kd">extends</span> <span class="n">AbstractFlowlet</span> <span class="o">{</span>

  <span class="c1">// Request an instance of the UniqueVisitCount Dataset</span>
  <span class="nd">@UseDataSet</span><span class="o">(</span><span class="s">&quot;UniqueVisitCount&quot;</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">UniqueVisitCount</span> <span class="n">table</span><span class="o">;</span>

  <span class="nd">@ProcessInput</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">StreamEvent</span> <span class="n">streamEvent</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Decode the log line as a String</span>
    <span class="n">String</span> <span class="n">event</span> <span class="o">=</span> <span class="n">Charset</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&quot;UTF-8&quot;</span><span class="o">).</span><span class="na">decode</span><span class="o">(</span><span class="n">streamEvent</span><span class="o">.</span><span class="na">getBody</span><span class="o">()).</span><span class="na">toString</span><span class="o">();</span>

    <span class="c1">// The first entry in the log event is the IP address</span>
    <span class="n">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">event</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="sc">&#39; &#39;</span><span class="o">));</span>

    <span class="c1">// Increment the visit count of a given IP by 1</span>
    <span class="n">table</span><span class="o">.</span><span class="na">increment</span><span class="o">(</span><span class="n">ip</span><span class="o">,</span> <span class="mi">1L</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">UniqueVisitorCount</span></tt> Dataset provides an abstraction of the data logic for incrementing the visit count for a
given IP. It exposes an <tt class="docutils literal"><span class="pre">increment</span></tt> method, implemented as:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * Performs increments of the visit count of the given IP.</span>
<span class="cm"> *</span>
<span class="cm"> * @param ip The IP to increment</span>
<span class="cm"> * @param amount The amount to increment</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">(</span><span class="n">String</span> <span class="n">ip</span><span class="o">,</span> <span class="kt">long</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// Delegates to the system KeyValueTable for the actual storage operation</span>
  <span class="n">keyValueTable</span><span class="o">.</span><span class="na">increment</span><span class="o">(</span><span class="n">Bytes</span><span class="o">.</span><span class="na">toBytes</span><span class="o">(</span><span class="n">ip</span><span class="o">),</span> <span class="n">amount</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The complete source code of the <tt class="docutils literal"><span class="pre">UniqueVisitorCount</span></tt> class can be found in the example in
<tt class="docutils literal"><span class="pre">src/main/java/co/cask/cdap/examples/webanalytics/UniqueVisitCount.java</span></tt></p>
<p>To connect the <tt class="docutils literal"><span class="pre">UniqueVisitor</span></tt> Flowlet to read from the <tt class="docutils literal"><span class="pre">log</span></tt> Stream, we define a <tt class="docutils literal"><span class="pre">WebAnalyticsFlow</span></tt> class
that specifies the Flow:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebAnalyticsFlow</span> <span class="kd">implements</span> <span class="n">Flow</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">FlowSpecification</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">FlowSpecification</span><span class="o">.</span><span class="na">Builder</span><span class="o">.</span><span class="na">with</span><span class="o">()</span>
      <span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&quot;WebAnalyticsFlow&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="s">&quot;Web Analytics Flow&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">withFlowlets</span><span class="o">()</span>
        <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;UniqueVisitor&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">UniqueVisitor</span><span class="o">())</span>  <span class="c1">// Only one Flowlet in this Flow</span>
      <span class="o">.</span><span class="na">connect</span><span class="o">()</span>
        <span class="o">.</span><span class="na">fromStream</span><span class="o">(</span><span class="s">&quot;log&quot;</span><span class="o">).</span><span class="na">to</span><span class="o">(</span><span class="s">&quot;UniqueVisitor&quot;</span><span class="o">)</span>      <span class="c1">// Feed events written to the &quot;log&quot; Stream to UniqueVisitor</span>
      <span class="o">.</span><span class="na">build</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Lastly, we bundle up the Dataset and the Flow we&#8217;ve defined together to form an <tt class="docutils literal"><span class="pre">Application</span></tt> that can be deployed
and executed in CDAP:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebAnalytics</span> <span class="kd">extends</span> <span class="n">AbstractApplication</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">addStream</span><span class="o">(</span><span class="k">new</span> <span class="n">Stream</span><span class="o">(</span><span class="s">&quot;log&quot;</span><span class="o">));</span>
    <span class="n">addFlow</span><span class="o">(</span><span class="k">new</span> <span class="n">WebAnalyticsFlow</span><span class="o">());</span>
    <span class="n">createDataset</span><span class="o">(</span><span class="s">&quot;UniqueVisitCount&quot;</span><span class="o">,</span> <span class="n">UniqueVisitCount</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="n">setName</span><span class="o">(</span><span class="s">&quot;WebAnalytics&quot;</span><span class="o">);</span>
    <span class="n">setDescription</span><span class="o">(</span><span class="s">&quot;Web Analytics Application&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="query-the-unique-visitor-page-views">
<h4>Query the Unique Visitor Page Views<a class="headerlink" href="#query-the-unique-visitor-page-views" title="Permalink to this headline">¶</a></h4>
<p>Once the log data has been processed by the <tt class="docutils literal"><span class="pre">WebAnalyticsFlow</span></tt>, we can explore the Dataset <tt class="docutils literal"><span class="pre">UniqueVisitCount</span></tt>
with a SQL query. You can easily execute SQL queries against Datasets using the CDAP Console by
simply selecting <strong>Store</strong> on the left sidebar, clicking the <strong>Explore</strong> button on the right, and then selecting
the <strong>UniqueVisitCount</strong> Dataset:</p>
<a class="reference internal image-reference" href="_images/wa_explore_store.png"><img alt="_images/wa_explore_store.png" src="_images/wa_explore_store.png" style="width: 10in;" /></a>
<p>You can then run SQL queries against the Dataset. Let&#8217;s try to find the top five IP
addresses that visited the site by running a SQL query:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">cdap_user_uniquevisitcount</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">value</span> <span class="n">DESC</span> <span class="n">LIMIT</span> <span class="mi">5</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/wa_explore_query.png"><img alt="_images/wa_explore_query.png" src="_images/wa_explore_query.png" style="width: 10in;" /></a>
<p>You can copy and paste the above SQL into the <strong>Query</strong> box and click <strong>Execute</strong> to run it. It may take a while for
the query to finish. Once it&#8217;s finished, you can click on the result button at the bottom to show the query results:</p>
<a class="reference internal image-reference" href="_images/wa_explore_result.png"><img alt="_images/wa_explore_result.png" src="_images/wa_explore_result.png" style="width: 10in;" /></a>
</div>
</div>
</div>
<div class="section" id="other-example-applications">
<span id="examples"></span><h2>Other Example Applications<a class="headerlink" href="#other-example-applications" title="Permalink to this headline">¶</a></h2>
<p>Congratulations on successfully building and running your first CDAP application.
The SDK includes these additional examples:</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Example Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="#hello-world"><em>HelloWorld</em></a></td>
<td>A simple HelloWorld App that&#8217;s written using CDAP. It introduces how the elements Stream, Dataset, Flow,
and Procedure are used in a CDAP application.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#word-count"><em>WordCount</em></a></td>
<td>A simple application that counts words, and tracks word associations and unique words seen on the Stream.
It demonstrates the power of using datasets and how they can be employed to simplify storing complex data.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#count-random"><em>CountRandom</em></a></td>
<td>An application that demonstrates the <tt class="docutils literal"><span class="pre">&#64;Tick</span></tt> feature of Flows. It uses a tick method to generate random
numbers which are then counted by downstream Flowlets.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#purchase"><em>Purchase</em></a></td>
<td>This example demonstrates use of each of the CDAP elements—Streams, Flows, Flowlets, Datasets, Queries,
Procedures, MapReduce, Workflows, and Services—in a single Application.
A Flow receives events from a Stream, each event describing a purchase (&#8220;John bought 5 apples for $2&#8221;);
the Flow processes the events and stores them in a Dataset. A Mapreduce Job reads the Dataset, compiles
the purchases for each customer into a purchase history and stores the histories in a second Dataset.
The purchase histories can then be queried either through a Procedure or an ad-hoc SQL query.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#spark-k-means"><em>SparkKMeans</em></a></td>
<td>An application that demonstrates streaming text analysis using a Spark program. It calculates the centers
of points from an input stream using the KMeans Clustering method.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#spark-page-rank"><em>SparkPageRank</em></a></td>
<td>An application that demonstrates streaming text analysis using a Spark program. It computes the page rank
of URLs from an input stream.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#web-analytics"><em>Web Analytics</em></a></td>
<td>An application to generate statistics and to provide insights about web usage through the analysis
of web traffic.</td>
</tr>
</tbody>
</table>
<div class="section" id="building-and-running-applications">
<span id="convention"></span><h3>Building and Running Applications<a class="headerlink" href="#building-and-running-applications" title="Permalink to this headline">¶</a></h3>
<p>In the examples, we refer to the Standalone CDAP as &#8220;CDAP&#8221;, and the
example code that is running on it as an &#8220;Application&#8221;.</p>
<div class="section" id="building-the-application">
<h4>Building the Application<a class="headerlink" href="#building-the-application" title="Permalink to this headline">¶</a></h4>
<p>From the example&#8217;s project root, build an example with the
<a class="reference external" href="http://maven.apache.org">Apache Maven</a> command:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> mvn clean package
</pre></div>
</div>
</div>
<div class="section" id="starting-cdap">
<h4>Starting CDAP<a class="headerlink" href="#starting-cdap" title="Permalink to this headline">¶</a></h4>
<p>Make sure an instance of CDAP is running and available.
From within the SDK root directory, this command will start the Standalone CDAP:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> ./bin/cdap.sh start
</pre></div>
</div>
<p>On Windows:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">&gt;</span> bin<span class="se">\c</span>dap.bat start
</pre></div>
</div>
</div>
<div class="section" id="deploying-an-application">
<h4>Deploying an application<a class="headerlink" href="#deploying-an-application" title="Permalink to this headline">¶</a></h4>
<p>Once CDAP is Started, you can deploy the example JAR by:</p>
<ul>
<li><p class="first">Dragging and dropping the application JAR file (<tt class="docutils literal"><span class="pre">example/target/&lt;example&gt;-&lt;version&gt;.jar</span></tt>)
onto the CDAP Console running at <a class="reference external" href="http://localhost:9999/">http://localhost:9999/</a></p>
</li>
<li><p class="first">Use the <em>Load App</em> button found on the <em>Overview</em> of the CDAP Console to browse and upload the Jar.</p>
</li>
<li><p class="first">From the example&#8217;s project root run the App Manager script:</p>
<blockquote>
<div><ul class="simple">
<li>Linux: <tt class="docutils literal"><span class="pre">$./bin/app-manager.sh</span> <span class="pre">--action</span> <span class="pre">deploy</span></tt></li>
<li>Windows: <tt class="docutils literal"><span class="pre">&gt;bin\app-manager.bat</span> <span class="pre">deploy</span></tt></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="starting-an-application">
<h4>Starting an Application<a class="headerlink" href="#starting-an-application" title="Permalink to this headline">¶</a></h4>
<p>Once the application is deployed,</p>
<ul>
<li><p class="first">You can go to the Application view by clicking on the Application&#8217;s name. Now you can <em>Start</em> or <em>Stop</em> the Process
and Query of the application, or</p>
</li>
<li><p class="first">From the example&#8217;s project root run the App Manager script:</p>
<blockquote>
<div><ul class="simple">
<li>Linux: <tt class="docutils literal"><span class="pre">$./bin/app-manager.sh</span> <span class="pre">--action</span> <span class="pre">start</span></tt></li>
<li>Windows: <tt class="docutils literal"><span class="pre">&gt;bin\app-manager.bat</span> <span class="pre">start</span></tt></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="stopping-an-application">
<span id="stop-application"></span><h4>Stopping an Application<a class="headerlink" href="#stopping-an-application" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>On the Application detail page of the CDAP Console, click the <em>Stop</em> button on both the Process and Query lists or</li>
<li>From the example&#8217;s project root run the App Manager script:<ul>
<li>Linux: <tt class="docutils literal"><span class="pre">$./bin/app-manager.sh</span> <span class="pre">--action</span> <span class="pre">stop</span></tt></li>
<li>Windows: <tt class="docutils literal"><span class="pre">&gt;bin\app-manager.bat</span> <span class="pre">stop</span></tt></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="helloworld">
<span id="hello-world"></span><h3>HelloWorld<a class="headerlink" href="#helloworld" title="Permalink to this headline">¶</a></h3>
<p>The most simple Cask Data Application Platform (CDAP) Example.</p>
<div class="section" id="overview">
<h4>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h4>
<p>This application uses one Stream, one Dataset, one Flow and one Procedure to implement the classic &#8220;Hello World&#8221;.</p>
<ul class="simple">
<li>A stream to send names to;</li>
<li>A flow with a single flowlet that reads the stream and stores each name in a KeyValueTable; and</li>
<li>A procedure that reads the name from the KeyValueTable and prints &#8216;Hello [Name]!&#8217;.</li>
</ul>
<div class="section" id="the-whoflow">
<h5>The <tt class="docutils literal"><span class="pre">WhoFlow</span></tt><a class="headerlink" href="#the-whoflow" title="Permalink to this headline">¶</a></h5>
<p>This is a trivial flow with a single flowlet named <tt class="docutils literal"><span class="pre">NamSaver</span></tt>:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">public static class WhoFlow implements Flow {</span>

<span class="go">  @Override</span>
<span class="go">  public FlowSpecification configure() {</span>
<span class="go">    return FlowSpecification.Builder.with().</span>
<span class="go">      setName(&quot;WhoFlow&quot;).</span>
<span class="go">      setDescription(&quot;A flow that collects names&quot;).</span>
<span class="go">      withFlowlets().add(&quot;saver&quot;, new NameSaver()).</span>
<span class="go">      connect().fromStream(&quot;who&quot;).to(&quot;saver&quot;).</span>
<span class="go">      build();</span>
<span class="go">  }</span>
<span class="go">}</span>
</pre></div>
</div>
<p>The flowlet uses a dataset of type <tt class="docutils literal"><span class="pre">KeyValueTable</span></tt> to store the names it reads from the stream. Every time a new
name is received, it is stored in the table under the key <tt class="docutils literal"><span class="pre">name</span></tt>-and it overwrites any name that was previously
stored:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">/**</span>
<span class="go"> * Sample Flowlet.</span>
<span class="go"> */</span>
<span class="go">public static class NameSaver extends AbstractFlowlet {</span>

<span class="go">  static final byte[] NAME = { &#39;n&#39;, &#39;a&#39;, &#39;m&#39;, &#39;e&#39; };</span>

<span class="go">  @UseDataSet(&quot;whom&quot;)</span>
<span class="go">  KeyValueTable whom;</span>
<span class="go">  Metrics flowletMetrics;</span>

<span class="go">  @ProcessInput</span>
<span class="go">  public void process(StreamEvent event) {</span>
<span class="go">    byte[] name = Bytes.toBytes(event.getBody());</span>
<span class="go">    if (name != null &amp;&amp; name.length &gt; 0) {</span>
<span class="go">      whom.write(NAME, name);</span>
<span class="go">    }</span>
<span class="go">    if (name.length &gt; 10) {</span>
<span class="go">      flowletMetrics.count(&quot;names.longnames&quot;, 1);</span>
<span class="go">    }</span>
<span class="go">    flowletMetrics.count(&quot;names.bytes&quot;, name.length);</span>
<span class="go">  }</span>
<span class="go">}</span>
</pre></div>
</div>
<p>Note that the flowlet also emits metrics: Every time a name longer than 10 characters is received,
the counter <tt class="docutils literal"><span class="pre">names.longnames</span></tt> is incremented by one, and the metric <tt class="docutils literal"><span class="pre">names.bytes</span></tt> is incremented
by the length of the name. We will see below how to retrieve these metrics using the CDAP Client API.</p>
</div>
<div class="section" id="the-greeting-procedure">
<h5>The <tt class="docutils literal"><span class="pre">Greeting</span></tt> Procedure<a class="headerlink" href="#the-greeting-procedure" title="Permalink to this headline">¶</a></h5>
<p>This procedure has a single handler method called <tt class="docutils literal"><span class="pre">greet</span></tt> that does not except arguments. When invoked, it
reads the name stored by the <tt class="docutils literal"><span class="pre">NameSaver</span></tt> from the key-value table. It return a simple gretting with that name:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">public static class Greeting extends AbstractProcedure {</span>

<span class="go">  @UseDataSet(&quot;whom&quot;)</span>
<span class="go">  KeyValueTable whom;</span>
<span class="go">  Metrics procedureMetrics;</span>

<span class="go">  @Handle(&quot;greet&quot;)</span>
<span class="go">  public void greet(ProcedureRequest request, ProcedureResponder responder) throws Exception {</span>
<span class="go">    byte[] name = whom.read(NameSaver.NAME);</span>
<span class="go">    String toGreet = name != null ? new String(name) : &quot;World&quot;;</span>
<span class="go">    if (toGreet.equals(&quot;Jane Doe&quot;)) {</span>
<span class="go">      procedureMetrics.count(&quot;greetings.count.jane_doe&quot;, 1);</span>
<span class="go">    }</span>
<span class="go">    responder.sendJson(new ProcedureResponse(SUCCESS), &quot;Hello &quot; + toGreet + &quot;!&quot;);</span>
<span class="go">  }</span>
<span class="go">}</span>
</pre></div>
</div>
<p>Deploy and start the application as described in  <a class="reference internal" href="#convention"><em>Building and Running Applications</em></a></p>
</div>
<div class="section" id="running-the-example">
<h5>Running the Example<a class="headerlink" href="#running-the-example" title="Permalink to this headline">¶</a></h5>
<div class="section" id="injecting-a-name">
<h6>Injecting a Name<a class="headerlink" href="#injecting-a-name" title="Permalink to this headline">¶</a></h6>
<p>In the Application&#8217;s detail page, under Process, click on WhoFlow. This takes you to the flow details page.
Now click on the &#8220;who&#8221; stream on the left side of the flow visualization, which brings up a pop-up window.
Enter a name and click the Inject button. After you close the pop-up window, you will see that the counters
for both the stream and the &#8220;saver&#8221; flowlet increase to 1. You can repeat this step to enter more names, but
remember that only the last name is stored in the key-value table.</p>
</div>
<div class="section" id="using-the-procedure">
<h6>Using the Procedure<a class="headerlink" href="#using-the-procedure" title="Permalink to this headline">¶</a></h6>
<p>Go back to the Application&#8217;s detail page, and under Query, click on the Greeting procedure. Now you can make a
request to the procedure: Enter &#8220;greet&#8221; for the method and click the Execute button. At the bottom of the page you
will see the procedure&#8217;s response. If the last name you entered is Tom, this will be &#8220;Hello, Tom!&#8221;.</p>
</div>
<div class="section" id="retrieving-metrics">
<h6>Retrieving Metrics<a class="headerlink" href="#retrieving-metrics" title="Permalink to this headline">¶</a></h6>
<p>You can now query the metrics that are emitted by the flow. To see the value of the <tt class="docutils literal"><span class="pre">names.bytes</span></tt> metric,
you can make an HTTP request to the Metrics API using curl:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> curl http://localhost:10000/v2/metrics/user/apps/HelloWorld/flows/WhoFlow/flowlets/saver/names.bytes?aggregate<span class="o">=</span><span class="nb">true</span>
<span class="go">{&quot;data&quot;:3}</span>
</pre></div>
</div>
<p>Once done, you can stop the application as described in <a class="reference internal" href="#stop-application"><em>Building and Running Applications</em></a>.</p>
</div>
</div>
</div>
</div>
<div class="section" id="word-count">
<span id="id1"></span><h3>Word Count<a class="headerlink" href="#word-count" title="Permalink to this headline">¶</a></h3>
<p>A Cask Data Application Platform (CDAP) Example demonstrating Flows, Datasets and Procedures.</p>
<div class="section" id="id2">
<h4>Overview<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>This application receives words and sentences from a stream and uses flowlets to process them and
store the results and statistics in datasets.</p>
<blockquote>
<div><ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">wordStream</span></tt> receives sentences, one event at a time.</li>
<li>The <tt class="docutils literal"><span class="pre">splitter</span></tt> flowlet reads sentences from stream and splits them into words, writes global statistics of the
received words like &#8220;total words received&#8221; and &#8220;total length of words received&#8221; and emits each word to the
<tt class="docutils literal"><span class="pre">counter</span></tt> flowlet  and each sentence (list of words) to the <tt class="docutils literal"><span class="pre">associator</span></tt> flowlet.</li>
<li>The <tt class="docutils literal"><span class="pre">associator</span></tt> flowlet receives the set of words and writes word associations to the <tt class="docutils literal"><span class="pre">wordAssocs</span></tt> dataset.
For example, if we receive a sentence &#8220;welcome to CDAP&#8221;, the word associations are
{&#8220;welcome&#8221;,&#8221;to&#8221;} , {&#8220;welcome&#8221;, &#8220;CDAP&#8221;}, and {&#8220;to&#8221;,&#8221;CDAP&#8221;}.</li>
<li>The <tt class="docutils literal"><span class="pre">counter</span></tt> flowlet receives a word and increments the count for this word, maintained in a key-value table and
forwards this word to the <tt class="docutils literal"><span class="pre">unique</span></tt> flowlet.</li>
<li>The <tt class="docutils literal"><span class="pre">unique</span></tt> flowlet receives a word and updates the <tt class="docutils literal"><span class="pre">uniqueCount</span></tt> table, if it sees this word for the first time.</li>
</ul>
</div></blockquote>
<p>Let&#8217;s look at some of these elements, and then run the Application and see the results.</p>
</div>
<div class="section" id="the-word-count-application">
<h4>The Word Count Application<a class="headerlink" href="#the-word-count-application" title="Permalink to this headline">¶</a></h4>
<p>As in the other <a class="reference internal" href="#examples"><em>examples.</em></a>, the components
of the Application are tied together by the class <tt class="docutils literal"><span class="pre">WordCount</span></tt>:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">public class WordCount extends AbstractApplication {</span>
<span class="go">  @Override</span>
<span class="go">  public void configure() {</span>
<span class="go">    setName(&quot;WordCount&quot;);</span>
<span class="go">    setDescription(&quot;Example Word Count Application&quot;);</span>

<span class="go">    // Ingest data into the Application via Streams</span>
<span class="go">    addStream(new Stream(&quot;wordStream&quot;));</span>

<span class="go">     // Store processed data in Datasets</span>
<span class="go">    createDataset(&quot;wordStats&quot;, Table.class);</span>
<span class="go">    createDataset(&quot;wordCounts&quot;, KeyValueTable.class);</span>
<span class="go">    createDataset(&quot;uniqueCount&quot;, UniqueCountTable.class);</span>
<span class="go">    createDataset(&quot;wordAssocs&quot;, AssociationTable.class);</span>

<span class="go">    // Process events in real-time using Flows</span>
<span class="go">    addFlow(new WordCounter());</span>

<span class="go">    // Query the processed data using a Procedure</span>
<span class="go">    addProcedure(new RetrieveCounts());</span>
<span class="go">  }</span>
<span class="go">}</span>
</pre></div>
</div>
<div class="section" id="data-storage">
<h5>Data Storage<a class="headerlink" href="#data-storage" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">wordStats</span></tt> stores the global statistics of total count of words and the total length of words received.</li>
<li><tt class="docutils literal"><span class="pre">wordCounts</span></tt> stores the word and the corresponding count in a key value table.</li>
<li><tt class="docutils literal"><span class="pre">uniqueCount</span></tt> is a custom dataset that stores the total count of unique words received so far.</li>
<li><tt class="docutils literal"><span class="pre">wordAssocs</span></tt> is a custom dataset that stores the count for word associations.</li>
</ul>
</div>
<div class="section" id="retrievecounts-procedure">
<h5>RetrieveCounts Procedure<a class="headerlink" href="#retrievecounts-procedure" title="Permalink to this headline">¶</a></h5>
<p>This Procedure has three methods:</p>
<ul class="simple">
<li>getStats(): Returns global statistics like  &#8220;total words received&#8221;, &#8220;total length of words received&#8221; and &#8220;average length of words&#8221;.</li>
<li>getCount(): Given a word, this returns the total count of occurrences and the top-10 associated words for this word.</li>
<li>getAssoc(): Given a pair, &#8220;word1&#8221; and &#8220;word2&#8221;, this returns the association count for this pair.</li>
</ul>
<p>Deploy and start the application as described in  <a class="reference internal" href="#convention"><em>Building and Running Applications</em></a></p>
</div>
<div class="section" id="id3">
<h5>Running the Example<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
<div class="section" id="injecting-sentences">
<h6>Injecting Sentences<a class="headerlink" href="#injecting-sentences" title="Permalink to this headline">¶</a></h6>
<p>In the Application&#8217;s detail page, under Process, click on WordCounter flow. This takes you to the flow details page.
Now click on the &#8220;wordStream&#8221; stream on the left side of the flow visualization, which brings up a pop-up window.
Enter a sentence &#8220;Hello CDAP&#8221; and click on the Inject button. After you close the pop-up window, you will see that the counter
for the stream increases to 1, whereas the counters for the flowlets <tt class="docutils literal"><span class="pre">splitter</span></tt> and <tt class="docutils literal"><span class="pre">associator</span></tt> increase to 1 and
the counters for the flowlets <tt class="docutils literal"><span class="pre">counter</span></tt>  and <tt class="docutils literal"><span class="pre">unique</span></tt> increase to 2.
You can repeat this step to enter more sentences.</p>
</div>
<div class="section" id="querying-the-results">
<h6>Querying the Results<a class="headerlink" href="#querying-the-results" title="Permalink to this headline">¶</a></h6>
<p>If the Procedure has not already been started, you start it either through the
CDAP Console or via an HTTP request using the <tt class="docutils literal"><span class="pre">curl</span></tt> command:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">curl -v -X POST &#39;http://localhost:10000/v2/apps/WordCount/procedures/RetrieveCounts/start&#39;</span>
</pre></div>
</div>
<p>There are two ways to query the  <tt class="docutils literal"><span class="pre">RetrieveCounts</span></tt> procedure:</p>
<ol class="arabic">
<li><p class="first">Send a query via an HTTP request using the <tt class="docutils literal"><span class="pre">curl</span></tt> command. For example:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">curl -v -d &#39;{&quot;word&quot;: &quot;CDAP&quot;}&#39; \</span>
<span class="go">  -X POST &#39;http://localhost:10000/v2/apps/WordCount/procedures/RetrieveCounts/methods/getCount&#39;</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div>On Windows, a copy of <tt class="docutils literal"><span class="pre">curl</span></tt> is located in the <tt class="docutils literal"><span class="pre">libexec</span></tt> directory of the project SDK.</div></blockquote>
<ol class="arabic" start="2">
<li><p class="first">Click on the <tt class="docutils literal"><span class="pre">RetrieveCounts</span></tt> in the Application page of the Console to get to the
Procedure dialogue. Type in the method name <tt class="docutils literal"><span class="pre">getCount</span></tt>, and enter a word in the parameters
field, such as:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">{ &quot;word&quot; : &quot;CDAP&quot; }</span>
</pre></div>
</div>
</li>
</ol>
<p>Then click the <em>Execute</em> button. The word count and top-10 associations words for that word will be displayed in the
Console in JSON format, for example (reformatted to fit):</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">{</span>
<span class="go">  &quot;assocs&quot;: {</span>
<span class="go">      &quot;Hello&quot;: 1,</span>
<span class="go">      &quot;BigData&quot;:3,</span>
<span class="go">      &quot;Cask&quot;:5,</span>
<span class="go">  },</span>
<span class="go">  &quot;count&quot;: 6,</span>
<span class="go">  &quot;word&quot;: &quot;CDAP&quot;</span>
<span class="go">}</span>
</pre></div>
</div>
<ol class="arabic" start="3">
<li><p class="first">You can try executing other methods available in this procedure:</p>
<blockquote>
<div><ul class="simple">
<li>getStats - This returns the statistics, &#8220;total words received&#8221;, &#8220;total length of words received&#8221; and so on.</li>
<li>getAssoc - For getAssoc you need to provide two words to get their association count, example: {&#8220;word1&#8221;:&#8221;Hello&#8221;, &#8220;word2&#8221;:&#8221;CDAP&#8221;}.</li>
</ul>
</div></blockquote>
</li>
</ol>
<p>Once done, you can stop the application as described in <a class="reference internal" href="#stop-application"><em>Building and Running Applications</em></a>.</p>
</div>
</div>
</div>
</div>
<div class="section" id="count-random">
<span id="id4"></span><h3>Count Random<a class="headerlink" href="#count-random" title="Permalink to this headline">¶</a></h3>
<p>A Cask Data Application Platform (CDAP) Example demonstrating the &#64;Tick feature of Flows.</p>
<div class="section" id="id5">
<h4>Overview<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>This application does not have a Stream, instead it uses a Tick annotation in the <tt class="docutils literal"><span class="pre">source</span></tt> flowlet to generate data:</p>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">generate</span></tt> method of the  <tt class="docutils literal"><span class="pre">source</span></tt> flowlet has a <tt class="docutils literal"><span class="pre">&#64;Tick</span></tt> annotation which specifies how frequently the method will be called.</li>
<li>The <tt class="docutils literal"><span class="pre">source</span></tt> flowlet generates a random integer in the range {1..10000} and emits it to the next flowlet <tt class="docutils literal"><span class="pre">splitter</span></tt>.</li>
<li>The <tt class="docutils literal"><span class="pre">splitter</span></tt> flowlet splits the number into digits, and emits these digits to the next stage.</li>
<li>The <tt class="docutils literal"><span class="pre">counter</span></tt> increments the count of the received number in the KeyValueTable.</li>
</ul>
<p>Let&#8217;s look at some of these elements, and then run the Application and see the results.</p>
</div>
<div class="section" id="the-count-random-application">
<h4>The Count Random Application<a class="headerlink" href="#the-count-random-application" title="Permalink to this headline">¶</a></h4>
<p>As in the other <a class="reference external" href="index.html">examples</a>, the components
of the Application are tied together by the class <tt class="docutils literal"><span class="pre">CountRandom</span></tt>:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CountRandom</span> <span class="kd">extends</span> <span class="n">AbstractApplication</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TABLE_NAME</span> <span class="o">=</span> <span class="s">&quot;randomTable&quot;</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">setName</span><span class="o">(</span><span class="s">&quot;CountRandom&quot;</span><span class="o">);</span>
    <span class="n">setDescription</span><span class="o">(</span><span class="s">&quot;Example random count application&quot;</span><span class="o">);</span>
    <span class="n">createDataset</span><span class="o">(</span><span class="n">TABLE_NAME</span><span class="o">,</span> <span class="n">KeyValueTable</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">addFlow</span><span class="o">(</span><span class="k">new</span> <span class="n">CountRandomFlow</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The Flowlet that generates random numbers every 1 millisecond:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RandomSource</span> <span class="kd">extends</span> <span class="n">AbstractFlowlet</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">OutputEmitter</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">randomOutput</span><span class="o">;</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>

  <span class="nd">@Tick</span><span class="o">(</span><span class="n">delay</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">generate</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="n">randomOutput</span><span class="o">.</span><span class="na">emit</span><span class="o">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">10000</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Deploy and start the Application as described in  <a class="reference internal" href="#convention"><em>Building and Running Applications</em></a></p>
<div class="section" id="running-the-application">
<h5>Running the Application<a class="headerlink" href="#running-the-application" title="Permalink to this headline">¶</a></h5>
<p>Once you start the flow, the <tt class="docutils literal"><span class="pre">source</span></tt> flowlet will continuously generate data. You can see this by observing the counters
for each flowlet in the flow visualization. Even though you are not injecting any data into the flow, the counters increase steadily.</p>
<p>Once done, you can stop the application as described in <a class="reference internal" href="#stop-application"><em>Building and Running Applications</em></a>.</p>
</div>
</div>
</div>
<div class="section" id="purchase">
<span id="id6"></span><h3>Purchase<a class="headerlink" href="#purchase" title="Permalink to this headline">¶</a></h3>
<p>A Cask Data Application Platform (CDAP) Example demonstrating all CDAP elements.</p>
<div class="section" id="id7">
<h4>Overview<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p>This example demonstrates use of each of the CDAP elements: Streams, Flows, Flowlets,
Datasets, Queries, Procedures, MapReduce Jobs, Workflows, and Custom Services in a single Application.</p>
<p>The application uses a scheduled MapReduce Job and Workflow to read from one ObjectStore Dataset
and write to another.</p>
<blockquote>
<div><ul class="simple">
<li>Send sentences of the form &#8220;Tom bought 5 apples for $10&#8221; to the <tt class="docutils literal"><span class="pre">purchaseStream</span></tt>.
You can send sentences either by using a <tt class="docutils literal"><span class="pre">curl</span></tt> call, using the <tt class="docutils literal"><span class="pre">inject-data</span></tt> script
included in the example&#8217;s <tt class="docutils literal"><span class="pre">/bin</span></tt> directory, or using the CDAP Console.</li>
<li>The <tt class="docutils literal"><span class="pre">PurchaseFlow</span></tt> reads the <tt class="docutils literal"><span class="pre">purchaseStream</span></tt> and converts every input String into a
Purchase object and stores the object in the <em>purchases</em> Dataset.</li>
<li>The <tt class="docutils literal"><span class="pre">CatalogLookupService</span></tt> fetches the catalog id for a given product. The CatalogLookupService
is called from the PurchaseStore Flowlet. The host and port of the CatalogLookupService is discovered
using the Service discovery framework.</li>
<li>When scheduled by the <tt class="docutils literal"><span class="pre">PurchaseHistoryWorkFlow</span></tt>, the <tt class="docutils literal"><span class="pre">PurchaseHistoryBuilder</span></tt> MapReduce
job reads the <em>purchases</em> Dataset, creates a purchase history, and stores the purchase
history in the <em>history</em> Dataset every morning at 4:00 A.M.</li>
<li>You can either manually (in the Process screen of the CDAP Console) or
programmatically execute the <tt class="docutils literal"><span class="pre">PurchaseHistoryBuilder</span></tt> MapReduce job to store
customers&#8217; purchase history in the <em>history</em> Dataset.</li>
<li>Execute the <tt class="docutils literal"><span class="pre">PurchaseProcedure</span></tt> procedure to query the <em>history</em> Dataset to discover the
purchase history of each user.</li>
<li>Execute a SQL query over the <em>history</em> Dataset. You can do this using a series of <tt class="docutils literal"><span class="pre">curl</span></tt>
calls, or more conveniently using the <tt class="docutils literal"><span class="pre">cdap-cli</span></tt>.</li>
</ul>
</div></blockquote>
<p><strong>Note:</strong> Because the PurchaseHistoryWorkFlow is only scheduled to run at 4:00 A.M.,
you should not start it manually until after entering the first customers&#8217; purchases, or the
PurchaseProcedure will return a &#8220;not found&#8221; error.</p>
<p>Let&#8217;s look at some of these elements, and then run the Application and see the results.</p>
</div>
<div class="section" id="the-purchase-application">
<h4>The Purchase Application<a class="headerlink" href="#the-purchase-application" title="Permalink to this headline">¶</a></h4>
<p>As in the other <a class="reference external" href="index.html">examples</a>, the components
of the Application are tied together by the class <tt class="docutils literal"><span class="pre">PurchaseApp</span></tt>:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PurchaseApp</span> <span class="kd">extends</span> <span class="n">AbstractApplication</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">setName</span><span class="o">(</span><span class="s">&quot;PurchaseHistory&quot;</span><span class="o">);</span>
    <span class="n">setDescription</span><span class="o">(</span><span class="s">&quot;Purchase history app&quot;</span><span class="o">);</span>

    <span class="c1">// Ingest data into the Application via Streams</span>
    <span class="n">addStream</span><span class="o">(</span><span class="k">new</span> <span class="n">Stream</span><span class="o">(</span><span class="s">&quot;purchaseStream&quot;</span><span class="o">));</span>

    <span class="c1">// Store processed data in Datasets</span>
    <span class="n">createDataSet</span><span class="o">(</span><span class="s">&quot;frequentCustomers&quot;</span><span class="o">,</span> <span class="n">KeyValueTable</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="c1">// Process events in real-time using Flows</span>
    <span class="n">addFlow</span><span class="o">(</span><span class="k">new</span> <span class="n">PurchaseFlow</span><span class="o">());</span>

    <span class="c1">// Query the processed data using a Procedure</span>
    <span class="n">addProcedure</span><span class="o">(</span><span class="k">new</span> <span class="n">PurchaseProcedure</span><span class="o">());</span>

    <span class="c1">// Run a MapReduce job on the acquired data using a Workflow</span>
    <span class="n">addWorkflow</span><span class="o">(</span><span class="k">new</span> <span class="n">PurchaseHistoryWorkflow</span><span class="o">());</span>

    <span class="c1">// Provide a Service to Application components</span>
    <span class="n">addService</span><span class="o">(</span><span class="k">new</span> <span class="n">CatalogLookupService</span><span class="o">());</span>

    <span class="k">try</span> <span class="o">{</span>
      <span class="n">createDataSet</span><span class="o">(</span><span class="s">&quot;history&quot;</span><span class="o">,</span> <span class="n">PurchaseHistoryStore</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">PurchaseHistoryStore</span><span class="o">.</span><span class="na">properties</span><span class="o">());</span>
      <span class="n">ObjectStores</span><span class="o">.</span><span class="na">createObjectStore</span><span class="o">(</span><span class="n">getConfigurer</span><span class="o">(),</span> <span class="s">&quot;purchases&quot;</span><span class="o">,</span> <span class="n">Purchase</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UnsupportedTypeException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// This exception is thrown by ObjectStore if its parameter type cannot be (de)serialized</span>
      <span class="c1">// (for example, if it is an interface and not a class), as there is no auto-magic way to</span>
      <span class="c1">// de-serialize an object. In this case, that cannot happen because both PurchaseHistoryStore</span>
      <span class="c1">// and Purchase are actual classes.</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="section" id="purchasehistory-and-purchase-objectstore-data-storage">
<h5><tt class="docutils literal"><span class="pre">PurchaseHistory</span></tt> and <tt class="docutils literal"><span class="pre">Purchase</span></tt>: ObjectStore Data Storage<a class="headerlink" href="#purchasehistory-and-purchase-objectstore-data-storage" title="Permalink to this headline">¶</a></h5>
<p>The raw purchase data is stored in an ObjectStore Dataset, <em>purchases</em>,
with this method defined in <tt class="docutils literal"><span class="pre">PurchaseStore</span></tt>:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">process</span><span class="o">(</span><span class="n">Purchase</span> <span class="n">purchase</span><span class="o">)</span>
</pre></div>
</div>
<p>This method is what actually puts data into the <em>purchases</em> Dataset, by writing to the
Dataset with each purchase&#8217;s timestamp and the <tt class="docutils literal"><span class="pre">Purchase</span></tt> Object.</p>
<p>The purchase history for each customer is compiled by the <tt class="docutils literal"><span class="pre">PurchaseHistoryWorkflow</span></tt>, which uses a
Map/Reduce job, <tt class="docutils literal"><span class="pre">PurchaseHistoryBuilder</span></tt>, to aggregate all purchases into a per-customer purchase
history. It writes to the <em>history</em> Dataset, a custom Dataset that embeds an <tt class="docutils literal"><span class="pre">ObjectStore</span></tt> and also
implements the <tt class="docutils literal"><span class="pre">RecordScannable</span></tt> interface to allow SQL queries over the Dataset.</p>
</div>
<div class="section" id="purchaseprocedure-procedure">
<h5><tt class="docutils literal"><span class="pre">PurchaseProcedure</span></tt>: Procedure<a class="headerlink" href="#purchaseprocedure-procedure" title="Permalink to this headline">¶</a></h5>
<p>This procedure has a <tt class="docutils literal"><span class="pre">history</span></tt> method to obtain the purchase history of a given customer.</p>
</div>
<div class="section" id="setting-up">
<h5>Setting up<a class="headerlink" href="#setting-up" title="Permalink to this headline">¶</a></h5>
<ol class="arabic simple">
<li>Deploy and start the application as described in  <a class="reference internal" href="#convention"><em>Building and Running Applications</em></a></li>
<li>Note: the CatalogLookupService will not be displayed in the Console</li>
</ol>
</div>
<div class="section" id="id8">
<h5>Running the Example<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h5>
<div class="section" id="id9">
<h6>Injecting Sentences<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h6>
<p>Run this script to inject sentences
to the Stream named <em>purchaseStream</em> in the <tt class="docutils literal"><span class="pre">Purchase</span></tt> application:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">$</span> <span class="o">./</span><span class="n">bin</span><span class="o">/</span><span class="n">inject</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="na">sh</span>
</pre></div>
</div>
<p>On Windows:</p>
<div class="highlight-java"><div class="highlight"><pre>~SDK&gt; bin\inject-data.bat
</pre></div>
</div>
</div>
<div class="section" id="starting-the-workflow">
<h6>Starting the Workflow<a class="headerlink" href="#starting-the-workflow" title="Permalink to this headline">¶</a></h6>
<p>The easiest way to start the <tt class="docutils literal"><span class="pre">PurchaseHistoryWorkflow</span></tt> is to click on the Workflow in the Application
page of the CDAP Console and then click the start button. You can see the status of the Workflow and observe when it finishes.</p>
<p>Alternatively, you can send a <tt class="docutils literal"><span class="pre">curl</span></tt> request to the CDAP:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">curl</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="nl">http:</span><span class="c1">//localhost:10000/v2/apps/PurchaseHistory/workflows/PurchaseHistoryWorkflow/start</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h6>Querying the Results<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h6>
<p>If the Procedure has not already been started, you start it either through the
CDAP Console or via an HTTP request using the <tt class="docutils literal"><span class="pre">curl</span></tt> command:</p>
<div class="highlight-java"><div class="highlight"><pre>curl -v -X POST &#39;http://localhost:10000/v2/apps/PurchaseHistory/procedures/PurchaseProcedure/start&#39;
</pre></div>
</div>
<p>There are two ways to query the <em>history</em> ObjectStore through the <tt class="docutils literal"><span class="pre">PurchaseProcedure</span></tt> procedure:</p>
<ol class="arabic">
<li><p class="first">Send a query via an HTTP request using the <tt class="docutils literal"><span class="pre">curl</span></tt> command. For example:</p>
<div class="highlight-java"><div class="highlight"><pre>curl -v -d &#39;{&quot;customer&quot;: &quot;Alice&quot;}&#39; \
  -X POST &#39;http://localhost:10000/v2/apps/PurchaseHistory/procedures/PurchaseProcedure/methods/history&#39;
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><p>On Windows, a copy of <tt class="docutils literal"><span class="pre">curl</span></tt> is located in the <tt class="docutils literal"><span class="pre">libexec</span></tt> directory of the example:</p>
<div class="highlight-java"><div class="highlight"><pre>libexec\curl...
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="2">
<li><p class="first">Click on the <tt class="docutils literal"><span class="pre">PurchaseProcedure</span></tt> in the Application page of the Console to get to the
Procedure dialogue. Type in the method name <tt class="docutils literal"><span class="pre">history</span></tt>, and enter the customer name in the parameters
field, such as:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="o">{</span> <span class="s">&quot;customer&quot;</span> <span class="o">:</span> <span class="s">&quot;Alice&quot;</span> <span class="o">}</span>
</pre></div>
</div>
<p>Then click the <em>Execute</em> button. The purchase history for that customer will be displayed in the
Console in JSON format, for example [reformatted to fit]:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="o">{</span><span class="s">&quot;customer&quot;</span><span class="o">:</span><span class="s">&quot;Alice&quot;</span><span class="o">,</span><span class="s">&quot;purchases&quot;</span>
   <span class="o">[{</span><span class="s">&quot;customer&quot;</span><span class="o">:</span><span class="s">&quot;Alice&quot;</span><span class="o">,</span>
      <span class="s">&quot;product&quot;</span><span class="o">:</span><span class="s">&quot;coconut&quot;</span><span class="o">,</span><span class="s">&quot;quantity&quot;</span><span class="o">:</span><span class="mi">2</span><span class="o">,</span><span class="s">&quot;price&quot;</span><span class="o">:</span><span class="mi">5</span><span class="o">,</span><span class="s">&quot;purchaseTime&quot;</span><span class="o">:</span><span class="mi">1404268588338</span><span class="o">,</span><span class="s">&quot;catalogId&quot;</span><span class="o">:</span><span class="s">&quot;&quot;</span><span class="o">}]}</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="exploring-the-results-using-sql">
<h6>Exploring the Results Using SQL<a class="headerlink" href="#exploring-the-results-using-sql" title="Permalink to this headline">¶</a></h6>
<p>You can use SQL to formulate ad-hoc queries over the <em>history</em> Dataset. This is done by a series of
<tt class="docutils literal"><span class="pre">curl</span></tt> calls, as described in the RESTful API section of the Developer Guide. For your convenience, the SDK
includes a script, <tt class="docutils literal"><span class="pre">bin/cdap-cli.sh</span></tt>, that can execute the series of calls.</p>
<p>From within the SDK root directory:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">$</span> <span class="o">./</span><span class="n">bin</span><span class="o">/</span><span class="n">cdap</span><span class="o">-</span><span class="n">cli</span><span class="o">.</span><span class="na">sh</span> <span class="n">execute</span> <span class="s">&quot;SELECT * FROM cdap_user_history WHERE customer IN (&#39;Alice&#39;,&#39;Bob&#39;)&quot;</span>
</pre></div>
</div>
<p>This will submit the query, using the <em>History</em> table in the <tt class="docutils literal"><span class="pre">cdap_user</span></tt> namespace, wait for its completion and
then retrieve and print all results, one by one:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="o">+=====================================================================================================================================================================================================================================================================+</span>
<span class="o">|</span> <span class="n">cdap_user_history</span><span class="o">.</span><span class="na">customer</span><span class="o">:</span> <span class="n">STRING</span> <span class="o">|</span> <span class="n">cdap_user_history</span><span class="o">.</span><span class="na">purchases</span><span class="o">:</span> <span class="n">array</span><span class="o">&lt;</span><span class="n">struct</span><span class="o">&lt;</span><span class="nl">customer:</span><span class="n">string</span><span class="o">,</span><span class="nl">product:</span><span class="n">string</span><span class="o">,</span><span class="nl">quantity:</span><span class="kt">int</span><span class="o">,</span><span class="nl">price:</span><span class="kt">int</span><span class="o">,</span><span class="nl">purchasetime:</span><span class="n">bigint</span><span class="o">,</span><span class="nl">catalogid:</span><span class="n">string</span><span class="o">&gt;&gt;</span>                                                                                         <span class="o">|</span>
<span class="o">+=====================================================================================================================================================================================================================================================================+</span>
<span class="o">|</span> <span class="n">Alice</span>                              <span class="o">|</span> <span class="o">[{</span><span class="s">&quot;customer&quot;</span><span class="o">:</span><span class="s">&quot;Alice&quot;</span><span class="o">,</span><span class="s">&quot;product&quot;</span><span class="o">:</span><span class="s">&quot;coconut&quot;</span><span class="o">,</span><span class="s">&quot;quantity&quot;</span><span class="o">:</span><span class="mi">2</span><span class="o">,</span><span class="s">&quot;price&quot;</span><span class="o">:</span><span class="mi">5</span><span class="o">,</span><span class="s">&quot;purchasetime&quot;</span><span class="o">:</span><span class="mi">1413399429579</span><span class="o">,</span><span class="s">&quot;catalogid&quot;</span><span class="o">:</span><span class="s">&quot;&quot;</span><span class="o">},{</span><span class="s">&quot;customer&quot;</span><span class="o">:</span><span class="s">&quot;Alice&quot;</span><span class="o">,</span><span class="s">&quot;product&quot;</span><span class="o">:</span><span class="s">&quot;grapefruit&quot;</span><span class="o">,</span><span class="s">&quot;quantity&quot;</span><span class="o">:</span><span class="mi">12</span><span class="o">,</span><span class="s">&quot;price&quot;</span><span class="o">:</span><span class="mi">10</span><span class="o">,</span><span class="s">&quot;purchasetime&quot;</span><span class="o">:</span><span class="mi">1413399429575</span><span class="o">,</span><span class="s">&quot;catalogid&quot;</span><span class="o">:</span><span class="s">&quot;&quot;</span><span class="o">}]</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Bob</span>                                <span class="o">|</span> <span class="o">[{</span><span class="s">&quot;customer&quot;</span><span class="o">:</span><span class="s">&quot;Bob&quot;</span><span class="o">,</span><span class="s">&quot;product&quot;</span><span class="o">:</span><span class="s">&quot;coffee&quot;</span><span class="o">,</span><span class="s">&quot;quantity&quot;</span><span class="o">:</span><span class="mi">1</span><span class="o">,</span><span class="s">&quot;price&quot;</span><span class="o">:</span><span class="mi">1</span><span class="o">,</span><span class="s">&quot;purchasetime&quot;</span><span class="o">:</span><span class="mi">1413399429600</span><span class="o">,</span><span class="s">&quot;catalogid&quot;</span><span class="o">:</span><span class="s">&quot;&quot;</span><span class="o">},{</span><span class="s">&quot;customer&quot;</span><span class="o">:</span><span class="s">&quot;Bob&quot;</span><span class="o">,</span><span class="s">&quot;product&quot;</span><span class="o">:</span><span class="s">&quot;orange&quot;</span><span class="o">,</span><span class="s">&quot;quantity&quot;</span><span class="o">:</span><span class="mi">6</span><span class="o">,</span><span class="s">&quot;price&quot;</span><span class="o">:</span><span class="mi">12</span><span class="o">,</span><span class="s">&quot;purchasetime&quot;</span><span class="o">:</span><span class="mi">1413399429578</span><span class="o">,</span><span class="s">&quot;catalogid&quot;</span><span class="o">:</span><span class="s">&quot;&quot;</span><span class="o">}]</span>           <span class="o">|</span>
<span class="o">+=====================================================================================================================================================================================================================================================================+</span>
</pre></div>
</div>
<p>If you prefer to use <tt class="docutils literal"><span class="pre">curl</span></tt> directly, here is the sequence of steps to execute:</p>
<p>First, submit the query for execution:</p>
<div class="highlight-java"><div class="highlight"><pre>curl -v -d &#39;{&quot;query&quot;: &quot;&#39;&quot;SELECT * FROM cdap_user_history WHERE customer IN (&#39;Alice&#39;,&#39;Bob&#39;)&quot;&#39;&quot;}&#39;
  -X POST http://localhost:10000/v2/data/explore/queries
</pre></div>
</div>
<p>Note that due to the mix and repetition of single and double quotes, it can be tricky to escape all quotes
correctly at the shell command prompt. On success, this will return a handle for the query, such as:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="o">{</span><span class="s">&quot;handle&quot;</span><span class="o">:</span><span class="s">&quot;363f8ceb-29fe-493d-810f-858ed0440782&quot;</span><span class="o">}</span>
</pre></div>
</div>
<p>This handle is needed to inquire about the status of the query and to retrieve query results. To get the
status, issue a GET to the query&#8217;s URL using the handle:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">curl</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">X</span> <span class="n">GET</span> <span class="nl">http:</span><span class="c1">//localhost:10000/v2/data/explore/queries/363f8ceb-29fe-493d-810f-858ed0440782/status</span>
</pre></div>
</div>
<p>Because a SQL query can run for several minutes, you may have to repeat the call until it returns a status of <em>finished</em>:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="o">{</span><span class="s">&quot;status&quot;</span><span class="o">:</span><span class="s">&quot;FINISHED&quot;</span><span class="o">,</span><span class="s">&quot;hasResults&quot;</span><span class="o">:</span><span class="kc">true</span><span class="o">}</span>
</pre></div>
</div>
<p>Once execution has finished, you can retrieve the results of the query using the handle:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">curl</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="nl">http:</span><span class="c1">//localhost:10000/v2/data/explore/queries/363f8ceb-29fe-493d-810f-858ed0440782/next</span>
</pre></div>
</div>
<p>This will return—up to a limited number—the results in JSON format:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="o">[{</span><span class="s">&quot;columns&quot;</span><span class="o">:[</span><span class="s">&quot;Alice&quot;</span><span class="o">,</span><span class="s">&quot;[{\&quot;customer\&quot;:\&quot;Alice\&quot;,\&quot;product\&quot;:\&quot;grapefruit\&quot;,\&quot;quantity\&quot;:12,\&quot;price\&quot;:10</span>
<span class="s">  \&quot;purchasetime\&quot;:1403737694225}]&quot;</span><span class="o">]},</span>
<span class="o">{</span><span class="s">&quot;columns&quot;</span><span class="o">:[</span><span class="s">&quot;Bob&quot;</span><span class="o">,</span><span class="s">&quot;[{\&quot;customer\&quot;:\&quot;Bob\&quot;,\&quot;product\&quot;:\&quot;orange\&quot;,\&quot;quantity\&quot;:6,\&quot;price\&quot;:12</span>
<span class="s">  \&quot;purchasetime\&quot;:1403737694226}]&quot;</span><span class="o">]}]</span>
</pre></div>
</div>
<p>You repeat this step until the <tt class="docutils literal"><span class="pre">curl</span></tt> call returns an empty list. That means you have retrieved all of the results and you can now close the query:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">curl</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">X</span> <span class="n">DELETE</span> <span class="nl">http:</span><span class="c1">//localhost:10000/v2/data/explore/queries/363f8ceb-29fe-493d-810f-858ed0440782</span>
</pre></div>
</div>
<p>Once done, you can stop the application as described in <a class="reference internal" href="#stop-application"><em>Building and Running Applications</em></a>.</p>
</div>
</div>
</div>
</div>
<div class="section" id="spark-k-means">
<span id="id11"></span><h3>Spark K-Means<a class="headerlink" href="#spark-k-means" title="Permalink to this headline">¶</a></h3>
<p>A Cask Data Application Platform (CDAP) Example Demonstrating Spark</p>
<div class="section" id="id12">
<h4>Overview<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p>This example demonstrates a Spark application performing streaming analysis, computing the centers of points from an
input stream using the KMeans Clustering method.</p>
<p>Data from a sample file is sent to CDAP by the external script <em>inject-data</em> to the <em>pointsStream</em>. This data is
processed by the <tt class="docutils literal"><span class="pre">PointsFlow</span></tt>, which stores the points coordinates event in its entirety in <em>points</em>, an ObjectStore Dataset.</p>
<p>As these entries are created, they are taken up by the <em>SparkKMeansProgram</em>, which
goes through the entries, calculates centers and tabulates results in another ObjectStore Dataset, <em>centers</em>.</p>
<p>Once the application completes, you can query the <em>centers</em> Dataset by using the <tt class="docutils literal"><span class="pre">centers</span></tt> method of the <em>CentersProcedure</em>. It will
send back a JSON-formatted result with the center&#8217;s coordinates based on the <tt class="docutils literal"><span class="pre">index</span></tt> parameter.</p>
<p>Let&#8217;s look at some of these elements, and then run the Application and see the results.</p>
</div>
<div class="section" id="the-sparkkmeans-application">
<h4>The SparkKMeans Application<a class="headerlink" href="#the-sparkkmeans-application" title="Permalink to this headline">¶</a></h4>
<p>As in the other <a class="reference external" href="index.html">examples</a>, the components
of the Application are tied together by the class <tt class="docutils literal"><span class="pre">SparkKMeansApp</span></tt>:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SparkKMeansApp</span> <span class="kd">extends</span> <span class="n">AbstractApplication</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Charset</span> <span class="n">UTF8</span> <span class="o">=</span> <span class="n">Charset</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">setName</span><span class="o">(</span><span class="s">&quot;SparkKMeans&quot;</span><span class="o">);</span>
    <span class="n">setDescription</span><span class="o">(</span><span class="s">&quot;Spark KMeans app&quot;</span><span class="o">);</span>

    <span class="c1">// Ingest data into the Application via a Stream</span>
    <span class="n">addStream</span><span class="o">(</span><span class="k">new</span> <span class="n">Stream</span><span class="o">(</span><span class="s">&quot;pointsStream&quot;</span><span class="o">));</span>

    <span class="c1">// Process points data in real-time using a Flow</span>
    <span class="n">addFlow</span><span class="o">(</span><span class="k">new</span> <span class="n">PointsFlow</span><span class="o">());</span>

    <span class="c1">// Run a Spark program on the acquired data</span>
    <span class="n">addSpark</span><span class="o">(</span><span class="k">new</span> <span class="n">SparkKMeansSpecification</span><span class="o">());</span>

    <span class="c1">// Query the processed data using a Procedure</span>
    <span class="n">addProcedure</span><span class="o">(</span><span class="k">new</span> <span class="n">CentersProcedure</span><span class="o">());</span>

    <span class="c1">// Store input and processed data in ObjectStore Datasets</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">ObjectStores</span><span class="o">.</span><span class="na">createObjectStore</span><span class="o">(</span><span class="n">getConfigurer</span><span class="o">(),</span> <span class="s">&quot;points&quot;</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="n">ObjectStores</span><span class="o">.</span><span class="na">createObjectStore</span><span class="o">(</span><span class="n">getConfigurer</span><span class="o">(),</span> <span class="s">&quot;centers&quot;</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UnsupportedTypeException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// This exception is thrown by ObjectStore if its parameter type cannot be</span>
      <span class="c1">// (de)serialized (for example, if it is an interface and not a class, then there is</span>
      <span class="c1">// no auto-magic way deserialize an object.) In this case that will not happen</span>
      <span class="c1">// because String is an actual class.</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="section" id="points-and-centers-objectstore-data-storage">
<h5><tt class="docutils literal"><span class="pre">points</span></tt> and <tt class="docutils literal"><span class="pre">centers</span></tt>: ObjectStore Data Storage<a class="headerlink" href="#points-and-centers-objectstore-data-storage" title="Permalink to this headline">¶</a></h5>
<p>The raw points data is stored in an ObjectStore Dataset, <em>points</em>.
The calculated centers data is stored in a second ObjectStore Dataset, <em>centers</em>.</p>
</div>
<div class="section" id="centersprocedure-procedure">
<h5><tt class="docutils literal"><span class="pre">CentersProcedure</span></tt>: Procedure<a class="headerlink" href="#centersprocedure-procedure" title="Permalink to this headline">¶</a></h5>
<p>This procedure has a <tt class="docutils literal"><span class="pre">centers</span></tt> method to obtain the center&#8217;s coordinates of a given index.</p>
<p>Deploy and start the application as described in  <a class="reference internal" href="#convention"><em>Building and Running Applications</em></a></p>
</div>
<div class="section" id="id13">
<h5>Running the Example<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h5>
<div class="section" id="injecting-points-data">
<h6>Injecting points data<a class="headerlink" href="#injecting-points-data" title="Permalink to this headline">¶</a></h6>
<p>Run this script to inject points data
to the Stream named <em>pointsStream</em> in the <tt class="docutils literal"><span class="pre">SparkKMeans</span></tt> application:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">$</span> <span class="o">./</span><span class="n">bin</span><span class="o">/</span><span class="n">inject</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="na">sh</span>
</pre></div>
</div>
<p>On Windows:</p>
<div class="highlight-java"><div class="highlight"><pre>~SDK&gt; bin\inject-data.bat
</pre></div>
</div>
</div>
<div class="section" id="running-the-spark-program">
<h6>Running the Spark program<a class="headerlink" href="#running-the-spark-program" title="Permalink to this headline">¶</a></h6>
<p>There are three ways to start the Spark program:</p>
<ol class="arabic">
<li><p class="first">Click on the <tt class="docutils literal"><span class="pre">SparkKMeansProgram</span></tt> in the Application page of the CDAP Console to get to the
Spark dialogue, then click the <em>Start</em> button.</p>
</li>
<li><p class="first">Send a query via an HTTP request using the <tt class="docutils literal"><span class="pre">curl</span></tt> command:</p>
<div class="highlight-java"><div class="highlight"><pre>curl -v -d &#39;{args=&quot;3&quot;}&#39; \
     -X POST &#39;http://localhost:10000/v2/apps/SparkKMeansProgram/spark/SparkKMeansProgram/start&#39;
</pre></div>
</div>
<p>On Windows, a copy of <tt class="docutils literal"><span class="pre">curl</span></tt> is located in the <tt class="docutils literal"><span class="pre">libexec</span></tt> directory of the SDK:</p>
<div class="highlight-java"><div class="highlight"><pre>libexec\curl...
</pre></div>
</div>
</li>
<li><p class="first">Use the command:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">$</span> <span class="o">./</span><span class="n">bin</span><span class="o">/</span><span class="n">app</span><span class="o">-</span><span class="n">manager</span><span class="o">.</span><span class="na">sh</span> <span class="o">--</span><span class="n">action</span> <span class="n">run</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><p>On Windows:</p>
<div class="highlight-java"><div class="highlight"><pre>~SDK&gt; bin\app-manager.bat run
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id14">
<h6>Querying the Results<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h6>
<p>If the Procedure has not already been started, you start it either through the
CDAP Console or via an HTTP request using the <tt class="docutils literal"><span class="pre">curl</span></tt> command:</p>
<div class="highlight-java"><div class="highlight"><pre>curl -v -X POST &#39;http://localhost:10000/v2/apps/SparkKMeans/procedures/CentersProcedure/start&#39;
</pre></div>
</div>
<p>There are two ways to query the <em>centers</em> ObjectStore through the <tt class="docutils literal"><span class="pre">CentersProcedure</span></tt> procedure:</p>
<ol class="arabic">
<li><p class="first">Send a query via an HTTP request using the <tt class="docutils literal"><span class="pre">curl</span></tt> command. For example:</p>
<div class="highlight-java"><div class="highlight"><pre>curl -v -d &#39;{&quot;index&quot;: &quot;1&quot;}&#39; \
 -X POST &#39;http://localhost:10000/v2/apps/SparkKMeans/procedures/CentersProcedure/methods/centers&#39;
</pre></div>
</div>
<p>On Windows, a copy of <tt class="docutils literal"><span class="pre">curl</span></tt> is located in the <tt class="docutils literal"><span class="pre">libexec</span></tt> directory of the SDK:</p>
<div class="highlight-java"><div class="highlight"><pre>libexec\curl...
</pre></div>
</div>
</li>
<li><p class="first">Type a Procedure method name, in this case CentersProcedure, in the Query page of the CDAP Console:</p>
<p>In the CDAP Console:</p>
<ol class="arabic">
<li><p class="first">Click the <em>Query</em> button.</p>
</li>
<li><p class="first">Click on the <em>CentersProcedure</em> Procedure.</p>
</li>
<li><p class="first">Type <tt class="docutils literal"><span class="pre">centers</span></tt> in the <em>Method</em> text box.</p>
</li>
<li><p class="first">Type the parameters required for this method, a JSON string with the name <em>index</em> and
value of the index &#8220;1&#8221;:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="o">{</span> <span class="s">&quot;index&quot;</span> <span class="o">:</span> <span class="s">&quot;1&quot;</span> <span class="o">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Click the <em>Execute</em> button.</p>
</li>
<li><p class="first">The center&#8217;s coordinates will be displayed in the Console in JSON format. For example:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="s">&quot;9.1,9.1,9.1&quot;</span>
</pre></div>
</div>
</li>
</ol>
</li>
</ol>
<p>Once done, you can stop the application as described in <a class="reference internal" href="#stop-application"><em>Building and Running Applications</em></a>.</p>
</div>
</div>
</div>
</div>
<div class="section" id="sparkpagerank-application-example">
<span id="spark-page-rank"></span><h3>SparkPageRank Application Example<a class="headerlink" href="#sparkpagerank-application-example" title="Permalink to this headline">¶</a></h3>
<p>A Cask Data Application Platform (CDAP) Example Demonstrating Spark</p>
<div class="section" id="id15">
<h4>Overview<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<p>This example demonstrates a Spark application performing streaming log analysis, computing the page rank based on
information about backlink URLs.</p>
<p>Data from a sample file is sent to CDAP by the external script <em>inject-data</em>
to the <em>backlinkURLStream</em>. This data is processed by the
<tt class="docutils literal"><span class="pre">BackLinkFlow</span></tt>, which stores the URL pair event in its entirety in <em>backlinkURLs</em>, an ObjectStore Dataset.</p>
<p>As these entries are created, they are taken up by the <em>SparkPageRankProgram</em>, which
goes through the entries, calculates page rank and tabulates results in another ObjectStore Dataset, <em>ranks</em>.</p>
<p>Once the application completes, you can query the <em>ranks</em> Dataset by using the <tt class="docutils literal"><span class="pre">rank</span></tt> method of the <em>RanksProcedure</em>.
It will send back a JSON-formatted result with page rank based on the <tt class="docutils literal"><span class="pre">url</span></tt> parameter.</p>
<p>Let&#8217;s look at some of these elements, and then run the Application and see the results.</p>
</div>
<div class="section" id="the-sparkpagerank-application">
<h4>The SparkPageRank Application<a class="headerlink" href="#the-sparkpagerank-application" title="Permalink to this headline">¶</a></h4>
<p>As in the other <a class="reference external" href="index.html">examples</a>, the components
of the Application are tied together by the class <tt class="docutils literal"><span class="pre">SparkPageRankApp</span></tt>:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SparkPageRankApp</span> <span class="kd">extends</span> <span class="n">AbstractApplication</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Charset</span> <span class="n">UTF8</span> <span class="o">=</span> <span class="n">Charset</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&quot;UTF-8&quot;</span><span class="o">);</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">setName</span><span class="o">(</span><span class="s">&quot;SparkPageRank&quot;</span><span class="o">);</span>
    <span class="n">setDescription</span><span class="o">(</span><span class="s">&quot;Spark page rank app&quot;</span><span class="o">);</span>

    <span class="c1">// Ingest data into the Application via a Stream</span>
    <span class="n">addStream</span><span class="o">(</span><span class="k">new</span> <span class="n">Stream</span><span class="o">(</span><span class="s">&quot;backlinkURLStream&quot;</span><span class="o">));</span>

    <span class="c1">// Process URL pairs in real-time using a Flow</span>
    <span class="n">addFlow</span><span class="o">(</span><span class="k">new</span> <span class="n">BackLinkFlow</span><span class="o">());</span>

    <span class="c1">// Run a Spark program on the acquired data</span>
    <span class="n">addSpark</span><span class="o">(</span><span class="k">new</span> <span class="n">SparkPageRankSpecification</span><span class="o">());</span>

    <span class="c1">// Query the processed data using a Procedure</span>
    <span class="n">addProcedure</span><span class="o">(</span><span class="k">new</span> <span class="n">RanksProcedure</span><span class="o">());</span>

    <span class="c1">// Store input and processed data in ObjectStore Datasets</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">ObjectStores</span><span class="o">.</span><span class="na">createObjectStore</span><span class="o">(</span><span class="n">getConfigurer</span><span class="o">(),</span> <span class="s">&quot;backlinkURLs&quot;</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="n">ObjectStores</span><span class="o">.</span><span class="na">createObjectStore</span><span class="o">(</span><span class="n">getConfigurer</span><span class="o">(),</span> <span class="s">&quot;ranks&quot;</span><span class="o">,</span> <span class="n">Double</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">UnsupportedTypeException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// This exception is thrown by ObjectStore if its parameter type cannot be</span>
      <span class="c1">// (de)serialized (for example, if it is an interface and not a class, then there is</span>
      <span class="c1">// no auto-magic way deserialize an object.) In this case that will not happen</span>
      <span class="c1">// because String and Double are actual classes.</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="section" id="backlinkurls-and-ranks-objectstore-data-storage">
<h5><tt class="docutils literal"><span class="pre">backlinkURLs</span></tt> and <tt class="docutils literal"><span class="pre">ranks</span></tt>: ObjectStore Data Storage<a class="headerlink" href="#backlinkurls-and-ranks-objectstore-data-storage" title="Permalink to this headline">¶</a></h5>
<p>The raw URL pair data is stored in an ObjectStore Dataset, <em>backlinkURLs</em>.
The calculated page rank data is stored in a second ObjectStore Dataset, <em>ranks</em>.</p>
</div>
<div class="section" id="ranksprocedure-procedure">
<h5><tt class="docutils literal"><span class="pre">RanksProcedure</span></tt>: Procedure<a class="headerlink" href="#ranksprocedure-procedure" title="Permalink to this headline">¶</a></h5>
<p>This procedure has a <tt class="docutils literal"><span class="pre">rank</span></tt> method to obtain the page rank of a given URL.</p>
<p>Deploy and start the application as described in  <a class="reference internal" href="#convention"><em>Building and Running Applications</em></a></p>
</div>
<div class="section" id="id16">
<h5>Running the Example<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h5>
<div class="section" id="injecting-url-pairs">
<h6>Injecting URL Pairs<a class="headerlink" href="#injecting-url-pairs" title="Permalink to this headline">¶</a></h6>
<p>Run this script to inject URL pairs
to the Stream named <em>backlinkURLStream</em> in the <tt class="docutils literal"><span class="pre">SparkPageRank</span></tt> application:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">$</span> <span class="o">./</span><span class="n">bin</span><span class="o">/</span><span class="n">inject</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="na">sh</span>
</pre></div>
</div>
<p>On Windows:</p>
<div class="highlight-java"><div class="highlight"><pre>~SDK&gt; bin\inject-data.bat
</pre></div>
</div>
</div>
<div class="section" id="id17">
<h6>Running the Spark Program<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h6>
<p>There are three ways to start the Spark program:</p>
<ol class="arabic">
<li><p class="first">Click on the <tt class="docutils literal"><span class="pre">SparkPageRankProgram</span></tt> in the Application page of the CDAP Console to get to the
Spark dialogue, then click the <em>Start</em> button.</p>
</li>
<li><p class="first">Send a query via an HTTP request using the <tt class="docutils literal"><span class="pre">curl</span></tt> command:</p>
<div class="highlight-java"><div class="highlight"><pre>curl -v -d &#39;{args=&quot;3&quot;}&#39; \
     -X POST &#39;http://localhost:10000/v2/apps/SparkPageRank/spark/SparkPageRankProgram/start&#39;
</pre></div>
</div>
<p>On Windows, the copy of <tt class="docutils literal"><span class="pre">curl</span></tt> is located in the <tt class="docutils literal"><span class="pre">libexec</span></tt> directory of the SDK:</p>
<div class="highlight-java"><div class="highlight"><pre>libexec\curl...
</pre></div>
</div>
</li>
<li><p class="first">Use the command:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">$</span> <span class="o">./</span><span class="n">bin</span><span class="o">/</span><span class="n">app</span><span class="o">-</span><span class="n">manager</span><span class="o">.</span><span class="na">sh</span> <span class="o">--</span><span class="n">action</span> <span class="n">run</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><p>On Windows:</p>
<div class="highlight-java"><div class="highlight"><pre>~SDK&gt; bin\app-manager.bat run
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id18">
<h6>Querying the Results<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h6>
<p>If the Procedure has not already been started, you start it either through the
CDAP Console or via an HTTP request using the <tt class="docutils literal"><span class="pre">curl</span></tt> command:</p>
<div class="highlight-java"><div class="highlight"><pre>curl -v -X POST &#39;http://localhost:10000/v2/apps/SparkPageRank/procedures/RanksProcedure/start&#39;
</pre></div>
</div>
<p>There are two ways to query the <em>ranks</em> ObjectStore through the <tt class="docutils literal"><span class="pre">RanksProcedure</span></tt> procedure:</p>
<ol class="arabic">
<li><p class="first">Send a query via an HTTP request using the <tt class="docutils literal"><span class="pre">curl</span></tt> command. For example:</p>
<div class="highlight-java"><div class="highlight"><pre>curl -v -d &#39;{&quot;url&quot;: &quot;http://example.com/page1&quot;}&#39; \
 -X POST &#39;http://localhost:10000/v2/apps/SparkPageRank/procedures/RanksProcedure/methods/rank&#39;
</pre></div>
</div>
<p>On Windows, the copy of <tt class="docutils literal"><span class="pre">curl</span></tt> is located in the <tt class="docutils literal"><span class="pre">libexec</span></tt> directory of the SDK:</p>
<div class="highlight-java"><div class="highlight"><pre>libexec\curl...
</pre></div>
</div>
</li>
<li><p class="first">Type a Procedure method name, in this case <tt class="docutils literal"><span class="pre">RanksProcedure</span></tt>, in the Query page of the CDAP Console:</p>
<blockquote>
<div><p>In the CDAP Console:</p>
<ol class="arabic simple">
<li>Click the <em>Query</em> button.</li>
<li>Click on the <em>RanksProcedure</em> Procedure.</li>
<li>Type <tt class="docutils literal"><span class="pre">rank</span></tt> in the <em>Method</em> text box.</li>
<li>Type the parameters required for this method, a JSON string with the name <em>url</em> and
value of a URI, <tt class="docutils literal"><span class="pre">&quot;http://example.com/page1&quot;</span></tt>:</li>
</ol>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="o">{</span> <span class="s">&quot;url&quot;</span> <span class="o">:</span> <span class="s">&quot;http://example.com/page1&quot;</span> <span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple">
<li>Click the <em>Execute</em> button.</li>
<li>The rank for that URL will be displayed in the Console in JSON format.
For example:</li>
</ol>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span class="s">&quot;0.9988696312751688&quot;</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</li>
</ol>
<p>Once done, you can stop the application as described in <a class="reference internal" href="#stop-application"><em>Building and Running Applications</em></a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="what-s-next">
<h2>What&#8217;s Next<a class="headerlink" href="#what-s-next" title="Permalink to this headline">¶</a></h2>
<p>You can learn more about developing data application using CDAP by:</p>
<ul class="simple">
<li>Exploring the Web Analytics Application source code. It includes test cases that show unit-testing an
application.</li>
<li>Look at a CDAP case study: <a class="reference external" href="case_study.html">Web Analytics using CDAP.</a></li>
<li>For a detailed understanding of what CDAP is capable of, read our <a class="reference external" href="dev-guide.html">Programming Guide.</a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><!--
  Copyright © 2014 Cask Data, Inc.

  Licensed under the Apache License, Version 2.0 (the "License"); you may not
  use this file except in compliance with the License. You may obtain a copy of
  the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
  License for the specific language governing permissions and limitations under
  the License.
-->

<h3><a href="index.html">Table of Contents</a></h3>
<nav>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction-to-the-cdap-sdk">Introduction to the CDAP SDK</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#system-requirements-and-dependencies">System Requirements and Dependencies</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#download-and-setup">Download and Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#binary-zip-file">Binary Zip File</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cdap-standalone-virtual-machine-image">CDAP Standalone Virtual Machine Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cdap-standalone-docker-image">CDAP Standalone Docker Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="#starting-and-stopping-the-standalone-cdap">Starting and Stopping the Standalone CDAP</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-application">Creating an Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="#first-steps">First Steps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#web-analytics-application">Web Analytics Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-and-run">Build and Run</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-it-works">How It Works</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#other-example-applications">Other Example Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#building-and-running-applications">Building and Running Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#helloworld">HelloWorld</a></li>
<li class="toctree-l3"><a class="reference internal" href="#word-count">Word Count</a></li>
<li class="toctree-l3"><a class="reference internal" href="#count-random">Count Random</a></li>
<li class="toctree-l3"><a class="reference internal" href="#purchase">Purchase</a></li>
<li class="toctree-l3"><a class="reference internal" href="#spark-k-means">Spark K-Means</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sparkpagerank-application-example">SparkPageRank Application Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#what-s-next">What&#8217;s Next</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="case_study.html">Case Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="arch.html">Concepts and Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="apps-packs.html">Apps and Packs</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">APIs and Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="javadocs/index.html">Javadocs</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin.html">Administration and Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="licenses/index.html">Licenses and Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="releasenotes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq/index.html">FAQ</a></li>
</ul>

</nav>
  <h4>Previous Topic</h4>
  <p class="topless"><a href="intro.html"
                        title="Previous Chapter">Introduction to the Cask Data Application Platform</a></p>
  <h4>Next Topic</h4>
  <p class="topless"><a href="case_study.html"
                        title="Next Chapter">CDAP Application Case Study</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick Search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014 Cask Data, Inc.
    </div>
  </body>
</html>