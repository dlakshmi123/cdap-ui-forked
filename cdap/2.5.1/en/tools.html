<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="robots" content="noindex, nofollow">

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-55081520-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <title>Cask Data Application Platform - Available Tools &mdash; Cask Data Application Platform 2.5.1 Documentation</title>
    
    <link rel="stylesheet" href="_static/cdap.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.5.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Cask Data Application Platform 2.5.1 Documentation" href="index.html" />
    <link rel="next" title="Cask Data Application Platform Administration and Operations Guide" href="admin.html" />
    <link rel="prev" title="Javadocs" href="javadocs/index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="admin.html" title="Cask Data Application Platform Administration and Operations Guide"
             accesskey="N">Next</a> |</li>
        <li class="right" >
          <a href="javadocs/index.html" title="Javadocs"
             accesskey="P">Previous</a> |</li>
        <li><a href="index.html">Cask Data Application Platform 2.5.1 Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="cask-data-application-platform-available-tools">
<h1>Cask Data Application Platform - Available Tools<a class="headerlink" href="#cask-data-application-platform-available-tools" title="Permalink to this headline">¶</a></h1>
<div class="section" id="tools-overview">
<h2>Tools Overview<a class="headerlink" href="#tools-overview" title="Permalink to this headline">¶</a></h2>
<p>CDAP comes with a number of tools to make a developer&#8217;s life easier. These tools
help with debugging CDAP applications, interacting with applications,
ingesting data into CDAP, and fetching access tokens:</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Tool Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="#testframework"><em>Test Framework</em></a></td>
<td>How you can take advantage of the test framework to test your CDAP applications before deploying.
This makes catching bugs early and easy.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#debugcdap"><em>Debugging</em></a></td>
<td>How you can debug CDAP applications in standalone mode and app containers in distributed mode.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#txdebugger"><em>Transactions Debugger</em></a></td>
<td>Snapshot and inspect the state of Transaction Manager.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#ingest"><em>Ingestion Tools</em></a></td>
<td>Tools for ingesting data into CDAP.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#authentication-clients"><em>Authentication Clients</em></a></td>
<td>Tools for fetching access tokens from the authentication service.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="testing-cdap">
<span id="testframework"></span><h2>Testing CDAP<a class="headerlink" href="#testing-cdap" title="Permalink to this headline">¶</a></h2>
<div class="section" id="strategies-in-testing-applications">
<h3>Strategies in Testing Applications<a class="headerlink" href="#strategies-in-testing-applications" title="Permalink to this headline">¶</a></h3>
<p>CDAP comes with a convenient way to unit test your Applications.
The base for these tests is <tt class="docutils literal"><span class="pre">TestBase</span></tt>, which is packaged
separately from the API in its own artifact because it depends on the
CDAP’s runtime classes. You can include it in your test dependencies
in one of two ways:</p>
<ul class="simple">
<li>include all JAR files in the <tt class="docutils literal"><span class="pre">lib</span></tt> directory of the CDAP SDK installation,
or</li>
<li>include the <tt class="docutils literal"><span class="pre">cdap-unit-test</span></tt> artifact in your Maven test dependencies
(see the <tt class="docutils literal"><span class="pre">pom.xml</span></tt> file of the <em>WordCount</em> example).</li>
</ul>
<p>Note that for building an application, you only need to include the
CDAP API in your dependencies. For testing, however, you need the
CDAP run-time. To build your test case, extend the
<tt class="docutils literal"><span class="pre">TestBase</span></tt> class.</p>
</div>
<div class="section" id="strategies-in-testing-flows">
<h3>Strategies in Testing Flows<a class="headerlink" href="#strategies-in-testing-flows" title="Permalink to this headline">¶</a></h3>
<p>Let’s write a test case for the <em>WordCount</em> example:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WordCountTest</span> <span class="kd">extends</span> <span class="n">TestBase</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testWordCount</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</pre></div>
</div>
<p>The first thing we do in this test is deploy the application,
then we’ll start the Flow and the Procedure:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">// Deploy the Application</span>
<span class="n">ApplicationManager</span> <span class="n">appManager</span> <span class="o">=</span> <span class="n">deployApplication</span><span class="o">(</span><span class="n">WordCount</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="c1">// Start the Flow and the Procedure</span>
<span class="n">FlowManager</span> <span class="n">flowManager</span> <span class="o">=</span> <span class="n">appManager</span><span class="o">.</span><span class="na">startFlow</span><span class="o">(</span><span class="s">&quot;WordCounter&quot;</span><span class="o">);</span>
<span class="n">ProcedureManager</span> <span class="n">procManager</span> <span class="o">=</span> <span class="n">appManager</span><span class="o">.</span><span class="na">startProcedure</span><span class="o">(</span><span class="s">&quot;RetrieveCount&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>Now that the Flow is running, we can send some events to the Stream:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">// Send a few events to the Stream</span>
<span class="n">StreamWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="n">appManager</span><span class="o">.</span><span class="na">getStreamWriter</span><span class="o">(</span><span class="s">&quot;wordStream&quot;</span><span class="o">);</span>
<span class="n">writer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">&quot;hello world&quot;</span><span class="o">);</span>
<span class="n">writer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">&quot;a wonderful world&quot;</span><span class="o">);</span>
<span class="n">writer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">&quot;the world says hello&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>To wait for all events to be processed, we can get a metrics observer
for the last Flowlet in the pipeline (the &#8220;word associator&#8221;) and wait for
its processed count to either reach 3 or time out after 5 seconds:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">// Wait for the events to be processed, or at most 5 seconds</span>
<span class="n">RuntimeMetrics</span> <span class="n">metrics</span> <span class="o">=</span> <span class="n">RuntimeStats</span><span class="o">.</span>
  <span class="n">getFlowletMetrics</span><span class="o">(</span><span class="s">&quot;WordCount&quot;</span><span class="o">,</span> <span class="s">&quot;WordCounter&quot;</span><span class="o">,</span> <span class="s">&quot;associator&quot;</span><span class="o">);</span>
<span class="n">metrics</span><span class="o">.</span><span class="na">waitForProcessed</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
</pre></div>
</div>
<p>Now we can start verifying that the processing was correct by obtaining
a client for the Procedure, and then submitting a query for the global
statistics:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">// Call the Procedure</span>
<span class="n">ProcedureClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">procManager</span><span class="o">.</span><span class="na">getClient</span><span class="o">();</span>

<span class="c1">// Query global statistics</span>
<span class="n">String</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="s">&quot;getStats&quot;</span><span class="o">,</span> <span class="n">Collections</span><span class="o">.</span><span class="na">EMPTY_MAP</span><span class="o">);</span>
</pre></div>
</div>
<p>If the query fails for any reason this method would throw an exception.
In case of success, the response is a JSON string. We must deserialize
the JSON string to verify the results:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Gson</span><span class="o">().</span><span class="na">fromJson</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="n">stringMapType</span><span class="o">);</span>
<span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="s">&quot;9&quot;</span><span class="o">,</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;totalWords&quot;</span><span class="o">));</span>
<span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="s">&quot;6&quot;</span><span class="o">,</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;uniqueWords&quot;</span><span class="o">));</span>
<span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(((</span><span class="kt">double</span><span class="o">)</span><span class="mi">42</span><span class="o">)/</span><span class="mi">9</span><span class="o">,</span>
  <span class="o">(</span><span class="kt">double</span><span class="o">)</span><span class="n">Double</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;averageLength&quot;</span><span class="o">)),</span> <span class="mf">0.001</span><span class="o">);</span>
</pre></div>
</div>
<p>Then we ask for the statistics of one of the words in the test events.
The verification is a little more complex, because we have a nested map
as a response, and the value types in the top-level map are not uniform:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">// Verify some statistics for one of the words</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="s">&quot;getCount&quot;</span><span class="o">,</span> <span class="n">ImmutableMap</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">&quot;word&quot;</span><span class="o">,</span><span class="s">&quot;world&quot;</span><span class="o">));</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">omap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Gson</span><span class="o">().</span><span class="na">fromJson</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="n">objectMapType</span><span class="o">);</span>
<span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="s">&quot;world&quot;</span><span class="o">,</span> <span class="n">omap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;word&quot;</span><span class="o">));</span>
<span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="mf">3.0</span><span class="o">,</span> <span class="n">omap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;count&quot;</span><span class="o">));</span>

<span class="c1">// The associations are a map within the map</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">assocs</span> <span class="o">=</span> <span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;)</span> <span class="n">omap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;assocs&quot;</span><span class="o">);</span>
<span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="o">(</span><span class="kt">double</span><span class="o">)</span><span class="n">assocs</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;hello&quot;</span><span class="o">),</span> <span class="mf">0.000001</span><span class="o">);</span>
<span class="n">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span><span class="n">assocs</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="s">&quot;hello&quot;</span><span class="o">));</span>
</pre></div>
</div>
</div>
<div class="section" id="strategies-in-testing-mapreduce-jobs">
<h3>Strategies in Testing MapReduce Jobs<a class="headerlink" href="#strategies-in-testing-mapreduce-jobs" title="Permalink to this headline">¶</a></h3>
<p>In a fashion similar to <a class="reference internal" href="#strategies-in-testing-flows">Strategies in Testing Flows</a>, we can write
unit testing for MapReduce jobs. Let&#8217;s write a test case for an
application that uses MapReduce. Complete source code and test can be
found in the <a class="reference internal" href="getstarted.html#purchase"><em>Purchase Example</em></a> included in the CDAP SDK.</p>
<p>The <tt class="docutils literal"><span class="pre">PurchaseTest</span></tt> class should extend from
<tt class="docutils literal"><span class="pre">TestBase</span></tt> similar to <cite>Strategies in Testing Flows</cite>:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PurchaseTest</span> <span class="kd">extends</span> <span class="n">TestBase</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">PurchaseApp</span></tt> application can be deployed using the <tt class="docutils literal"><span class="pre">deployApplication</span></tt>
method from the <tt class="docutils literal"><span class="pre">TestBase</span></tt> class:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">// Deploy an Application</span>
<span class="n">ApplicationManager</span> <span class="n">appManager</span> <span class="o">=</span> <span class="n">deployApplication</span><span class="o">(</span><span class="n">PurchaseApp</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</pre></div>
</div>
<p>The MapReduce job reads from the <tt class="docutils literal"><span class="pre">purchases</span></tt> Dataset. As a first
step, the data to the <tt class="docutils literal"><span class="pre">purchases</span></tt> should be populated by running
the <tt class="docutils literal"><span class="pre">PurchaseFlow</span></tt> and sending the data to the <tt class="docutils literal"><span class="pre">purchaseStream</span></tt>
Stream:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">FlowManager</span> <span class="n">flowManager</span> <span class="o">=</span> <span class="n">appManager</span><span class="o">.</span><span class="na">startFlow</span><span class="o">(</span><span class="s">&quot;PurchaseFlow&quot;</span><span class="o">);</span>
<span class="c1">// Send data to the Stream</span>
<span class="n">sendData</span><span class="o">(</span><span class="n">appManager</span><span class="o">,</span> <span class="n">now</span><span class="o">);</span>

<span class="c1">// Wait for the last Flowlet to process 3 events or at most 5 seconds</span>
<span class="n">RuntimeMetrics</span> <span class="n">metrics</span> <span class="o">=</span> <span class="n">RuntimeStats</span><span class="o">.</span>
    <span class="n">getFlowletMetrics</span><span class="o">(</span><span class="s">&quot;PurchaseApp&quot;</span><span class="o">,</span> <span class="s">&quot;PurchaseFlow&quot;</span><span class="o">,</span> <span class="s">&quot;collector&quot;</span><span class="o">);</span>
<span class="n">metrics</span><span class="o">.</span><span class="na">waitForProcessed</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
</pre></div>
</div>
<p>Start the MapReduce job and wait for a maximum of 60 seconds:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">// Start the MapReduce job.</span>
<span class="n">MapReduceManager</span> <span class="n">mrManager</span> <span class="o">=</span> <span class="n">appManager</span><span class="o">.</span><span class="na">startMapReduce</span><span class="o">(</span><span class="s">&quot;PurchaseHistoryBuilder&quot;</span><span class="o">);</span>
<span class="n">mrManager</span><span class="o">.</span><span class="na">waitForFinish</span><span class="o">(</span><span class="mi">60</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
</pre></div>
</div>
<p>We can start verifying that the MapReduce job was run correctly by
obtaining a client for the Procedure, and then submitting a query for
the counts:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">ProcedureClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">procedureManager</span><span class="o">.</span><span class="na">getClient</span><span class="o">();</span>

<span class="c1">// Verify the query.</span>
<span class="n">String</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="s">&quot;history&quot;</span><span class="o">,</span> <span class="n">ImmutableMap</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">&quot;customer&quot;</span><span class="o">,</span> <span class="s">&quot;joe&quot;</span><span class="o">));</span>

<span class="c1">// Deserialize the JSON string.</span>
<span class="n">PurchaseHistory</span> <span class="n">result</span> <span class="o">=</span> <span class="n">GSON</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">response</span><span class="o">,</span> <span class="n">PurchaseHistory</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">getPurchases</span><span class="o">().</span><span class="na">size</span><span class="o">());</span>
</pre></div>
</div>
<p>The assertion will verify that the correct result was received.</p>
</div>
<div class="section" id="strategies-in-testing-spark-programs">
<h3>Strategies in Testing Spark Programs<a class="headerlink" href="#strategies-in-testing-spark-programs" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s write a test case for an application that uses a Spark program.
Complete source code for this test can be found at <a class="reference internal" href="getstarted.html#spark-page-rank"><em>Spark PageRank</em></a>.</p>
<p>The <tt class="docutils literal"><span class="pre">SparkPageRankTest</span></tt> class should extend from
<tt class="docutils literal"><span class="pre">TestBase</span></tt> similar to <cite>Strategies in Testing Flows</cite>:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SparkPageRankTest</span> <span class="kd">extends</span> <span class="n">TestBase</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">SparkPageRankTest</span></tt> application can be deployed using the <tt class="docutils literal"><span class="pre">deployApplication</span></tt>
method from the <tt class="docutils literal"><span class="pre">TestBase</span></tt> class:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">// Deploy an Application</span>
<span class="n">ApplicationManager</span> <span class="n">appManager</span> <span class="o">=</span> <span class="n">deployApplication</span><span class="o">(</span><span class="n">SparkPageRankApp</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</pre></div>
</div>
<p>The Spark program reads from the <tt class="docutils literal"><span class="pre">backlinkURLs</span></tt> Dataset. As a first
step, data in the <tt class="docutils literal"><span class="pre">backlinkURLs</span></tt> should be populated by running
the <tt class="docutils literal"><span class="pre">BackLinkFlow</span></tt> and sending the data to the Stream <tt class="docutils literal"><span class="pre">backlinkURLStream</span></tt>:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">FlowManager</span> <span class="n">flowManager</span> <span class="o">=</span> <span class="n">appManager</span><span class="o">.</span><span class="na">startFlow</span><span class="o">(</span><span class="s">&quot;BackLinkFlow&quot;</span><span class="o">);</span>
<span class="c1">// Send data to the Stream</span>
<span class="n">sendData</span><span class="o">(</span><span class="n">appManager</span><span class="o">);</span>

<span class="c1">// Wait for the last Flowlet to process 4 events or at most 5 seconds</span>
<span class="n">RuntimeMetrics</span> <span class="n">metrics</span> <span class="o">=</span> <span class="n">RuntimeStats</span><span class="o">.</span>
    <span class="n">getFlowletMetrics</span><span class="o">(</span><span class="s">&quot;SparkPageRank&quot;</span><span class="o">,</span> <span class="s">&quot;BackLinkFlow&quot;</span><span class="o">,</span> <span class="s">&quot;reader&quot;</span><span class="o">);</span>
<span class="n">metrics</span><span class="o">.</span><span class="na">waitForProcessed</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
</pre></div>
</div>
<p>Start the Spark program and wait for a maximum of 60 seconds:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">// Start the Spark program.</span>
<span class="n">SparkManager</span> <span class="n">sparkManager</span> <span class="o">=</span> <span class="n">appManager</span><span class="o">.</span><span class="na">startSpark</span><span class="o">(</span><span class="s">&quot;SparkPageRankProgram&quot;</span><span class="o">);</span>
<span class="n">sparkManager</span><span class="o">.</span><span class="na">waitForFinish</span><span class="o">(</span><span class="mi">60</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
</pre></div>
</div>
<p>We verify that the Spark program ran correctly by
obtaining a client for the Procedure, and then submitting a query for
the ranks:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">ProcedureClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">procedureManager</span><span class="o">.</span><span class="na">getClient</span><span class="o">();</span>

<span class="c1">// Verify the query.</span>
<span class="n">String</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="s">&quot;rank&quot;</span><span class="o">,</span> <span class="n">ImmutableMap</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">&quot;url&quot;</span><span class="o">,</span> <span class="s">&quot;http://example.com/page1&quot;</span><span class="o">));</span>
<span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="s">&quot;1.3690036520596678&quot;</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</pre></div>
</div>
<p>The assertion will verify that the correct result was received.</p>
</div>
<div class="section" id="validating-test-data-with-sql">
<h3>Validating Test Data with SQL<a class="headerlink" href="#validating-test-data-with-sql" title="Permalink to this headline">¶</a></h3>
<p>Often the easiest way to verify that a test produced the right data is to run a SQL query - if the data sets involved
in the test case are record-scannable as described in <a class="reference internal" href="dev-guide.html#data-explore"><em>Data Exploration</em></a>
This can be done using a JDBC connection obtained from the test base:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="c1">// Obtain a JDBC connection</span>
<span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">getQueryClient</span><span class="o">();</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="c1">// Run a query over the dataset</span>
  <span class="n">results</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="s">&quot;SELECT key FROM mytable WHERE value = &#39;1&#39;&quot;</span><span class="o">).</span><span class="na">executeQuery</span><span class="o">();</span>
  <span class="n">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span><span class="n">results</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
  <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="s">&quot;a&quot;</span><span class="o">,</span> <span class="n">results</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
  <span class="n">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span><span class="n">results</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
  <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="s">&quot;c&quot;</span><span class="o">,</span> <span class="n">results</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
  <span class="n">Assert</span><span class="o">.</span><span class="na">assertFalse</span><span class="o">(</span><span class="n">results</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>

<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">results</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
  <span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The JDBC connection does not implement the full JDBC functionality: it does not allow variable replacement and
will not allow you to make any changes to datasets. But it is sufficient to perform test validation: you can create
or prepare statements and execute queries, then iterate over the results set and validate its correctness.</p>
</div>
</div>
<div class="section" id="debugging-cdap">
<span id="debugcdap"></span><h2>Debugging CDAP<a class="headerlink" href="#debugging-cdap" title="Permalink to this headline">¶</a></h2>
<div class="section" id="debugging-an-application-in-standalone-cdap">
<h3>Debugging an Application in Standalone CDAP<a class="headerlink" href="#debugging-an-application-in-standalone-cdap" title="Permalink to this headline">¶</a></h3>
<p>Any CDAP Application can be debugged in the Standalone CDAP
by attaching a remote debugger to the CDAP JVM. To enable remote
debugging:</p>
<ol class="arabic">
<li><p class="first">Start the Standalone CDAP with <tt class="docutils literal"><span class="pre">--enable-debug</span></tt>, optionally specifying a port (default is <tt class="docutils literal"><span class="pre">5005</span></tt>).</p>
<p>The CDAP should confirm that the debugger port is open with a message such as
<tt class="docutils literal"><span class="pre">Remote</span> <span class="pre">debugger</span> <span class="pre">agent</span> <span class="pre">started</span> <span class="pre">on</span> <span class="pre">port</span> <span class="pre">5005</span></tt>.</p>
</li>
<li><p class="first">Deploy (for example) the <em>HelloWorld</em> Application to the CDAP by dragging and dropping the
<tt class="docutils literal"><span class="pre">HelloWorld.jar</span></tt> file from the <tt class="docutils literal"><span class="pre">/examples/HelloWorld</span></tt> directory onto the CDAP Console.</p>
</li>
<li><p class="first">Open the <em>HelloWorld</em> Application in an IDE and connect to the remote debugger.</p>
</li>
</ol>
<p>For more information, see <a class="reference internal" href="#attaching-a-debugger">Attaching a Debugger</a>.</p>
<p><strong>Note:</strong> Currently, debugging is not supported under Windows.</p>
</div>
<div class="section" id="debugging-an-application-in-distributed-cdap">
<h3>Debugging an Application in Distributed CDAP<a class="headerlink" href="#debugging-an-application-in-distributed-cdap" title="Permalink to this headline">¶</a></h3>
<p>In distributed mode, an application does not run in a single JVM. Instead, its programs
are dispersed over multiple—if not many—containers in the Hadoop cluster. There is no
single place to debug the entire application.</p>
<p>You can, however, debug every individual container by attaching a remote debugger to it.
This is supported for each Flowlet of a Flow and each instance of a Procedure. In order
to debug a container, you need to start the element with debugging enabled by making
an HTTP request to the element’s URL. For example, the following will start a Flow for debugging:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">POST &lt;base-url&gt;/apps/WordCount/flows/WordCounter/debug</span>
</pre></div>
</div>
<p>Note that this URL differs from the URL for starting the Flow only by the last path
component (<tt class="docutils literal"><span class="pre">debug</span></tt> instead of <tt class="docutils literal"><span class="pre">start</span></tt>; see
<a class="reference internal" href="api.html#cdap-client-http-api"><em>CDAP Client HTTP API</em></a>). You can pass in
runtime arguments in the exact same way as you normally would start a Flow.</p>
<p>Once the Flow is running, each Flowlet will detect an available port in its container
and open that port for attaching a debugger.
To find out the address of a container’s host and the container’s debug port, you can query
the CDAP for a Procedure or Flow’s live info via HTTP:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">GET &lt;base-url&gt;/apps/WordCount/flows/WordCounter/live-info</span>
</pre></div>
</div>
<p>The response is formatted in JSON and—pretty-printed— would look similar to this:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">{</span>
<span class="go">  &quot;app&quot;: &quot;WordCount&quot;,</span>
<span class="go">  &quot;containers&quot;: [</span>
<span class="go">    {</span>
<span class="go">      &quot;container&quot;: &quot;container_1397069870124_0010_01_000002&quot;,</span>
<span class="go">      &quot;debugPort&quot;: 42071,</span>
<span class="go">      &quot;host&quot;: &quot;node-1004.my.cluster.net&quot;,</span>
<span class="go">      &quot;instance&quot;: 0,</span>
<span class="go">      &quot;memory&quot;: 512,</span>
<span class="go">      &quot;name&quot;: &quot;unique&quot;,</span>
<span class="go">      &quot;type&quot;: &quot;flowlet&quot;,</span>
<span class="go">      &quot;virtualCores&quot;: 1</span>
<span class="go">    },</span>
<span class="go">    ...</span>
<span class="go">    {</span>
<span class="go">      &quot;container&quot;: &quot;container_1397069870124_0010_01_000005&quot;,</span>
<span class="go">      &quot;debugPort&quot;: 37205,</span>
<span class="go">      &quot;host&quot;: &quot;node-1003.my.cluster.net&quot;,</span>
<span class="go">      &quot;instance&quot;: 0,</span>
<span class="go">      &quot;memory&quot;: 512,</span>
<span class="go">      &quot;name&quot;: &quot;splitter&quot;,</span>
<span class="go">      &quot;type&quot;: &quot;flowlet&quot;,</span>
<span class="go">      &quot;virtualCores&quot;: 1</span>
<span class="go">    }</span>
<span class="go">  ],</span>
<span class="go">  &quot;id&quot;: &quot;WordCounter&quot;,</span>
<span class="go">  &quot;runtime&quot;: &quot;distributed&quot;,</span>
<span class="go">  &quot;type&quot;: &quot;Flow&quot;,</span>
<span class="go">  &quot;yarnAppId&quot;: &quot;application_1397069870124_0010&quot;</span>
<span class="go">}</span>
</pre></div>
</div>
<p>You see the YARN application id and the YARN container IDs of each Flowlet. More importantly, you
can see the host name and debugging port for each Flowlet. For example, the only instance of the
splitter Flowlet is running on <tt class="docutils literal"><span class="pre">node-1003.my.cluster.net</span></tt> and the debugging port is 37205. You can now
attach your debugger to the container’s JVM (see <a class="reference internal" href="#attaching-a-debugger">Attaching a Debugger</a>).</p>
<p>The corresponding HTTP requests for the <tt class="docutils literal"><span class="pre">RetrieveCounts</span></tt> Procedure of this application would be:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">POST &lt;base-url&gt;/apps/WordCount/procedures/RetrieveCounts/debug</span>
<span class="go">GET &lt;base-url&gt;/apps/WordCount/procedures/RetrieveCounts/live-info</span>
</pre></div>
</div>
<p>Analysis of the response would give you the host names and debugging ports for all instances of the Procedure.</p>
</div>
<div class="section" id="attaching-a-debugger">
<h3>Attaching a Debugger<a class="headerlink" href="#attaching-a-debugger" title="Permalink to this headline">¶</a></h3>
<div class="section" id="debugging-with-intellij">
<h4>Debugging with IntelliJ<a class="headerlink" href="#debugging-with-intellij" title="Permalink to this headline">¶</a></h4>
<p><em>Note:</em> These instructions were developed with <em>IntelliJ v13.1.2.</em>
You may need to adjust them for your installation or version.</p>
<ol class="arabic">
<li><p class="first">From the <em>IntelliJ</em> toolbar, select <tt class="docutils literal"><span class="pre">Run</span> <span class="pre">-&gt;</span> <span class="pre">Edit</span> <span class="pre">Configurations</span></tt>.</p>
</li>
<li><p class="first">Click <tt class="docutils literal"><span class="pre">+</span></tt> and choose <tt class="docutils literal"><span class="pre">Remote</span></tt>:</p>
<img alt="_images/intellij_1.png" src="_images/intellij_1.png" />
</li>
<li><p class="first">Create a debug configuration by entering a name, for example, <tt class="docutils literal"><span class="pre">CDAP</span></tt>.</p>
</li>
<li><p class="first">Enter the host name, for example, <tt class="docutils literal"><span class="pre">localhost</span></tt> or <tt class="docutils literal"><span class="pre">node-1003.my.cluster.net</span></tt>
in the Host field.</p>
</li>
<li><p class="first">Enter the debugging port, for example, <tt class="docutils literal"><span class="pre">5005</span></tt> in the Port field:</p>
<img alt="_images/intellij_2.png" src="_images/intellij_2.png" />
</li>
<li><p class="first">To start the debugger, select <tt class="docutils literal"><span class="pre">Run</span> <span class="pre">-&gt;</span> <span class="pre">Debug</span> <span class="pre">-&gt;</span> <span class="pre">CDAP</span></tt>.</p>
</li>
<li><p class="first">Set a breakpoint in any code block, for example, a Flowlet method:</p>
<img alt="_images/intellij_3.png" src="_images/intellij_3.png" />
</li>
<li><p class="first">Start the Flow in the Console.</p>
</li>
<li><p class="first">Send an event to the Stream. The control will stop at the breakpoint
and you can proceed with debugging.</p>
</li>
</ol>
</div>
<div class="section" id="debugging-with-eclipse">
<h4>Debugging with Eclipse<a class="headerlink" href="#debugging-with-eclipse" title="Permalink to this headline">¶</a></h4>
<p><em>Note:</em> These instructions were developed with <em>Eclipse IDE for Java Developers v4.4.0.</em>
You may need to adjust them for your installation or version.</p>
<ol class="arabic">
<li><p class="first">In Eclipse, select <tt class="docutils literal"><span class="pre">Run-&gt;</span> <span class="pre">Debug</span></tt> configurations.</p>
</li>
<li><p class="first">In the list on the left of the window, double-click <tt class="docutils literal"><span class="pre">Remote</span> <span class="pre">Java</span> <span class="pre">Application</span></tt> to create
a new launch configuration.</p>
<img alt="_images/eclipse_1.png" src="_images/eclipse_1.png" />
</li>
<li><p class="first">Enter a name and project, for example, <tt class="docutils literal"><span class="pre">CDAP</span></tt>.</p>
<img alt="_images/eclipse_2.png" src="_images/eclipse_2.png" />
</li>
<li><p class="first">Enter the host name, for example, <tt class="docutils literal"><span class="pre">localhost</span></tt> or <tt class="docutils literal"><span class="pre">node-1003.my.cluster.net</span></tt>
in the Port field:</p>
</li>
<li><p class="first">Enter the debugging port, for example, <tt class="docutils literal"><span class="pre">5005</span></tt> in the Port field:</p>
</li>
<li><p class="first">In your project, click <tt class="docutils literal"><span class="pre">Debug</span></tt> to start the debugger.</p>
</li>
<li><p class="first">Set a breakpoint in any code block, for example, a Flowlet method:</p>
<img alt="_images/eclipse_3.png" src="_images/eclipse_3.png" />
</li>
<li><p class="first">Start the Flow in the Console.</p>
</li>
<li><p class="first">Send an event to the Stream.</p>
</li>
<li><p class="first">The control stops at the breakpoint and you can proceed with debugging.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="debugging-the-transaction-manager-advanced-use">
<span id="txdebugger"></span><h3>Debugging the Transaction Manager (Advanced Use)<a class="headerlink" href="#debugging-the-transaction-manager-advanced-use" title="Permalink to this headline">¶</a></h3>
<p>In this advanced use section, we will explain in depth how transactions work internally.
Transactions are introduced in the <a class="reference internal" href="dev-guide.html#transaction-system"><em>Transaction System</em></a></p>
<p>A transaction is defined by an identifier, which contains the time stamp, in milliseconds,
of its creation. This identifier—also called the <cite>write pointer</cite>—represents the version
that this transaction will use for all of its writes. It is also used to determine
the order between transactions. A transaction with a smaller write pointer than
another transaction must have been started earlier.</p>
<p>The <cite>Transaction Manager</cite> (or TM) uses the write pointers to implement <cite>Optimistic Concurrency Control</cite>
by maintaining state for all transactions that could be facing concurrency issues.</p>
<div class="section" id="transaction-manager-states">
<h4>Transaction Manager States<a class="headerlink" href="#transaction-manager-states" title="Permalink to this headline">¶</a></h4>
<p>The <cite>state</cite> of the TM is defined by these structures and rules:</p>
<ul class="simple">
<li>The <cite>in-progress set</cite>, which contains all the write pointers of transactions
which have neither committed nor aborted.</li>
<li>The <cite>invalid set</cite>, which contains the write pointers of the transactions
considered invalid, and which will never be committed. A transaction
becomes invalid only if either it times out or, for a long-running transaction,
it is being aborted.</li>
<li>A transaction&#8217;s write pointer cannot be in the <cite>in-progress set</cite>
and in the <cite>invalid set</cite> at the same time.</li>
<li>The <cite>invalid set</cite> and the <cite>in-progress set</cite> together form the <cite>excluded set</cite>.
When a transaction starts, a copy of this set is given to the transaction so that
it excludes from its reads any writes performed by transactions in that set.</li>
<li>The <cite>committing change sets</cite>, which maps write pointers of the transactions
which have requested to commit their writes and which have passed a first round of
conflict check to a list of keys in which they have performed those writes.</li>
<li>The <cite>committed change sets</cite>, which has the same structure as the <cite>committing change sets</cite>,
but where the write pointers refer to transactions which are already committed and
which have passed a second round of conflict check.</li>
</ul>
</div>
<div class="section" id="transaction-lifecycle-states">
<h4>Transaction Lifecycle States<a class="headerlink" href="#transaction-lifecycle-states" title="Permalink to this headline">¶</a></h4>
<p>Here are the states a transaction goes through in its lifecycle:</p>
<ul class="simple">
<li>When a transaction starts, the TM creates a new write pointer
and saves it in the <cite>in-progress set</cite>.
A copy of the current excluded set is given to the transaction,
as well as a <cite>read pointer</cite>. The pointer
is an upper bound for the version of writes the transaction is allowed to read.
It prevents the transaction from reading committed writes performed after the transaction
started.</li>
<li>The transaction then performs writes to one or more rows, with the version of those writes
being the write pointer of the transaction.</li>
<li>When the transaction wants to commit its writes, it passes to the TM all the keys where
those writes took place. If the transaction is not in the <cite>excluded set</cite>, the
TM will use the <cite>committed change sets</cite> structure to detect
a conflict. A conflict happens in cases where the transaction tries to modify a
row which, after the start of the transaction, has been modified by one
of the transactions present in the structure.</li>
<li>If there are no conflicts, all the writes of the transaction along with its write pointer
are stored in the <cite>committing change sets</cite> structure.</li>
<li>The client—namely, a Dataset—can then ask the TM to commit the writes. These are retrieved from the
<cite>committing change sets</cite> structure. Since the <cite>committed change sets</cite> structure might
have evolved since the last conflict check, another one is performed. If the
transaction is in the <cite>excluded set</cite>, the commit will fail regardless
of conflicts.</li>
<li>If the second conflict check finds no overlapping transactions, the transaction&#8217;s
write pointer is removed from the <cite>in-progress set</cite>, and it is placed in
the <cite>committed change sets</cite> structure, along with the keys it has
written to. The writes of this transaction will now be seen by all new transactions.</li>
<li>If something went wrong in one or other of the committing steps, we distinguish
between normal and long-running transactions:<ul>
<li>For a normal transaction, the cause could be that the transaction
was found in the excluded set or that a conflict was detected.
The client ensures rolling back the writes the transaction has made,
and it then asks the TM to abort the transaction.
This will remove the transaction&#8217;s write pointer from either the
<cite>in-progress set</cite> or the <cite>excluded set</cite>, and optionally from the
<cite>committing change sets</cite> structure.</li>
<li>For a long-running transaction, the only possible cause is that a conflict
was detected. Since it is assumed that the writes will not be rolled back
by the client, the TM aborts the transaction by storing its
write pointer into the <cite>excluded set</cite>. It is the only way to
make other transactions exclude the writes performed by this transaction.</li>
</ul>
</li>
</ul>
<p>The <cite>committed change sets</cite> structure determines how fast conflict detections
are performed. Fortunately, not all the committed writes need to be
remembered; only those which may create a conflict with in-progress
transactions. This is why only the writes committed after the start of the oldest,
in-progress, not-long-running transaction are stored in this structure,
and why transactions which participate in conflict detection must remain
short in duration. The older they are, the bigger the <cite>committed change sets</cite>
structure will be and the longer conflict detection will take.</p>
<p>When conflict detection takes longer, so does committing a transaction
and the transaction stays longer in the <cite>in-progress set</cite>. The whole transaction
system can become slow if such a situation occurs.</p>
</div>
<div class="section" id="dumping-the-transaction-manager">
<h4>Dumping the Transaction Manager<a class="headerlink" href="#dumping-the-transaction-manager" title="Permalink to this headline">¶</a></h4>
<p>CDAP comes bundled with a script that allows you to dump the state of the internal
transaction manager into a local file to allow further investigation. If your CDAP Instance
tends to become slow, you can use this tool to detect the incriminating transactions.
This script is called <tt class="docutils literal"><span class="pre">tx-debugger</span></tt> (on Windows, it is <tt class="docutils literal"><span class="pre">tx-debugger.bat</span></tt>).</p>
<p>To download a snapshot of the state of the TM of the CDAP, use the command:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> tx-debugger view --host &lt;name&gt; <span class="o">[</span>--save &lt;filename&gt;<span class="o">]</span>
</pre></div>
</div>
<p>where <cite>name</cite> is the host name of your CDAP instance, and the optional <cite>filename</cite>
specifies where the snapshot should be saved. This command will
print statistics about all the structures that define the state of the TM.</p>
<p>You can also load a snapshot that has already been saved locally
with the command:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> tx-debugger view --filename &lt;filename&gt;
</pre></div>
</div>
<p>where <cite>filename</cite> specifies the location where the snapshot has been saved.</p>
<p>Here are options that you can use with the <tt class="docutils literal"><span class="pre">tx-debugger</span> <span class="pre">view</span></tt> commands:</p>
<ul class="simple">
<li>Use the <tt class="docutils literal"><span class="pre">--ids</span></tt> option to print all the transaction write pointers
that are stored in the different structures.</li>
<li>Use the <tt class="docutils literal"><span class="pre">--transaction</span> <span class="pre">&lt;writePtr&gt;</span></tt> option to specify the write pointer
of a transaction you would like information on. If the transaction is found
in the committing change sets or the committed change sets
structures, this will print the keys where the transaction has
performed writes.</li>
</ul>
<p>While transactions don&#8217;t inform you about the tasks that launched them—whether
it was a Flowlet, a MapReduce job, etc.—you can match the time
they were started with the activity of your CDAP to track potential
issues.</p>
<p>If you really know what you are doing and you spot a transaction in the
in-progress set that should be in the excluded set, you can
use this command to invalidate it:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> tx-debugger invalidate --host &lt;name&gt; --transaction &lt;writePtr&gt;
</pre></div>
</div>
<p>Invalidating a transaction when we know for sure that its writes should
be invalidated is useful, because those writes will then be removed
from the concerned Tables.</p>
</div>
</div>
</div>
<div class="section" id="ingesting-data">
<span id="ingest"></span><h2>Ingesting Data<a class="headerlink" href="#ingesting-data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>One of the first tasks of actually working with Big Data applications is getting the data in.
As data ingestion is a fundamental issue, and as one tool often does not fit all needs,
we have assembled a set of tools and applications to assist in ingesting data into CDAP:</p>
<ul class="simple">
<li>Java and Python APIs for controlling and writing to Streams;</li>
<li>a drop zone for bulk ingestion of files ;</li>
<li>a File Tailer daemon to tail local files; and</li>
<li>an Apache Flume Sink implementation for writing events received from a source.</li>
</ul>
</div>
<div class="section" id="cdap-stream-client-for-java">
<h3>CDAP Stream Client for Java<a class="headerlink" href="#cdap-stream-client-for-java" title="Permalink to this headline">¶</a></h3>
<p>The Stream Client Java API is for managing Streams from Java
applications.</p>
<div class="section" id="supported-actions">
<h4>Supported Actions<a class="headerlink" href="#supported-actions" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Create a Stream</li>
<li>Update TTL (time-to-live) for an existing Stream</li>
<li>Retrieve the current Stream TTL</li>
<li>Truncate an existing Stream (the deletion of all events that were
written to the Stream)</li>
<li>Write an event to an existing Stream</li>
</ul>
</div>
<div class="section" id="build">
<h4>Build<a class="headerlink" href="#build" title="Permalink to this headline">¶</a></h4>
<p>To build the Stream Client Java API jar, use:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">mvn clean package</span>
</pre></div>
</div>
</div>
<div class="section" id="usage">
<h4>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h4>
<p>To use the Stream Client Java API, include this Maven dependency in your
project&#8217;s <tt class="docutils literal"><span class="pre">pom.xml</span></tt> file:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">&lt;dependency&gt;</span>
<span class="go">  &lt;groupId&gt;co.cask.cdap&lt;/groupId&gt;</span>
<span class="go">  &lt;artifactId&gt;cdap-stream-client&lt;/artifactId&gt;</span>
<span class="go">  &lt;version&gt;1.0.1&lt;/version&gt;</span>
<span class="go">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<div class="section" id="create-streamclient">
<h5>Create StreamClient<a class="headerlink" href="#create-streamclient" title="Permalink to this headline">¶</a></h5>
<p>Create a StreamClient instance, specifying the fields &#8216;host&#8217; and &#8216;port&#8217;
of the CDAP instance.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">StreamClient streamClient = new RestStreamClient.Builder(&quot;localhost&quot;, 10000).build();</span>
</pre></div>
</div>
<p>Optional configurations that can be set (and their default values):</p>
<ul class="simple">
<li>ssl: false (set true to use HTTPS protocol)</li>
<li>verifySSLCert: true (set false to suspend certificate checks; this
allows self-signed certificates when SSL is true)</li>
<li>authClient: null (<a class="reference external" href="https://github.com/caskdata/cdap-clients/tree/develop/cdap-authentication-clients/java">CDAP Authentication
Client</a>
to interact with a secure CDAP instance)</li>
</ul>
<p>Example:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">StreamClient streamClient = new RestStreamClient.Builder(&quot;localhost&quot;, 10000)</span>
<span class="go">                                                .ssl(true)</span>
<span class="go">                                                .authClient(authenticationClient)</span>
<span class="go">                                                .build();</span>
</pre></div>
</div>
</div>
<div class="section" id="create-stream">
<h5>Create Stream<a class="headerlink" href="#create-stream" title="Permalink to this headline">¶</a></h5>
<p>Create a new Stream with the <em>stream id</em> &#8220;streamName&#8221;:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">streamClient.create(&quot;streamName&quot;);</span>
</pre></div>
</div>
<p><strong>Notes:</strong></p>
<ul class="simple">
<li>The <em>stream-id</em> should only contain ASCII letters, digits and
hyphens.</li>
<li>If the Stream already exists, no error is returned, and the existing
Stream remains in place.</li>
</ul>
</div>
<div class="section" id="create-streamwriter">
<h5>Create StreamWriter<a class="headerlink" href="#create-streamwriter" title="Permalink to this headline">¶</a></h5>
<p>Create a <tt class="docutils literal"><span class="pre">StreamWriter</span></tt> instance for writing events to the Stream
<em>streamName</em>:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">StreamWriter streamWriter = streamClient.createWriter(&quot;streamName&quot;);</span>
</pre></div>
</div>
</div>
<div class="section" id="write-stream-events">
<h5>Write Stream Events<a class="headerlink" href="#write-stream-events" title="Permalink to this headline">¶</a></h5>
<p>To write new events to the Stream, use the <tt class="docutils literal"><span class="pre">StreamWriter</span></tt> interface:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">ListenableFuture&lt;Void&gt; future = streamWriter.write(&quot;New log event&quot;, Charsets.UTF_8);</span>
</pre></div>
</div>
</div>
<div class="section" id="truncate-stream">
<h5>Truncate Stream<a class="headerlink" href="#truncate-stream" title="Permalink to this headline">¶</a></h5>
<p>To delete all events that were written to the Stream <em>streamName</em>, use:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">streamClient.truncate(&quot;streamName&quot;);</span>
</pre></div>
</div>
</div>
<div class="section" id="update-stream-time-to-live-ttl">
<h5>Update Stream Time-to-Live (TTL)<a class="headerlink" href="#update-stream-time-to-live-ttl" title="Permalink to this headline">¶</a></h5>
<p>Update TTL for the Stream <em>streamName</em>:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">streamClient.setTTL(&quot;streamName&quot;, newTTL);</span>
</pre></div>
</div>
</div>
<div class="section" id="get-stream-time-to-live-ttl">
<h5>Get Stream Time-to-Live (TTL)<a class="headerlink" href="#get-stream-time-to-live-ttl" title="Permalink to this headline">¶</a></h5>
<p>Get the current TTL value for the Stream <em>streamName</em>:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">long ttl = streamClient.getTTL(&quot;streamName&quot;);</span>
</pre></div>
</div>
</div>
<div class="section" id="close-clients">
<h5>Close Clients<a class="headerlink" href="#close-clients" title="Permalink to this headline">¶</a></h5>
<p>When you are finished, release all resources by calling these two
methods:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">streamWriter.close();</span>
<span class="go">streamClient.close();</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="cdap-stream-client-for-python">
<h3>CDAP Stream Client for Python<a class="headerlink" href="#cdap-stream-client-for-python" title="Permalink to this headline">¶</a></h3>
<p>The Stream Client Python API is for managing Streams from Python
applications.</p>
<div class="section" id="id1">
<h4>Supported Actions<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Create a Stream</li>
<li>Update TTL (time-to-live) for an existing Stream</li>
<li>Retrieve the current Stream TTL</li>
<li>Truncate an existing Stream (the deletion of all events that were
written to the Stream)</li>
<li>Write an event to an existing Stream</li>
</ul>
</div>
<div class="section" id="installation">
<h4>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h4>
<p>To install CDAP Stream Client, run</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> pip install cdap-stream-client
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h4>Usage<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>To use the Stream Client Python API, include these imports in your
Python script:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">from cdap_stream_client import Config</span>
<span class="go">from cdap_stream_client import StreamClient</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4>Example<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id4">
<h5>Create StreamClient<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<p>Create a StreamClient instance with default parameters.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">stream_client = StreamClient()</span>
</pre></div>
</div>
<p>Optional configurations that can be set (and their default values):</p>
<ul class="simple">
<li>host: &#8216;localhost&#8217;</li>
<li>port: 10000</li>
<li>ssl: False (set true to use HTTPS protocol)</li>
<li>ssl_cert_check: True (set False to suspend certificate checks; this
allows self-signed certificates when SSL is True)</li>
<li>authClient: null (<a class="reference external" href="https://github.com/caskdata/cdap-clients/tree/develop/cdap-authentication-clients/python">CDAP Authentication
Client</a>
to interact with a secure CDAP instance)</li>
</ul>
<p>Example:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">config = Config()</span>
<span class="go">config.host = &#39;localhost&#39;</span>
<span class="go">config.port = 10000</span>
<span class="go">config.ssl = True</span>
<span class="go">config.set_auth_client(authentication_client)</span>

<span class="go">stream_client = StreamClient(config)</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5>Create Stream<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<p>Create a new Stream with the <em>stream-id</em> &#8220;newStreamName&#8221;:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">stream_client.create(&quot;newStreamName&quot;)</span>
</pre></div>
</div>
<p><strong>Notes:</strong></p>
<ul class="simple">
<li>The <em>stream-id</em> should only contain ASCII letters, digits and
hyphens.</li>
<li>If the Stream already exists, no error is returned, and the existing
Stream remains in place.</li>
</ul>
</div>
<div class="section" id="id6">
<h5>Create StreamWriter<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h5>
<p>Create a <tt class="docutils literal"><span class="pre">StreamWriter</span></tt> instance for writing events to the Stream
&#8220;streamName&#8221;:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">stream_writer = stream_client.create_writer(&quot;streamName&quot;)</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h5>Write Stream Events<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h5>
<p>To write new events to the Stream, use the <tt class="docutils literal"><span class="pre">write</span></tt> method of the
<tt class="docutils literal"><span class="pre">StreamWriter</span></tt> class:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">def write(self, message, charset=None, headers=None)</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">stream_promise = stream_writer.write(&quot;New stream event&quot;)</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h5>Truncate Stream<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h5>
<p>To delete all events that were written to the Stream <em>streamName</em>, use:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">stream_client.truncate(&quot;streamName&quot;)</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h5>Update Stream Time-to-Live (TTL)<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h5>
<p>Update TTL for the Stream <em>streamName</em>:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">stream_client.set_ttl(&quot;streamName&quot;, newTTL)</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h5>Get Stream Time-to-Live (TTL)<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h5>
<p>Get the current TTL value for the Stream <em>streamName</em>:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">ttl = stream_client.get_ttl(&quot;streamName&quot;)</span>
</pre></div>
</div>
</div>
<div class="section" id="streampromise">
<h5>StreamPromise<a class="headerlink" href="#streampromise" title="Permalink to this headline">¶</a></h5>
<p>StreamPromise&#8217;s goal is to implement deferred code execution.</p>
<p>For error handling, create a handler for each case and set it using the
<tt class="docutils literal"><span class="pre">onResponse</span></tt> method. The error handling callback function is optional.</p>
<p>Example:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">def on_ok_response(response):</span>
<span class="go">    ...</span>
<span class="go">    parse response</span>
<span class="go">    ...</span>

<span class="go">def on_error_response(response):</span>
<span class="go">    ...</span>
<span class="go">    parse response</span>
<span class="go">    ...</span>

<span class="go">stream_promise = stream_writer.write(&quot;New stream event&quot;)</span>
<span class="go">stream_promise.on_response(on_ok_response, on_error_response)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="cdap-file-dropzone">
<h3>CDAP File DropZone<a class="headerlink" href="#cdap-file-dropzone" title="Permalink to this headline">¶</a></h3>
<p>File DropZone allows users to easily perform the bulk ingestion of local
files. Files can either be directly uploaded, or they can be copied to a
<em>work_dir</em>, where they will automatically be ingested by a daemon
process.</p>
<div class="section" id="features">
<h4>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Distributed as debian and rpm packages;</li>
<li>Loads properties from a configuration file;</li>
<li>Supports multiple observers/topics;</li>
<li>Able to survive restart and resumes sending from the first unsent
record of each of the existing files; and</li>
<li>Removes files that are completely sent.</li>
</ul>
</div>
<div class="section" id="id11">
<h4>Usage<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>To install File DropZone, execute one of these commands:</p>
<ul>
<li><p class="first">on Debian/Ubuntu systems:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">sudo apt-get install cdap-file-drop-zone-1.0.1.deb</span>
</pre></div>
</div>
</li>
<li><p class="first">on RHEL/CentOS systems:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">sudo rpm -ivh --force cdap-file-drop-zone-1.0.1.rpm</span>
</pre></div>
</div>
</li>
</ul>
<p>Repository information can be found at
<a class="reference external" href="http://docs.cask.co/cdap/current/en/admin.html#packaging">http://docs.cask.co/cdap/current/en/admin.html#packaging</a></p>
<p>Once installed, configure the daemon by editing the file:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">/etc/file-drop-zone/conf/file-drop-zone.properties</span>
</pre></div>
</div>
<p>These parameters must be specified:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">polling_interval</span>
<span class="go">observers</span>
<span class="go">work_dir</span>
<span class="go">observers.obs1.pipe</span>
<span class="go">pipes.pipe1.sink.stream_name</span>
<span class="go">pipes.pipe1.sink.host</span>
<span class="go">pipes.pipe1.sink.port</span>
</pre></div>
</div>
<p>To start the daemon, execute the command:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">sudo service file-drop-zone start</span>
</pre></div>
</div>
<p>To stop the daemon, execute the command:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">sudo service file-drop-zone stop</span>
</pre></div>
</div>
<p>File DropZone stores log files in the <tt class="docutils literal"><span class="pre">/var/log/file-drop-zone</span></tt>
directory. PID, states and statistics are stored in the
<tt class="docutils literal"><span class="pre">/var/run/file-drop-zone</span></tt> directory</p>
</div>
<div class="section" id="uploading-a-file-directly">
<h4>Uploading A File Directly<a class="headerlink" href="#uploading-a-file-directly" title="Permalink to this headline">¶</a></h4>
<p>To upload a file that is outside of the <em>work_dir</em>, execute the
command:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">file-drop-zone load &lt;file-path&gt; &lt;observer&gt;</span>
</pre></div>
</div>
<p>If only one observer is configured, the <em>observer</em> parameter is not
required:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">file-drop-zone load &lt;file-path&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="authentication-client">
<h4>Authentication Client<a class="headerlink" href="#authentication-client" title="Permalink to this headline">¶</a></h4>
<p>Once File DropZone is installed, configure the Authentication Client by
editing the properties file:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">/etc/file-drop-zone/conf/auth-client.properties</span>
</pre></div>
</div>
<p>Authentication Client configuration parameters:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.sink.auth_client</span></tt> - classpath of authentication
client class</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.sink.auth_client_properties</span></tt> - path to
authentication client properties file</li>
</ul>
<div class="section" id="authentication-client-example-configuration">
<h5>Authentication Client Example Configuration<a class="headerlink" href="#authentication-client-example-configuration" title="Permalink to this headline">¶</a></h5>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> User name
<span class="go">security.auth.client.username=admin</span>
<span class="gp">#</span> User password
<span class="go">security.auth.client.password=realtime</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="example-configuration">
<h4>Example Configuration<a class="headerlink" href="#example-configuration" title="Permalink to this headline">¶</a></h4>
<p>This configuration file will set the File DropZone application to
observe 2 directories using 2 pipes:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> Polling directories interval in milliseconds
<span class="go">polling_interval=5000</span>

<span class="gp">#</span> Comma-separated list of directories observers to be configured
<span class="go">observers=obs1</span>

<span class="gp">#</span>Path to work directory
<span class="go">work_dir=/var/file-drop-zone/</span>

<span class="gp">#</span> General observer configurations
<span class="gp">#</span> Pipe is used <span class="k">for </span>loading data from the file to the Stream
<span class="go">observers.obs1.pipe=pipe1</span>

<span class="gp">#</span> Pipe sink properties
<span class="gp">#</span> Name of the stream
<span class="go">pipes.pipe1.sink.stream_name=logEventStream</span>
<span class="gp">#</span> Host name that is used by stream client
<span class="go">pipes.pipe1.sink.host=localhost</span>
<span class="gp">#</span> Host port that is used by stream client
<span class="go">pipes.pipe1.sink.port=10000</span>
<span class="gp">#</span> Whether or not the sink endpoint uses SSL
<span class="go">pipes.pipe1.sink.ssl=true</span>
<span class="gp">#</span> Whether or not the certificate should be checked <span class="k">if </span>using SSL
<span class="go">pipes.pipe1.sink.verify.ssl.cert=true</span>
<span class="gp">#</span> Path to authentication client properties to use <span class="k">if </span>SSL is being used
<span class="go">pipes.pipe1.sink.auth_client_properties=/etc/file-drop-zone/conf/auth-client.properties</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="cdap-file-tailer">
<h3>CDAP File Tailer<a class="headerlink" href="#cdap-file-tailer" title="Permalink to this headline">¶</a></h3>
<p>File Tailer is a daemon process that performs tailing of sets of local
files. As soon as a new record has been appended to the end of a file
that the daemon is monitoring, it sends it to a Stream via the CDAP REST
API.</p>
<div class="section" id="id12">
<h4>Features<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>distributed as debian and rpm packages;</li>
<li>loads properties from a configuration file;</li>
<li>supports rotation of log files;</li>
<li>persists state and is able to resume from first unsent record; and</li>
<li>dumps statistics info.</li>
</ul>
</div>
<div class="section" id="id13">
<h4>Usage<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<p>To install File Tailer, execute one of these commands:</p>
<ul>
<li><p class="first">on Debian/Ubuntu systems:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">sudo apt-get install cdap-file-tailer-1.0.1.deb</span>
</pre></div>
</div>
</li>
<li><p class="first">on RHEL/CentOS systems:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">sudo rpm -ivh --force cdap-file-tailer-1.0.1.rpm</span>
</pre></div>
</div>
</li>
</ul>
<p>Repository information can be found at
<a class="reference external" href="http://docs.cask.co/cdap/current/en/admin.html#packaging">http://docs.cask.co/cdap/current/en/admin.html#packaging</a></p>
<p>Once installed, configure the daemon by editing the file:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">/etc/file-tailer/conf/file-tailer.properties</span>
</pre></div>
</div>
<p>These parameters must be specified:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">pipes=&lt;pipe1-name, pipe2-name, ... &gt;</span>
<span class="go">pipes.&lt;pipe1-name&gt;.source.work_dir=&lt;source-work-directory&gt;</span>
<span class="go">pipes.&lt;pipe1-name&gt;.source.file_name=&lt;source-file-name&gt;</span>
<span class="go">pipes.&lt;pipe1-name&gt;.sink.stream_name=&lt;stream-name&gt;</span>
<span class="go">pipes.&lt;pipe1-name&gt;.sink.host=&lt;host-name&gt;</span>
<span class="go">pipes.&lt;pipe1-name&gt;.sink.port=&lt;port-number&gt;</span>
<span class="go">...</span>
</pre></div>
</div>
<p>Please note that the target file must be accessible to the File Tailer
user. To check, you can use the <tt class="docutils literal"><span class="pre">more</span></tt> command with the File Tailer
user:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">sudo -u file-tailer more path_to_target_file</span>
</pre></div>
</div>
<p>To start the daemon, execute the command:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">sudo service file-tailer start</span>
</pre></div>
</div>
<p>To stop the daemon, execute the command:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">sudo service file-tailer stop</span>
</pre></div>
</div>
<p>File Tailer stores log files in the <tt class="docutils literal"><span class="pre">/var/log/file-tailer</span></tt> directory.
PID, states and statistics are stored in the <tt class="docutils literal"><span class="pre">/var/run/file-tailer</span></tt>
directory.</p>
</div>
<div class="section" id="id14">
<h4>Example Configuration<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<p>This configuration file will have the File Tailer application monitor
two different directories for target log files. Logs from each directory
will be sent to two separate streams.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> General pipe properties
<span class="gp">#</span> Comma-separated list of pipes to be configured
<span class="go">pipes=app1pipe,app2pipe</span>

<span class="gp">#</span> Pipe 1 <span class="nb">source </span>properties
<span class="gp">#</span> Working directory <span class="o">(</span>where to monitor files<span class="o">)</span>
<span class="go">pipes.app1pipe.source.work_dir=/var/log/app1</span>
<span class="gp">#</span> Name of log file
<span class="go">pipes.app1pipe.source.file_name=app1.log</span>

<span class="gp">#</span> Pipe 1 sink properties
<span class="gp">#</span> Name of the stream
<span class="go">pipes.app1pipe.sink.stream_name=app1Stream</span>
<span class="gp">#</span> Host name that is used by stream client
<span class="go">pipes.app1pipe.sink.host=cdap_host.example.com</span>
<span class="gp">#</span> Host port that is used by stream client
<span class="go">pipes.app1pipe.sink.port=10000</span>

<span class="gp">#</span> Pipe 2 <span class="nb">source </span>properties
<span class="gp">#</span> Working directory <span class="o">(</span>where to monitor files<span class="o">)</span>
<span class="go">pipes.app2pipe.source.work_dir=/var/log/app2</span>
<span class="gp">#</span> Name of log file
<span class="go">pipes.app2pipe.source.file_name=app2.log</span>

<span class="gp">#</span> Pipe 2 sink properties
<span class="gp">#</span> Name of the stream
<span class="go">pipes.app2pipe.sink.stream_name=app1Stream</span>
<span class="gp">#</span> Host name that is used by stream client
<span class="go">pipes.app2pipe.sink.host=cdap_host.example.com</span>
<span class="gp">#</span> Host port that is used by stream client
<span class="go">pipes.app2pipe.sink.port=10000</span>
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h4>Authentication Client<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<p>Once File Tailer is installed, configure the Authentication Client by
editing the properties file:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">/etc/file-tailer/conf/auth-client.properties</span>
</pre></div>
</div>
<p>Authentication Client configuration parameters:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.sink.auth_client</span></tt> - classpath of authentication
client class</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.sink.auth_client_properties</span></tt> - path to
authentication client properties file</li>
</ul>
<div class="section" id="id16">
<h5>Authentication Client Example Configuration<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h5>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> User name
<span class="go">security.auth.client.username=admin</span>
<span class="gp">#</span> User password
<span class="go">security.auth.client.password=realtime</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="additional-notes">
<h4>Additional Notes<a class="headerlink" href="#additional-notes" title="Permalink to this headline">¶</a></h4>
<p>Description of configuration parameters:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">daemon_dir</span></tt> : the path to directory for storage of File Tailer
state and metrics</li>
<li><tt class="docutils literal"><span class="pre">pipes</span></tt> : list of all pipes, comma-separated</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.name</span></tt> : name of the pipe</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.state_file</span></tt> : name of file, used to save state</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.statistics_file</span></tt> : name of file, used to save
statistics</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.queue_size</span></tt> : size of queue (default 1000), of
stored log records, before sending them to Stream</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.source.work_dir</span></tt> : path to directory being
monitored for target log files</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.source.file_name</span></tt> : name of target log file</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.source.rotated_file_name_pattern</span></tt> : log file
rollover pattern (default &#8220;(.*)&#8221; )</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.source.charset_name</span></tt> : name of charset used by
Stream Client for sending logs (default &#8220;UTF-8&#8221;)</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.source.record_separator</span></tt> : symbol that separates
each log record (default &#8220;&#8221;)</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.source.sleep_interval</span></tt> : interval to sleep after
reading all log data (default 3000 ms)</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.source.failure_retry_limit</span></tt> : number of attempts
to retry reading a log, if an error occurred while reading file data
(default value is 0 for unlimited attempts)</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.source.failure_sleep_interval</span></tt> : interval to
sleep if an error occurred while reading the file data (default 60000
ms)</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.sink.stream_name</span></tt> : name of target stream</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.sink.host</span></tt> : server host</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.sink.port</span></tt> : server port</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.sink.ssl</span></tt> : Secure Socket Layer mode
[true|false] (default false)</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.sink.apiKey</span></tt> : SSL security key</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.sink.writerPoolSize</span></tt> : number of threads with
which Stream Client sends events (default 10)</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.sink.version</span></tt> : CDAP server version (default
&#8220;v2&#8221;)</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.sink.packSize</span></tt> : number of logs sent at a time
(default 1)</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.sink.failure_retry_limit</span></tt> : number of attempts
to retry sending logs, if an error occurred while reading file data
(default value is 0 for unlimited attempts)</li>
<li><tt class="docutils literal"><span class="pre">pipes.&lt;pipe-name&gt;.sink.failure_sleep_interval</span></tt> : interval to sleep
if an error occurred while sending the logs (default 60000 ms)</li>
</ul>
</div>
</div>
<div class="section" id="cdap-flume">
<h3>CDAP Flume<a class="headerlink" href="#cdap-flume" title="Permalink to this headline">¶</a></h3>
<p>The CDAP Sink is a Flume Sink implementation using REST Stream interface
to write events received from a source.</p>
<div class="section" id="id17">
<h4>Usage<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<p>To use, put the CDAP Sink jar file in the Flume classpath (for example,
in the Flume lib directory). The JAR can be obtained from <a class="reference external" href="http://search.maven.org/#search|ga|1|cdap-flume">Maven
Central</a>.</p>
<p>Specify the fully-qualified name of your CDAP Sink class in the Flume
configuration properties:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">a1.sinks.sink1.type = co.cask.cdap.flume.StreamSink</span>
</pre></div>
</div>
<p>Enter the host name that is used by the stream client:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">a1.sinks.sink1.host = &lt;hostname or host ip&gt;</span>
</pre></div>
</div>
<p>Target Stream name:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">a1.sinks.sink1.streamName = &lt;Stream name&gt;</span>
</pre></div>
</div>
<p>Optional parameters that can be specified are listed below with their
default values.</p>
<p>Enter the host port that is used by the Stream Client:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">a1.sinks.sink1.port = 10000</span>
</pre></div>
</div>
<p>Secure Socket Layer mode [true | false]</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">a1.sinks.sink1.sslEnabled = false</span>
</pre></div>
</div>
<p>Verify SSL Certificate [true | false]</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">a1.sinks.sink1.verifySSLCert = true</span>
<span class="gp">#</span> <span class="nb">set </span>it to <span class="nb">false </span>to <span class="nb">suspend </span>certificate checks; this allows self-signed certificates when SSL is <span class="nb">true</span>
</pre></div>
</div>
<p>Number of threads to which Stream Client can send events:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">a1.sinks.sink1.writerPoolSize = 10</span>
</pre></div>
</div>
<p>CDAP Router server version:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">a1.sinks.sink1.version = v2</span>
</pre></div>
</div>
</div>
<div class="section" id="id18">
<h4>Authentication Client<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h4>
<p>To use authentication, add these authentication client configuration
parameters to the sink configuration file:</p>
<p>Fully qualified class name of the client class:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">a1.sinks.sink1.authClientClass = co.cask.cdap.security.authentication.client.basic.BasicAuthenticationClient</span>
</pre></div>
</div>
<p>Path to authentication client properties file:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">a1.sinks.sink1.authClientProperties = /usr/local/apache-flume/conf/auth_client.conf</span>
</pre></div>
</div>
<div class="section" id="id19">
<h5>Authentication Client Example Configuration<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h5>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">#</span> User name
<span class="go">security.auth.client.username=admin</span>
<span class="gp">#</span> User password
<span class="go">security.auth.client.password=secret</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id20">
<h4>Example<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<p>Configuration of a Flume agent that reads data from a log file and puts
it to CDAP using CDAP Sink.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">a1.sources = r1</span>
<span class="go">a1.channels = c1</span>
<span class="go">a1.sources.r1.type = exec</span>
<span class="go">a1.sources.r1.command = tail -F /tmp/log</span>
<span class="go">a1.sources.r1.channels = c1</span>
<span class="go">a1.sinks = k1</span>
<span class="go">a1.sinks.k1.type = co.cask.cdap.flume.StreamSink</span>
<span class="go">a1.sinks.k1.channel = c1</span>
<span class="go">a1.sinks.k1.host  = 127.0.0.1</span>
<span class="go">a1.sinks.k1.port = 10000</span>
<span class="go">a1.sinks.k1.streamName = logEventStream</span>
<span class="go">a1.channels.c1.type = memory</span>
<span class="go">a1.channels.c1.capacity = 1000</span>
<span class="go">a1.channels.c1.transactionCapacity = 100</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="authentication-clients">
<span id="id21"></span><h2>Authentication Clients<a class="headerlink" href="#authentication-clients" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id22">
<h3>Introduction<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<p>The Authentication Client Tools fetch access tokens from the authentication service. Two APIs
are currently available: <a class="reference external" href="#cdap-authentication-client-for-java">Java</a> and
<a class="reference external" href="#cdap-authentication-client-for-python">Python.</a></p>
</div>
<div class="section" id="cdap-authentication-client-for-java">
<h3>CDAP Authentication Client for Java<a class="headerlink" href="#cdap-authentication-client-for-java" title="Permalink to this headline">¶</a></h3>
<p>The Authentication Client API can be used for fetching the access token
from the CDAP authentication server to interact with a secure CDAP
cluster.</p>
<div class="section" id="id23">
<h4>Supported Actions<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Check that authentication is enabled in the CDAP cluster.</li>
<li>Fetch an access token from the authentication server with credentials
supported by the active authentication mechanism.</li>
</ul>
<p>The default implementation of the authentication
client—<tt class="docutils literal"><span class="pre">BasicAuthenticationClient</span></tt>—supports the default
authentication mechanisms supported by CDAP:</p>
<ul class="simple">
<li>Basic Authentication</li>
<li>LDAP</li>
<li>JAASPI</li>
</ul>
</div>
<div class="section" id="custom-authentication-mechanism">
<h4>Custom Authentication Mechanism<a class="headerlink" href="#custom-authentication-mechanism" title="Permalink to this headline">¶</a></h4>
<p>If CDAP is configured to use a custom authentication mechanism, a custom
authentication client will have to be written to fetch the access token.
The custom authentication clients needs to implement the
<tt class="docutils literal"><span class="pre">AuthenticationClient</span></tt> interface. The <tt class="docutils literal"><span class="pre">AbstractAuthenticationClient</span></tt>
class contains common functionality required by authentication clients,
and can be extended by the custom authentication client. The custom
authentication client has to be placed into the classpath of the
application that needs to use it.</p>
</div>
<div class="section" id="id24">
<h4>Build<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h4>
<p>To build the Authentication Client API jar, use:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">mvn clean package</span>
</pre></div>
</div>
</div>
<div class="section" id="id25">
<h4>Usage<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h4>
<p>To use the Authentication Client API, include this Maven dependency in
your project&#8217;s <tt class="docutils literal"><span class="pre">pom.xml</span></tt> file:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">&lt;dependency&gt;</span>
<span class="go">  &lt;groupId&gt;co.cask.cdap&lt;/groupId&gt;</span>
<span class="go">  &lt;artifactId&gt;cdap-authentication-client&lt;/artifactId&gt;</span>
<span class="go">  &lt;version&gt;1.0.1&lt;/version&gt;</span>
<span class="go">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id26">
<h4>Example<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h4>
<div class="section" id="create-an-authentication-client-instance">
<h5>Create an Authentication Client instance<a class="headerlink" href="#create-an-authentication-client-instance" title="Permalink to this headline">¶</a></h5>
<div class="highlight-console"><div class="highlight"><pre><span class="go">String defaultAuthClientClass =</span>
<span class="go">  &quot;co.cask.cdap.security.authentication.client.basic.BasicAuthenticationClient&quot;;</span>
<span class="go">String authClientClassName =</span>
<span class="go">   properties.getProperty(&quot;security.auth.client.class.name&quot;, defaultAuthClientClass);</span>
<span class="go">AuthenticationClient authenticationClient =</span>
<span class="go">   (AuthenticationClient) Class.forName(authClientClassName).newInstance();</span>
</pre></div>
</div>
<p>Creating an Authentication Client using a configuration parameter as
shown above allows plugging in custom implementations of Authentication
Client.</p>
</div>
<div class="section" id="set-the-cdap-connection-information">
<h5>Set the CDAP connection information<a class="headerlink" href="#set-the-cdap-connection-information" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>hostname</li>
<li>port</li>
<li>boolean flag, true if SSL is enabled</li>
</ul>
<p>Example:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">authenticationClient.setConnectionInfo(&quot;localhost&quot;, 10000, false);</span>
</pre></div>
</div>
<p>This method should be called only once for every
<tt class="docutils literal"><span class="pre">AuthenticationClient</span></tt> object.</p>
</div>
<div class="section" id="check-if-authentication-is-enabled-in-the-cdap-cluster">
<h5>Check if authentication is enabled in the CDAP cluster<a class="headerlink" href="#check-if-authentication-is-enabled-in-the-cdap-cluster" title="Permalink to this headline">¶</a></h5>
<div class="highlight-console"><div class="highlight"><pre><span class="go">boolean isEnabled = authenticationClient.isAuthEnabled();</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-authentication-client">
<h5>Configure Authentication Client<a class="headerlink" href="#configure-authentication-client" title="Permalink to this headline">¶</a></h5>
<p>If authentication is enabled, configure the Authentication Client with
user credentials and other properties (this method should be called only
once for every <tt class="docutils literal"><span class="pre">AuthenticationClient</span></tt> object).</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">authenticationClient.configure(properties);</span>
</pre></div>
</div>
<p><strong>Note:</strong></p>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">BasicAuthenticationClient</span></tt> requires these user credentials:<ul>
<li><tt class="docutils literal"><span class="pre">security.auth.client.username=username</span></tt></li>
<li><tt class="docutils literal"><span class="pre">security.auth.client.password=password</span></tt></li>
</ul>
</li>
<li>When SSL is enabled, to suspend certificate checks and allow
self-signed certificates, set
<tt class="docutils literal"><span class="pre">security.auth.client.verify.ssl.cert=false</span></tt>.</li>
<li>For non-interactive applications, user credentials will come from a
configuration file.</li>
<li>For interactive applications, see the section <a class="reference external" href="#interactive-applications">Interactive
Applications</a> below on retrieving and
using user credentials.</li>
</ul>
</div>
<div class="section" id="retrieve-the-access-token-for-the-user-from-the-authentication-server-and-use-it">
<h5>Retrieve the access token for the user from the authentication server, and use it<a class="headerlink" href="#retrieve-the-access-token-for-the-user-from-the-authentication-server-and-use-it" title="Permalink to this headline">¶</a></h5>
<div class="highlight-console"><div class="highlight"><pre><span class="go">HttpURLConnection conn = (HttpURLConnection) cdapURL.openConnection();</span>
<span class="go">conn.setRequestProperty(&quot;Authorization&quot;,</span>
<span class="go">           authenticationClient.getAccessToken().getTokenType() + &quot; &quot; +</span>
<span class="go">           authenticationClient.getAccessToken().getValue());</span>
<span class="go">// ...</span>
<span class="go">conn.connect();</span>
</pre></div>
</div>
<p>If there is an error while fetching the access token, an <tt class="docutils literal"><span class="pre">IOException</span></tt>
will be thrown. The Authentication Client caches the access token until
the token expires. It automatically re-fetches a new token upon expiry.</p>
</div>
</div>
<div class="section" id="interactive-applications">
<h4>Interactive Applications<a class="headerlink" href="#interactive-applications" title="Permalink to this headline">¶</a></h4>
<p>This example illustrates obtaining user credentials in an interactive
application, and then configuring the Authentication Client with the
retrieved credentials.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">authenticationClient.setConnectionInfo(hostname, port, ssl);</span>
<span class="go">Properties properties = new Properties();</span>

<span class="go">if (authenticationClient.isAuthEnabled()) {</span>
<span class="go">  ConsoleReader reader = new ConsoleReader();</span>
<span class="go">  for (Credential credential : authenticationClient.getRequiredCredentials()) {</span>
<span class="go">    String credentialValue;</span>
<span class="go">    output.printf(&quot;Please, specify &quot;  credential.getDescription()  &quot;&gt; &quot;);</span>
<span class="go">    if (credential.isSecret()) {</span>
<span class="go">        credentialValue = reader.readLine(prompt, &#39;*&#39;);</span>
<span class="go">    } else {</span>
<span class="go">      credentialValue = reader.readLine(prompt);</span>
<span class="go">    }</span>
<span class="go">    properties.put(credential.getName(), credentialValue);</span>
<span class="go">  }</span>

<span class="go">  authenticationClient.configure(properties);</span>
<span class="go">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="cdap-authentication-client-for-python">
<h3>CDAP Authentication Client for Python<a class="headerlink" href="#cdap-authentication-client-for-python" title="Permalink to this headline">¶</a></h3>
<p>The Authentication Client Python API can be used for fetching the access
token from the CDAP authentication server to interact with a secure CDAP
cluster.</p>
<div class="section" id="id27">
<h4>Supported Actions<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Check that authentication is enabled in the CDAP cluster.</li>
<li>Fetch an access token from the authentication server with credentials
supported by the active authentication mechanism.</li>
</ul>
<p>The default implementation of the authentication
client—<tt class="docutils literal"><span class="pre">BasicAuthenticationClient</span></tt>—supports the default
authentication mechanisms supported by CDAP:</p>
<ul class="simple">
<li>Basic Authentication</li>
<li>LDAP</li>
<li>JAASPI</li>
</ul>
</div>
<div class="section" id="id28">
<h4>Custom Authentication Mechanism<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h4>
<p>If CDAP is configured to use a custom authentication mechanism, a custom
authentication client is needed to fetch the access token. Custom
authentication clients must implement the <tt class="docutils literal"><span class="pre">AuthenticationClient</span></tt>
interface. The <tt class="docutils literal"><span class="pre">AbstractAuthenticationClient</span></tt> class contains common
functionality required by authentication clients, and can be extended by
the custom authentication client.</p>
</div>
<div class="section" id="id29">
<h4>Installation<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h4>
<p>To install the CDAP Authentication Client, run</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> pip install cdap-auth-client
</pre></div>
</div>
</div>
<div class="section" id="id30">
<h4>Usage<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h4>
<p>To use the Authentication Client Python API, include this import in your
Python script:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">from cdap_auth_client import BasicAuthenticationClient</span>
</pre></div>
</div>
</div>
<div class="section" id="id31">
<h4>Example<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h4>
<div class="section" id="create-a-basicauthenticationclient-instance">
<h5>Create a BasicAuthenticationClient instance<a class="headerlink" href="#create-a-basicauthenticationclient-instance" title="Permalink to this headline">¶</a></h5>
<div class="highlight-console"><div class="highlight"><pre><span class="go">authentication_client = BasicAuthenticationClient()</span>
</pre></div>
</div>
</div>
<div class="section" id="id32">
<h5>Set the CDAP connection information<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>hostname</li>
<li>port</li>
<li>boolean flag, <tt class="docutils literal"><span class="pre">True</span></tt> if SSL is enabled</li>
</ul>
<p>Example:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">authentication_client.set_connection_info(&#39;localhost&#39;, 10000, False)</span>
</pre></div>
</div>
<p>This method should be called only once for every
<tt class="docutils literal"><span class="pre">AuthenticationClient</span></tt> object.</p>
</div>
<div class="section" id="id33">
<h5>Check if authentication is enabled in the CDAP cluster<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h5>
<div class="highlight-console"><div class="highlight"><pre><span class="go">is_enabled = authentication_client.is_auth_enabled()</span>
</pre></div>
</div>
</div>
<div class="section" id="id34">
<h5>Configure Authentication Client<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h5>
<p>Set the required fields on a
<a class="reference external" href="https://docs.python.org/2/tutorial/datastructures.html#dictionaries">dictionary</a>:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">properties = {</span>
<span class="go">  &#39;security_auth_client_username&#39;: &#39;admin&#39;,</span>
<span class="go">  &#39;security_auth_client_password&#39;: &#39;secret&#39;,</span>
<span class="go">  &#39;security_ssl_cert_check&#39;: True</span>
<span class="go">}</span>
</pre></div>
</div>
<p>If authentication is enabled, configure the Authentication Client with
user credentials and other properties (this method should be called only
once for every <tt class="docutils literal"><span class="pre">AuthenticationClient</span></tt> object).</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">authentication_client.configure(properties)</span>
</pre></div>
</div>
<p><strong>Note:</strong></p>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">BasicAuthenticationClient</span></tt> requires these user credentials:<ul>
<li><tt class="docutils literal"><span class="pre">security_auth_client_username=username</span></tt></li>
<li><tt class="docutils literal"><span class="pre">security_auth_client_password=password</span></tt></li>
</ul>
</li>
<li>When SSL is enabled, to suspend certificate checks and allow
self-signed certificates, set
<tt class="docutils literal"><span class="pre">security.security_ssl_cert_check=false</span></tt>.</li>
<li>For non-interactive applications, user credentials will come from a
configuration file.</li>
<li>For interactive applications, see the section <a class="reference external" href="#interactive-applications">Interactive
Applications</a> below on retrieving and
using user credentials.</li>
</ul>
</div>
<div class="section" id="retrieve-and-use-the-access-token-for-the-user-from-the-authentication-server">
<h5>Retrieve and use the access token for the user from the authentication server<a class="headerlink" href="#retrieve-and-use-the-access-token-for-the-user-from-the-authentication-server" title="Permalink to this headline">¶</a></h5>
<div class="highlight-console"><div class="highlight"><pre><span class="go">token = authentication_client.get_access_token()</span>

<span class="go">headers = { &#39;Authorization&#39;: token.token_type + &#39; &#39; + token.value }</span>
<span class="go">requests.request(method, url, headers=headers)</span>
</pre></div>
</div>
<p>If there is an error while fetching the access token, an <tt class="docutils literal"><span class="pre">IOError</span></tt>
will be raised.</p>
</div>
</div>
<div class="section" id="id35">
<h4>Interactive Applications<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h4>
<p>This example illustrates obtaining user credentials in an interactive
application, and then configuring the Authentication Client with the
retrieved credentials.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">authentication_client.set_connection_info(&#39;localhost&#39;, 10000, False)</span>
<span class="go">properties = {}</span>

<span class="go">if authentication_client.is_auth_enabled():</span>
<span class="go">  for credential in authentication_client.get_required_credentials():</span>
<span class="go">     print(&#39;Please specify %s &gt; &#39; % credential.get_description())</span>
<span class="go">     if credential.is_secret():</span>
<span class="go">        credential_value = getpass.getpass()</span>
<span class="go">     else:</span>
<span class="go">        credential_value = raw_input()</span>
<span class="go">     properties[credential.get_name()] = credential_value</span>
<span class="go">  authentication_client.configure(properties)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><!--
  Copyright © 2014 Cask Data, Inc.

  Licensed under the Apache License, Version 2.0 (the "License"); you may not
  use this file except in compliance with the License. You may obtain a copy of
  the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
  License for the specific language governing permissions and limitations under
  the License.
-->

<h3><a href="index.html">Table of Contents</a></h3>
<nav>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="getstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="case_study.html">Case Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="arch.html">Concepts and Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="apps-packs.html">Apps and Packs</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">APIs and Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="javadocs/index.html">Javadocs</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tools-overview">Tools Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing-cdap">Testing CDAP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#strategies-in-testing-applications">Strategies in Testing Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#strategies-in-testing-flows">Strategies in Testing Flows</a></li>
<li class="toctree-l3"><a class="reference internal" href="#strategies-in-testing-mapreduce-jobs">Strategies in Testing MapReduce Jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#strategies-in-testing-spark-programs">Strategies in Testing Spark Programs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#validating-test-data-with-sql">Validating Test Data with SQL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#debugging-cdap">Debugging CDAP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#debugging-an-application-in-standalone-cdap">Debugging an Application in Standalone CDAP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-an-application-in-distributed-cdap">Debugging an Application in Distributed CDAP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#attaching-a-debugger">Attaching a Debugger</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-the-transaction-manager-advanced-use">Debugging the Transaction Manager (Advanced Use)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ingesting-data">Ingesting Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cdap-stream-client-for-java">CDAP Stream Client for Java</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cdap-stream-client-for-python">CDAP Stream Client for Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cdap-file-dropzone">CDAP File DropZone</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cdap-file-tailer">CDAP File Tailer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cdap-flume">CDAP Flume</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#authentication-clients">Authentication Clients</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id22">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cdap-authentication-client-for-java">CDAP Authentication Client for Java</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cdap-authentication-client-for-python">CDAP Authentication Client for Python</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="admin.html">Administration and Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="licenses/index.html">Licenses and Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="releasenotes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq/index.html">FAQ</a></li>
</ul>

</nav>
  <h4>Previous Topic</h4>
  <p class="topless"><a href="javadocs/index.html"
                        title="Previous Chapter">Javadocs</a></p>
  <h4>Next Topic</h4>
  <p class="topless"><a href="admin.html"
                        title="Next Chapter">Cask Data Application Platform Administration and Operations Guide</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick Search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014 Cask Data, Inc.
    </div>
  </body>
</html>