<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="robots" content="noindex, nofollow">

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Cask Data, Inc." name="author" />
<meta content="Copyright © 2015 Cask Data, Inc." name="copyright" />
<script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-55081520-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    
    <meta name="git_release" content="3.2.1">
    <meta name="git_hash" content="c29c9673c53a5d392164c3a10dd414e28befd81e">
    <meta name="git_timestamp" content="2015-11-30 17:55:49 -0800">
    <title>Hadoop: Upgrading an Existing CDAP Installation &mdash; Cask Data Application Platform 3.2.1 Documentation</title>
    
    <link rel="stylesheet" href="../../_static/cdap.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    



    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.2.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <!-- Amazon SQS Page Usage Logging start-->
    <script type="text/javascript" src="https://sdk.amazonaws.com/js/aws-sdk-2.1.35.min.js"></script>
    <script type="text/javascript" src="http://docs.cask.co/resources/scripts/aws-sqs-1.0.0.js"></script>
    <!-- Amazon SQS Page Usage Logging end-->
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Cask Data Application Platform 3.2.1 Documentation" href="../../index.html" />
    <link rel="up" title="Hadoop" href="index.html" />
    <link rel="next" title="MapR" href="../mapr/index.html" />
    <link rel="prev" title="Hadoop: From Starting Services to Verification" href="starting-verification.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="../mapr/index.html" title="MapR"
             accesskey="N">Next</a> |</li>
        <li class="right" >
          <a href="starting-verification.html" title="Hadoop: From Starting Services to Verification"
             accesskey="P">Previous</a> |</li>
        
        <script type="text/javascript" src="../../_static/version-menu.js"></script>
        <script src="http://docs.cask.co/cdap/json-versions.js"/></script>
        <script>window.setVersion('3.2.1');</script>
       
        <li><a href="../../table-of-contents.html">CDAP Administration Manual</a> &raquo;</li>
          <li><a href="../index.html" >Installation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Hadoop</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="hadoop-distribution-upgrading-an-existing-cdap-installation">
<span id="hadoop-upgrading"></span><h1>Hadoop: Upgrading an Existing CDAP Installation<a class="headerlink" href="#hadoop-distribution-upgrading-an-existing-cdap-installation" title="Permalink to this headline">¶</a></h1>
<p>When upgrading an existing CDAP installation from a previous version, you will need
to make sure the CDAP table definitions in HBase are up-to-date.</p>
<p>These steps will stop CDAP, update the installation, run an upgrade tool for the table definitions,
and then restart CDAP.</p>
<p>These steps will upgrade from CDAP 3.1.x to 3.2.x. If you are on an earlier version of CDAP,
please follow the upgrade instructions for the earlier versions and upgrade first to 3.1.x before proceeding.</p>
<ol class="arabic">
<li><p class="first">Stop all flows, services, and other programs in all your applications.</p>
</li>
<li><p class="first">Stop all CDAP processes:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> <span class="k">for</span> i in <span class="sb">`</span>ls /etc/init.d/ <span class="p">|</span> grep cdap<span class="sb">`</span> <span class="p">;</span> <span class="k">do</span> sudo service <span class="nv">$i</span> stop <span class="p">;</span> <span class="k">done</span>
</pre></div>
</div>
</li>
<li><p class="first">Update the CDAP file definition lists by running either of these methods:</p>
<ul>
<li><p class="first">Using Yum:</p>
<div class="highlight container">
<pre class="literal-block">
<span class="gp">$</span> sudo curl -o /etc/yum.repos.d/cask.repo http://repository.cask.co/centos/6/x86_64/cdap/3.2/cask.repo
</pre>
</div>
<p>This will create the file <code class="docutils literal"><span class="pre">/etc/yum.repos.d/cask.repo</span></code> with:</p>
<pre class="literal-block">
[cask]
name=Cask Packages
baseurl=http://repository.cask.co/centos/6/x86_64/cdap/3.2
enabled=1
gpgcheck=1
</pre>
<p>Add the Cask Public GPG Key to your repository:</p>
<div class="highlight container">
<pre class="literal-block">
<span class="gp">$</span> sudo rpm --import http://repository.cask.co/centos/6/x86_64/cdap/3.2/pubkey.gpg
</pre>
</div>
<p>Update your Yum cache:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> sudo yum makecache
</pre></div>
</div>
</li>
<li><p class="first">Using APT:</p>
<div class="highlight container">
<pre class="literal-block">
<span class="gp">$</span> sudo curl -o /etc/apt/sources.list.d/cask.list http://repository.cask.co/ubuntu/precise/amd64/cdap/3.2/cask.list
</pre>
</div>
<p>This will create the file <code class="docutils literal"><span class="pre">/etc/apt/sources.list.d/cask.list</span></code> with:</p>
<pre class="literal-block">
deb [ arch=amd64 ] http://repository.cask.co/ubuntu/precise/amd64/cdap/3.2 precise cdap
</pre>
<p>Add the Cask Public GPG Key to your repository:</p>
<div class="highlight container">
<pre class="literal-block">
<span class="gp">$</span> curl -s http://repository.cask.co/ubuntu/precise/amd64/cdap/3.2/pubkey.gpg | sudo apt-key add -
</pre>
</div>
<p>Update your APT-cache:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> sudo apt-get update
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Update the CDAP packages by running either of these methods:</p>
<ul>
<li><p class="first">Using Yum (on one line):</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> sudo yum install cdap cdap-gateway <span class="se">\</span>
<span class="go">      cdap-hbase-compat-0.96 cdap-hbase-compat-0.98 cdap-hbase-compat-1.0 \</span>
<span class="go">      cdap-hbase-compat-1.0-cdh cdap-hbase-compat-1.1 \</span>
<span class="go">      cdap-kafka cdap-master cdap-security cdap-ui</span>
</pre></div>
</div>
</li>
<li><p class="first">Using APT (on one line):</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> sudo apt-get install cdap cdap-gateway <span class="se">\</span>
<span class="go">      cdap-hbase-compat-0.96 cdap-hbase-compat-0.98 cdap-hbase-compat-1.0 \</span>
<span class="go">      cdap-hbase-compat-1.0-cdh cdap-hbase-compat-1.1 \</span>
<span class="go">      cdap-kafka cdap-master cdap-security cdap-ui</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">If you are upgrading a secure Hadoop cluster, you should authenticate with <code class="docutils literal"><span class="pre">kinit</span></code>
as the user that runs CDAP Master (the CDAP user)
before the next step (the running of the upgrade tool):</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> kinit -kt &lt;keytab&gt; &lt;principal&gt;
</pre></div>
</div>
</li>
<li><p class="first">Run the upgrade tool, as the user that runs CDAP Master (the CDAP user):</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> /opt/cdap/master/bin/svc-master run co.cask.cdap.data.tools.UpgradeTool upgrade
</pre></div>
</div>
<p>Note that once you have upgraded an instance of CDAP, you cannot reverse the process; down-grades
to a previous version are not possible.</p>
<p>The Upgrade Tool will produce output similar to the following, prompting you to continue with the upgrade:</p>
<blockquote>
<div><div class="highlight container">
<pre class="literal-block">
UpgradeTool - version 3.2-xxxxx.

upgrade - Upgrades CDAP to 3.2
  The upgrade tool upgrades the following:
  1. User Datasets
      - Upgrades the coprocessor jars for tables
      - Migrates the metadata for PartitionedFileSets
  2. System Datasets
  3. UsageRegistry Dataset Type
  Note: Once you run the upgrade tool you cannot rollback to the previous version.
Do you want to continue (y/n)
y
Starting upgrade ...
</pre>
</div>
</div></blockquote>
<p>You can run the tool in a non-interactive fashion by using the <code class="docutils literal"><span class="pre">force</span></code> flag, in which case
it will run unattended and not prompt for continuing:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> /opt/cdap/master/bin/svc-master run co.cask.cdap.data.tools.UpgradeTool upgrade force
</pre></div>
</div>
</li>
<li><p class="first">Restart the CDAP processes:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> <span class="k">for</span> i in <span class="sb">`</span>ls /etc/init.d/ <span class="p">|</span> grep cdap<span class="sb">`</span> <span class="p">;</span> <span class="k">do</span> sudo service <span class="nv">$i</span> start <span class="p">;</span> <span class="k">done</span>
</pre></div>
</div>
</li>
</ol>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div role="note" aria-label="manuals links">
    <h3><a href="../../table-of-contents/../../index.html"
        rel="nofollow">CDAP Documentation v3.2.1</a></h3>
    <ul class="this-page-menu">
      <li><div class=""></div><a href="../../table-of-contents/../../index.html"
            rel="nofollow">Overview</a></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../introduction/index.html"
            rel="nofollow">Introduction to CDAP</a></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../developers-manual/index.html"
            rel="nofollow">Developers’ Manual</a></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../included-applications/index.html"
            rel="nofollow">Included Applications</a></li>
            
      <li><div class=""></div><b><a href="../../table-of-contents/../../admin-manual/index.html"
            rel="nofollow">Administration Manual</a></b></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../integrations/index.html"
            rel="nofollow">Integrations</a></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../examples-manual/index.html"
            rel="nofollow">Examples, Guides, and Tutorials</a></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../reference-manual/index.html"
            rel="nofollow">Reference Manual</a></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../faqs/index.html"
            rel="nofollow">FAQs</a></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../reference-manual/release-notes.html"
            rel="nofollow">Release Notes</a></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../reference-manual/glossary.html"
            rel="nofollow">Glossary</a></li>
            
      <li><div class=""></div><a href="../../table-of-contents/../../search.html"
            rel="nofollow">Search</a></li>
    </ul>
   </div><!--
  Copyright © 2014-2015 Cask Data, Inc.

  Licensed under the Apache License, Version 2.0 (the "License"); you may not
  use this file except in compliance with the License. You may obtain a copy of
  the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
  License for the specific language governing permissions and limitations under
  the License.
-->


    
<h3 class="pagenavtitle"><a href="../../table-of-contents.html">Administration Manual:<br> Table&nbsp;of&nbsp;Contents</a></h3>
<nav class="pagenav">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html"> Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html"> Installation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../ambari/index.html"> Apache Ambari (HDP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cloudera/index.html"> Cloudera Manager (CDH)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html"> Hadoop</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="starting-verification.html">Starting and Verification</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">Upgrading CDAP</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mapr/index.html"> MapR</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security.html"> Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../operations/index.html"> Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/index.html"> Appendices</a></li>
</ul>
 
</nav>
  <h4>Previous Topic</h4>
  <p class="topless"><a href="starting-verification.html"
                        title="Previous Chapter">Hadoop: From Starting Services to Verification</a></p>
  <h4>Next Topic</h4>
  <p class="topless"><a href="../mapr/index.html"
                        title="Next Chapter">MapR</a></p>
  <div role="note" aria-label="downloads links">
    <h3>Downloads</h3>
    <ul class="this-page-menu">
      <li><a href="http://docs.cask.co/cdap/3.2.1/cdap-docs-3.2.1-web.zip"
            rel="nofollow">Zip Archive of CDAP Documentation</a></li>
    </ul>
   </div>
  
<div id="searchbox" style="display: none" role="search">
  <h3>Quick Search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<div role="note" aria-label="other links">
    <h3><a href="http://docs.cask.co/" target="_blank">Documentation</a></h3>
    <ul class="this-page-menu">
        <li><a href="http://docs.cask.co/cdap/index.html" target="_blank">CDAP</a></li>
        <li><a href="http://docs.cask.co/coopr/index.html" target="_blank">Coopr</a></li>
        <li><a href="http://docs.cask.co/tephra/index.html" target="_blank">Tephra</em></a></li>
        <li><a href="http://docs.cask.co/tigon/index.html" target="_blank">Tigon</a></li>
    </ul>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;margin:0px auto;}
.tg td{padding:0px 20px 0px 20px;border-width:0px;overflow:hidden;word-break:normal;font-weight:normal;}
.tg th{padding:0px 20px 0px 20px;border-width:0px;overflow:hidden;word-break:normal;font-weight:normal;}
.tg .tg-s6z2{text-align:center;}
.tg .tg-0ord{text-align:right;}
.tg a{font-weight:bold;}
</style>
<table class="tg" width= 100%>
  <tr>
    <th class="tg-031e">Previous Topic: 
    <a title="Hadoop: From Starting Services to Verification" href="starting-verification.html" />Hadoop: From Starting Services to Verification</a>&nbsp;&nbsp;
    
    </th>
    <th class="tg-s6z2">
        Copyright &copy; 2014-2015 Cask Data, Inc.
    
    </th>
    <th class="tg-0ord">&nbsp;&nbsp;Next Topic:
    <a title="MapR" href="../mapr/index.html" />MapR</a>
    
    </th>
  </tr>
</table>

    </div>
  </body>
</html>